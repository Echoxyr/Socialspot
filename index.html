<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SocialSpot ULTIMATE ðŸš€</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone@7/babel.min.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <meta name="description" content="SocialSpot ULTIMATE - L'app sociale piÃ¹ avanzata del mondo">
    <meta name="keywords" content="social, eventi, networking, AI, innovazione">
    <style>
        :root {
            --primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --success: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --warning: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            --danger: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            --dark: #0a0a0a;
            --surface: rgba(26, 26, 26, 0.95);
            --surface-2: rgba(42, 42, 42, 0.95);
            --text: #ffffff;
            --text-muted: #888888;
            --border: rgba(255, 255, 255, 0.1);
            --shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            --glow: 0 0 40px rgba(102, 126, 234, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--dark);
            color: var(--text);
            overflow-x: hidden;
            line-height: 1.6;
        }

        /* ðŸš€ ULTIMATE ANIMATIONS */
        @keyframes ultimateGlow {
            0%, 100% { filter: brightness(1) saturate(1); }
            50% { filter: brightness(1.2) saturate(1.3); }
        }

        @keyframes ultimatePulse {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.05) rotate(1deg); }
        }

        @keyframes ultimateSlide {
            0% { transform: translateX(-100%) rotate(-5deg); opacity: 0; }
            100% { transform: translateX(0) rotate(0deg); opacity: 1; }
        }

        @keyframes ultimateFloat {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-10px) rotate(2deg); }
        }

        @keyframes ultimateMatrix {
            0% { background-position: 0% 0%; }
            100% { background-position: 100% 100%; }
        }

        /* ðŸŒŸ ULTIMATE BACKGROUND */
        .app {
            min-height: 100vh;
            background: 
                radial-gradient(circle at 25% 25%, rgba(102, 126, 234, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 75% 75%, rgba(249, 115, 22, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(139, 92, 246, 0.05) 0%, transparent 50%),
                linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 50%, #0a0a0a 100%);
            background-size: 400% 400%;
            animation: ultimateMatrix 20s ease infinite;
            position: relative;
        }

        .app::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                url("data:image/svg+xml,%3Csvg width='40' height='40' viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23667eea' fill-opacity='0.03'%3E%3Cpath d='M20 20c0-5.5-4.5-10-10-10s-10 4.5-10 10 4.5 10 10 10 10-4.5 10-10zm10 0c0-5.5-4.5-10-10-10s-10 4.5-10 10 4.5 10 10 10 10-4.5 10-10z'/%3E%3C/g%3E%3C/svg%3E") repeat;
            pointer-events: none;
            z-index: -1;
        }

        /* ðŸš€ ULTIMATE TOP BAR */
        .top-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(20px) saturate(180%);
            border-bottom: 1px solid var(--border);
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            z-index: 999;
            animation: ultimateSlide 0.8s ease-out;
            box-shadow: var(--shadow);
        }

        .logo-ultimate {
            display: flex;
            align-items: center;
            gap: 12px;
            animation: ultimateFloat 3s ease-in-out infinite;
        }

        .logo-icon {
            width: 45px;
            height: 45px;
            background: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            font-size: 18px;
            color: white;
            box-shadow: var(--glow);
            animation: ultimateGlow 2s ease-in-out infinite;
        }

        .logo-text {
            font-size: 24px;
            font-weight: 800;
            background: var(--primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: ultimateGlow 2s ease-in-out infinite;
        }

        .status-indicators {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .live-status {
            background: var(--success);
            color: white;
            padding: 8px 16px;
            border-radius: 25px;
            font-size: 12px;
            font-weight: 700;
            animation: ultimatePulse 2s ease-in-out infinite;
            box-shadow: 0 0 20px rgba(79, 172, 254, 0.5);
        }

        .ai-status {
            background: var(--secondary);
            color: white;
            padding: 8px 16px;
            border-radius: 25px;
            font-size: 12px;
            font-weight: 700;
            animation: ultimatePulse 2.5s ease-in-out infinite;
            box-shadow: 0 0 20px rgba(240, 147, 251, 0.5);
        }

        /* ðŸŒŸ ULTIMATE BOTTOM NAV */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(20px) saturate(180%);
            border-top: 1px solid var(--border);
            display: flex;
            padding: 15px 0;
            z-index: 1000;
            box-shadow: var(--shadow);
        }

        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 12px;
            cursor: pointer;
            color: var(--text-muted);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            border-radius: 15px;
            margin: 0 5px;
        }

        .nav-item.active {
            color: #667eea;
            background: rgba(102, 126, 234, 0.1);
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .nav-item:hover {
            color: #667eea;
            transform: translateY(-3px);
            background: rgba(102, 126, 234, 0.05);
        }

        .nav-item i {
            font-size: 24px;
            margin-bottom: 6px;
            transition: all 0.3s ease;
        }

        .nav-item.active i {
            animation: ultimateFloat 2s ease-in-out infinite;
        }

        .nav-item span {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .nav-badge {
            position: absolute;
            top: 8px;
            right: 15px;
            background: var(--secondary);
            color: white;
            border-radius: 15px;
            padding: 4px 8px;
            font-size: 10px;
            font-weight: 700;
            min-width: 20px;
            text-align: center;
            animation: ultimatePulse 1.5s ease-in-out infinite;
            box-shadow: 0 0 15px rgba(240, 147, 251, 0.6);
        }

        /* ðŸš€ ULTIMATE CONTENT */
        .content {
            padding: 80px 0 110px;
            min-height: 100vh;
        }

        /* ðŸŒŸ ULTIMATE ONBOARDING */
        .onboarding {
            min-height: 100vh;
            background: 
                radial-gradient(circle at 20% 80%, rgba(102, 126, 234, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(240, 147, 251, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(139, 92, 246, 0.1) 0%, transparent 50%),
                linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        .onboarding::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: 
                conic-gradient(from 0deg at 50% 50%, 
                rgba(102, 126, 234, 0.1) 0deg, 
                transparent 60deg, 
                rgba(240, 147, 251, 0.1) 120deg, 
                transparent 180deg, 
                rgba(139, 92, 246, 0.1) 240deg, 
                transparent 300deg, 
                rgba(102, 126, 234, 0.1) 360deg);
            animation: rotate 20s linear infinite;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .onboarding-card {
            background: rgba(26, 26, 26, 0.9);
            backdrop-filter: blur(40px) saturate(180%);
            border-radius: 25px;
            padding: 50px;
            text-align: center;
            max-width: 450px;
            width: 100%;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 
                0 25px 50px -12px rgba(0, 0, 0, 0.5),
                0 0 80px rgba(102, 126, 234, 0.15);
            position: relative;
            z-index: 1;
            animation: ultimateSlide 1s ease-out;
        }

        .ultimate-logo {
            width: 100px;
            height: 100px;
            background: var(--primary);
            border-radius: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 25px;
            font-size: 42px;
            font-weight: 900;
            color: white;
            box-shadow: 
                0 15px 35px rgba(102, 126, 234, 0.4),
                0 0 60px rgba(102, 126, 234, 0.2);
            animation: ultimateFloat 3s ease-in-out infinite;
            position: relative;
        }

        .ultimate-logo::before {
            content: '';
            position: absolute;
            inset: -2px;
            background: var(--primary);
            border-radius: 27px;
            z-index: -1;
            opacity: 0.5;
            animation: ultimateGlow 2s ease-in-out infinite;
        }

        .onboarding h1 {
            font-size: 32px;
            font-weight: 800;
            margin-bottom: 12px;
            background: var(--primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .onboarding p {
            font-size: 16px;
            color: var(--text-muted);
            margin-bottom: 35px;
            line-height: 1.6;
        }

        .auth-tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 6px;
            margin-bottom: 35px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .auth-tab {
            flex: 1;
            padding: 15px;
            background: none;
            border: none;
            color: var(--text-muted);
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            font-size: 15px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .auth-tab.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
            transform: translateY(-2px);
        }

        .form-group {
            margin-bottom: 25px;
            position: relative;
        }

        .form-input {
            width: 100%;
            padding: 18px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            color: var(--text);
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
        }

        .form-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 25px rgba(102, 126, 234, 0.2);
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-2px);
        }

        .form-input::placeholder {
            color: rgba(255, 255, 255, 0.4);
            font-weight: 400;
        }

        .btn-ultimate {
            width: 100%;
            padding: 20px;
            background: var(--primary);
            border: none;
            border-radius: 15px;
            color: white;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.3);
        }

        .btn-ultimate::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.6s ease;
        }

        .btn-ultimate:hover::before {
            left: 100%;
        }

        .btn-ultimate:hover {
            transform: translateY(-3px);
            box-shadow: 0 25px 50px rgba(102, 126, 234, 0.4);
        }

        .btn-ultimate:active {
            transform: translateY(-1px);
        }

        .btn-ultimate:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* ðŸš€ LOCATION AUTOCOMPLETE ULTIMATE */
        .location-input-container {
            position: relative;
        }

        .location-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: rgba(26, 26, 26, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            max-height: 250px;
            overflow-y: auto;
            z-index: 1000;
            margin-top: 8px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
        }

        .location-suggestion {
            padding: 15px 20px;
            cursor: pointer;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .location-suggestion:hover {
            background: rgba(102, 126, 234, 0.1);
            transform: translateX(5px);
        }

        .location-suggestion:last-child {
            border-bottom: none;
        }

        .location-suggestion i {
            color: #667eea;
            font-size: 14px;
        }

        /* ðŸŒŸ ULTIMATE FEED */
        .feed {
            padding: 0;
            position: relative;
        }

        .real-time-indicator {
            position: fixed;
            top: 85px;
            right: 20px;
            background: var(--success);
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 700;
            z-index: 1000;
            animation: ultimateSlide 0.5s ease-out;
            box-shadow: 0 10px 25px rgba(79, 172, 254, 0.4);
        }

        .feed-header {
            padding: 25px 20px;
            text-align: center;
            background: rgba(26, 26, 26, 0.5);
            backdrop-filter: blur(20px);
            margin: 20px;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            animation: ultimateSlide 0.8s ease-out;
        }

        .feed-title {
            font-size: 28px;
            font-weight: 800;
            margin-bottom: 10px;
            background: var(--primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .feed-subtitle {
            color: var(--text-muted);
            font-size: 16px;
        }

        .events-grid {
            display: grid;
            gap: 25px;
            padding: 0 20px;
        }

        .event-card {
            background: rgba(26, 26, 26, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            animation: ultimateSlide 0.8s ease-out;
        }

        .event-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--primary);
            transform: scaleX(0);
            transition: transform 0.3s ease;
            transform-origin: left;
        }

        .event-card:hover::before {
            transform: scaleX(1);
        }

        .event-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            border-color: rgba(102, 126, 234, 0.3);
        }

        .live-badge {
            position: absolute;
            top: 20px;
            right: 20px;
            background: var(--success);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 700;
            animation: ultimatePulse 2s ease-in-out infinite;
            box-shadow: 0 0 20px rgba(79, 172, 254, 0.5);
        }

        .event-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            gap: 15px;
        }

        .event-avatar {
            width: 55px;
            height: 55px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 800;
            font-size: 20px;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
            animation: ultimateFloat 3s ease-in-out infinite;
        }

        .event-info {
            flex: 1;
        }

        .event-creator {
            font-weight: 700;
            font-size: 16px;
            margin-bottom: 4px;
        }

        .event-location {
            font-size: 14px;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .event-category {
            background: var(--secondary);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            animation: ultimateGlow 3s ease-in-out infinite;
        }

        .event-content {
            margin: 20px 0;
        }

        .event-title {
            font-size: 22px;
            font-weight: 800;
            margin-bottom: 12px;
            line-height: 1.3;
        }

        .event-description {
            color: var(--text-muted);
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .event-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin: 20px 0;
        }

        .event-meta-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-muted);
            font-size: 14px;
            font-weight: 500;
        }

        .event-meta-item i {
            color: #667eea;
            width: 16px;
        }

        .participants-count {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #667eea;
            font-weight: 700;
            font-size: 16px;
        }

        .stats-update-indicator {
            background: var(--success);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: 700;
            animation: ultimatePulse 1s ease-in-out infinite;
            margin-left: 8px;
        }

        .event-actions {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        .action-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text);
            padding: 12px 20px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 600;
            flex: 1;
            justify-content: center;
        }

        .action-btn:hover {
            border-color: #667eea;
            color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.15);
        }

        .action-btn.liked {
            border-color: #f5576c;
            color: #f5576c;
            background: rgba(245, 87, 108, 0.1);
        }

        .action-btn.joined {
            background: var(--primary);
            border-color: transparent;
            color: white;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        /* ðŸš€ ULTIMATE MODAL */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            padding: 20px;
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: rgba(26, 26, 26, 0.95);
            backdrop-filter: blur(40px);
            border-radius: 25px;
            max-width: 700px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            animation: modalSlideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes modalSlideUp {
            from { transform: translateY(50px) scale(0.9); opacity: 0; }
            to { transform: translateY(0) scale(1); opacity: 1; }
        }

        .modal-header {
            padding: 30px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 26px;
            font-weight: 800;
        }

        .modal-close {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: var(--text-muted);
            font-size: 20px;
            cursor: pointer;
            padding: 10px;
            border-radius: 50%;
            transition: all 0.3s ease;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            background: rgba(245, 87, 108, 0.2);
            color: #f5576c;
            transform: scale(1.1);
        }

        .modal-body {
            padding: 30px;
        }

        /* ðŸŒŸ ULTIMATE CHAT */
        .chat-section {
            margin-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding-top: 30px;
        }

        .chat-header {
            display: flex;
            align-items: center;
            justify-content: between;
            margin-bottom: 20px;
        }

        .chat-title {
            font-size: 18px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .live-indicator-chat {
            background: var(--success);
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 10px;
            font-weight: 700;
            animation: ultimatePulse 2s ease-in-out infinite;
        }

        .chat-messages {
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 20px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .chat-message {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: 15px;
            padding: 15px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 15px;
            transition: all 0.3s ease;
            animation: ultimateSlide 0.5s ease-out;
        }

        .chat-message:hover {
            background: rgba(102, 126, 234, 0.15);
            transform: translateX(5px);
        }

        .chat-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 16px;
            font-weight: 700;
            flex-shrink: 0;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .chat-content {
            flex: 1;
        }

        .chat-author {
            font-weight: 700;
            font-size: 14px;
            margin-bottom: 4px;
            color: #667eea;
        }

        .chat-text {
            font-size: 14px;
            color: var(--text);
            line-height: 1.5;
            margin-bottom: 4px;
        }

        .chat-time {
            font-size: 11px;
            color: var(--text-muted);
        }

        .chat-form {
            display: flex;
            gap: 12px;
        }

        .chat-input {
            flex: 1;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 15px 20px;
            color: var(--text);
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .chat-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.2);
        }

        .chat-send {
            background: var(--primary);
            border: none;
            border-radius: 15px;
            padding: 15px 20px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .chat-send:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        /* ðŸš€ ULTIMATE CREATE EVENT */
        .create-page {
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }

        .create-header {
            text-align: center;
            margin-bottom: 40px;
            animation: ultimateSlide 0.8s ease-out;
        }

        .create-title {
            font-size: 32px;
            font-weight: 800;
            margin-bottom: 12px;
            background: var(--primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .create-subtitle {
            color: var(--text-muted);
            font-size: 16px;
        }

        .create-form {
            background: rgba(26, 26, 26, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 40px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
            animation: ultimateSlide 1s ease-out;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 25px;
        }

        .form-group-full {
            grid-column: 1 / -1;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text);
            font-size: 14px;
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
            font-family: inherit;
        }

        .form-select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%23667eea' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 15px center;
            background-repeat: no-repeat;
            background-size: 16px;
            padding-right: 45px;
        }

        /* ðŸŒŸ ULTIMATE PROFILE */
        .profile-page {
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }

        .profile-header {
            text-align: center;
            margin-bottom: 40px;
            background: rgba(26, 26, 26, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 40px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
            animation: ultimateSlide 0.8s ease-out;
            position: relative;
            overflow: hidden;
        }

        .profile-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--primary);
        }

        .profile-avatar-large {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 48px;
            color: white;
            font-weight: 800;
            border: 4px solid rgba(102, 126, 234, 0.3);
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.3);
            animation: ultimateFloat 3s ease-in-out infinite;
        }

        .profile-name {
            font-size: 28px;
            font-weight: 800;
            margin-bottom: 8px;
        }

        .profile-email {
            color: var(--text-muted);
            font-size: 16px;
            margin-bottom: 25px;
        }

        .profile-stats {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin: 30px 0;
        }

        .stat-item {
            text-align: center;
            padding: 20px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 15px;
            min-width: 100px;
            border: 1px solid rgba(102, 126, 234, 0.2);
            transition: all 0.3s ease;
        }

        .stat-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.2);
        }

        .stat-number {
            font-size: 28px;
            font-weight: 800;
            color: #667eea;
            margin-bottom: 8px;
            animation: ultimateGlow 3s ease-in-out infinite;
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        .profile-actions {
            display: flex;
            gap: 15px;
            margin: 30px 0;
        }

        .profile-btn {
            flex: 1;
            padding: 18px;
            background: var(--primary);
            border: none;
            border-radius: 15px;
            color: white;
            font-weight: 700;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .profile-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.4);
        }

        .profile-btn.secondary {
            background: rgba(255, 255, 255, 0.1);
            box-shadow: none;
        }

        .profile-btn.secondary:hover {
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        /* ðŸš€ ULTIMATE SEARCH */
        .search-page {
            padding: 20px;
        }

        .search-bar {
            background: rgba(26, 26, 26, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 18px 25px;
            color: var(--text);
            width: 100%;
            margin-bottom: 30px;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .search-bar:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 30px rgba(102, 126, 234, 0.2);
            background: rgba(26, 26, 26, 0.9);
        }

        .search-bar::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        .section-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .section-title i {
            color: #667eea;
        }

        .demo-badge {
            background: var(--secondary);
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 10px;
            font-weight: 700;
            margin-left: 12px;
            animation: ultimatePulse 2s ease-in-out infinite;
        }

        .people-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
        }

        .person-card {
            background: rgba(26, 26, 26, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            animation: ultimateSlide 0.8s ease-out;
        }

        .person-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--primary);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .person-card:hover::before {
            transform: scaleX(1);
        }

        .person-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            border-color: rgba(102, 126, 234, 0.3);
        }

        .person-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            color: white;
            font-weight: 800;
            font-size: 28px;
            border: 3px solid rgba(102, 126, 234, 0.3);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
            animation: ultimateFloat 3s ease-in-out infinite;
        }

        .person-name {
            font-weight: 700;
            font-size: 18px;
            margin-bottom: 8px;
        }

        .person-bio {
            font-size: 14px;
            color: var(--text-muted);
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .person-location {
            font-size: 12px;
            color: #667eea;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .connect-btn {
            background: var(--primary);
            border: none;
            border-radius: 12px;
            padding: 12px 24px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .connect-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        /* ðŸŒŸ ULTIMATE NOTIFICATIONS */
        .notifications-page {
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }

        .notification-item {
            display: flex;
            align-items: center;
            padding: 20px;
            background: rgba(26, 26, 26, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 15px;
            margin-bottom: 15px;
            gap: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            position: relative;
            animation: ultimateSlide 0.5s ease-out;
        }

        .notification-item:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.15);
        }

        .notification-item.unread {
            border-left: 4px solid #667eea;
            background: rgba(102, 126, 234, 0.05);
        }

        .notification-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 18px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .notification-content {
            flex: 1;
        }

        .notification-text {
            font-size: 15px;
            margin-bottom: 6px;
            line-height: 1.4;
        }

        .notification-time {
            font-size: 12px;
            color: var(--text-muted);
        }

        .notification-action {
            background: var(--primary);
            border: none;
            border-radius: 10px;
            padding: 10px 20px;
            color: white;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .notification-action:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        /* ðŸš€ ULTIMATE UTILITIES */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 200px;
            flex-direction: column;
            gap: 20px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(102, 126, 234, 0.1);
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: var(--text-muted);
            font-weight: 600;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-muted);
        }

        .empty-state i {
            font-size: 64px;
            margin-bottom: 20px;
            color: rgba(102, 126, 234, 0.3);
        }

        .empty-state h3 {
            font-size: 24px;
            margin-bottom: 12px;
            color: var(--text);
            font-weight: 700;
        }

        .empty-state p {
            font-size: 16px;
            line-height: 1.5;
        }

        .error-message {
            background: rgba(245, 87, 108, 0.1);
            color: #f5576c;
            padding: 18px 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            font-size: 14px;
            border: 1px solid rgba(245, 87, 108, 0.2);
            font-weight: 500;
        }

        .success-message {
            background: rgba(79, 172, 254, 0.1);
            color: #4facfe;
            padding: 18px 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            font-size: 14px;
            border: 1px solid rgba(79, 172, 254, 0.2);
            font-weight: 500;
        }

        /* ðŸŒŸ RESPONSIVE DESIGN */
        @media (max-width: 768px) {
            .top-bar {
                padding: 12px 15px;
            }

            .logo-text {
                font-size: 20px;
            }

            .status-indicators {
                gap: 6px;
            }

            .live-status, .ai-status {
                padding: 6px 12px;
                font-size: 10px;
            }

            .onboarding-card {
                padding: 30px 25px;
                margin: 10px;
            }

            .ultimate-logo {
                width: 80px;
                height: 80px;
                font-size: 32px;
            }

            .onboarding h1 {
                font-size: 26px;
            }

            .form-row {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .profile-stats {
                gap: 20px;
                flex-wrap: wrap;
            }

            .stat-item {
                min-width: 80px;
                padding: 15px;
            }

            .event-actions {
                flex-direction: column;
            }

            .people-grid {
                grid-template-columns: 1fr;
            }

            .profile-actions {
                flex-direction: column;
            }

            .modal-content {
                margin: 10px;
                max-height: 95vh;
            }

            .modal-header, .modal-body {
                padding: 20px;
            }

            .events-grid {
                padding: 0 15px;
            }

            .event-card {
                padding: 20px;
            }

            .real-time-indicator {
                top: 70px;
                right: 15px;
                padding: 8px 12px;
                font-size: 12px;
            }
        }

        @media (max-width: 480px) {
            .nav-item {
                padding: 8px 4px;
            }

            .nav-item i {
                font-size: 20px;
            }

            .nav-item span {
                font-size: 9px;
            }

            .event-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .event-meta {
                flex-direction: column;
                gap: 10px;
            }

            .form-input, .btn-ultimate {
                padding: 15px;
            }

            .chat-messages {
                padding: 15px;
            }

            .search-bar {
                padding: 15px 20px;
            }
        }

        /* ðŸš€ ADVANCED EFFECTS */
        .ultimate-glow {
            animation: ultimateGlow 3s ease-in-out infinite;
        }

        .ultimate-pulse {
            animation: ultimatePulse 2s ease-in-out infinite;
        }

        .ultimate-float {
            animation: ultimateFloat 3s ease-in-out infinite;
        }

        /* Scrollbar personalizzata */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(102, 126, 234, 0.5);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(102, 126, 234, 0.7);
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        // ðŸš€ CONFIGURAZIONE SUPABASE ULTIMATE
        const SUPABASE_URL = 'https://ctixzrxyyqpumzwmyjyo.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN0aXh6cnh5eXFwdW16d215anlvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQwMTYzNDQsImV4cCI6MjA3OTU5MjM0NH0.k8HDt4WbU6RwMktolucWc1dekPwfbOk853o7AABRt4o';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        const { useState, useEffect, useCallback, useRef } = React;

        // ðŸŒŸ DATI ULTIMATE
        const CATEGORIES = [
            'Sport', 'Musica', 'Arte', 'Cultura', 'Tecnologia', 
            'Cibo', 'Viaggi', 'Cinema', 'All\'aperto', 'Business'
        ];

        const ITALIAN_CITIES = [
            'Roma, Lazio', 'Milano, Lombardia', 'Napoli, Campania', 'Torino, Piemonte',
            'Palermo, Sicilia', 'Genova, Liguria', 'Bologna, Emilia-Romagna', 'Firenze, Toscana',
            'Bari, Puglia', 'Catania, Sicilia', 'Venezia, Veneto', 'Verona, Veneto',
            'Messina, Sicilia', 'Padova, Veneto', 'Trieste, Friuli-Venezia Giulia', 'Taranto, Puglia',
            'Brescia, Lombardia', 'Prato, Toscana', 'Parma, Emilia-Romagna', 'Modena, Emilia-Romagna',
            'Reggio Calabria, Calabria', 'Reggio Emilia, Emilia-Romagna', 'Perugia, Umbria', 'Livorno, Toscana',
            'Ravenna, Emilia-Romagna', 'Cagliari, Sardegna', 'Foggia, Puglia', 'Rimini, Emilia-Romagna',
            'Salerno, Campania', 'Ferrara, Emilia-Romagna', 'Sassari, Sardegna', 'Latina, Lazio'
        ];

        const DEMO_USERS = [
            { id: 'demo1', username: 'marco_sport', bio: 'ðŸˆ Appassionato di calcio e tennis. Organizzo tornei locali!', location: 'Milano, Lombardia' },
            { id: 'demo2', username: 'anna_music', bio: 'ðŸŽµ Pianista jazz. Organizzo concerti nei locali storici', location: 'Roma, Lazio' },
            { id: 'demo3', username: 'luca_tech', bio: 'ðŸ’» Full-stack developer e maker. AI enthusiast', location: 'Torino, Piemonte' },
            { id: 'demo4', username: 'sara_arte', bio: 'ðŸŽ¨ Pittrice contemporanea e curatrice di mostre', location: 'Firenze, Toscana' },
            { id: 'demo5', username: 'giorgio_food', bio: 'ðŸ‘¨â€ðŸ³ Chef stellato e food blogger', location: 'Bologna, Emilia-Romagna' },
            { id: 'demo6', username: 'elena_travel', bio: 'âœˆï¸ Travel blogger e fotografa di viaggio', location: 'Venezia, Veneto' },
            { id: 'demo7', username: 'roberto_cinema', bio: 'ðŸŽ¬ Regista indipendente e sceneggiatore', location: 'Napoli, Campania' },
            { id: 'demo8', username: 'chiara_fitness', bio: 'ðŸ’ª Personal trainer certificata e nutrizionista', location: 'Palermo, Sicilia' },
            { id: 'demo9', username: 'alessandro_business', bio: 'ðŸ“ˆ Startup founder e business mentor', location: 'Bari, Puglia' },
            { id: 'demo10', username: 'federica_natura', bio: 'ðŸŒ¿ Guida naturalistica e organizzatrice di trekking', location: 'Cagliari, Sardegna' }
        ];

        // ðŸš€ COMPONENT LOCATION AUTOCOMPLETE ULTIMATE
        function LocationInput({ value, onChange, placeholder }) {
            const [suggestions, setSuggestions] = useState([]);
            const [showSuggestions, setShowSuggestions] = useState(false);

            const handleInputChange = (e) => {
                const inputValue = e.target.value;
                onChange(inputValue);
                
                if (inputValue.length > 1) {
                    const filtered = ITALIAN_CITIES.filter(city =>
                        city.toLowerCase().includes(inputValue.toLowerCase())
                    ).slice(0, 8);
                    setSuggestions(filtered);
                    setShowSuggestions(true);
                } else {
                    setShowSuggestions(false);
                }
            };

            const selectSuggestion = (city) => {
                onChange(city);
                setShowSuggestions(false);
            };

            return (
                <div className="location-input-container">
                    <input
                        type="text"
                        className="form-input"
                        placeholder={placeholder}
                        value={value}
                        onChange={handleInputChange}
                        onBlur={() => setTimeout(() => setShowSuggestions(false), 150)}
                        required
                    />
                    {showSuggestions && suggestions.length > 0 && (
                        <div className="location-suggestions">
                            {suggestions.map((city, index) => (
                                <div
                                    key={index}
                                    className="location-suggestion"
                                    onClick={() => selectSuggestion(city)}
                                >
                                    <i className="fas fa-map-marker-alt"></i>
                                    {city}
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        }

        // ðŸŒŸ HOOK STATISTICHE REAL-TIME ULTIMATE
        function useRealTimeStats(userId) {
            const [stats, setStats] = useState({ events: 0, followers: 0, following: 0 });
            const [loading, setLoading] = useState(true);

            const calculateStats = useCallback(async () => {
                if (!userId) return;
                
                try {
                    // Eventi creati (REALE)
                    const { data: myEvents } = await supabase
                        .from('events')
                        .select('id')
                        .eq('creator_id', userId);
                    
                    const eventsCount = myEvents?.length || 0;
                    
                    // Followers = Partecipanti unici ai miei eventi (REALE)
                    let followersCount = 0;
                    if (eventsCount > 0) {
                        const { data: participants } = await supabase
                            .from('event_participants')
                            .select('user_id')
                            .in('event_id', myEvents.map(e => e.id));
                        
                        const uniqueParticipants = new Set(participants?.map(p => p.user_id) || []);
                        followersCount = uniqueParticipants.size;
                    }
                    
                    // Following = Eventi a cui partecipo (REALE)
                    const { data: myParticipations } = await supabase
                        .from('event_participants')
                        .select('event_id')
                        .eq('user_id', userId);
                    
                    const followingCount = myParticipations?.length || 0;
                    
                    setStats({
                        events: eventsCount,
                        followers: followersCount,
                        following: followingCount
                    });
                } catch (err) {
                    console.error('âŒ Errore calcolo statistiche:', err);
                } finally {
                    setLoading(false);
                }
            }, [userId]);

            useEffect(() => {
                calculateStats();
                
                // Real-time updates ULTIMATE
                const eventsChannel = supabase.channel('events_stats_ultimate')
                    .on('postgres_changes', {
                        event: '*',
                        schema: 'public',
                        table: 'events',
                        filter: `creator_id=eq.${userId}`
                    }, calculateStats)
                    .subscribe();

                const participantsChannel = supabase.channel('participants_stats_ultimate')
                    .on('postgres_changes', {
                        event: '*',
                        schema: 'public',
                        table: 'event_participants',
                        filter: `user_id=eq.${userId}`
                    }, calculateStats)
                    .subscribe();

                return () => {
                    supabase.removeChannel(eventsChannel);
                    supabase.removeChannel(participantsChannel);
                };
            }, [calculateStats]);

            return { stats, loading, refresh: calculateStats };
        }

        // ðŸš€ COMPONENT ONBOARDING ULTIMATE
        function Onboarding({ onComplete }) {
            const [isSignIn, setIsSignIn] = useState(true);
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [username, setUsername] = useState('');
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState('');

            const handleAuth = async (e) => {
                e.preventDefault();
                setLoading(true);
                setError('');
                
                // Validazione email
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(email)) {
                    setError('Inserisci un indirizzo email valido');
                    setLoading(false);
                    return;
                }
                
                // Validazione password
                if (password.length < 6) {
                    setError('La password deve essere di almeno 6 caratteri');
                    setLoading(false);
                    return;
                }
                
                try {
                    let result;
                    if (isSignIn) {
                        result = await supabase.auth.signInWithPassword({ email, password });
                        
                        if (result.error) {
                            setError(result.error.message);
                        } else if (result.data.user) {
                            // Verifica email confermata
                            if (!result.data.user.email_confirmed_at) {
                                setError('Per favore, verifica la tua email prima di accedere');
                                await supabase.auth.signOut();
                                return;
                            }
                            onComplete(result.data.user);
                        }
                    } else {
                        result = await supabase.auth.signUp({ 
                            email, 
                            password,
                            options: {
                                data: { username: username || email.split('@')[0] }
                            }
                        });
                        
                        if (result.error) {
                            setError(result.error.message);
                        } else if (result.data.user) {
                            // Crea profilo
                            await supabase.from('profiles').upsert({
                                id: result.data.user.id,
                                username: username || result.data.user.email.split('@')[0],
                                location: 'Italia',
                                interests: ['Tecnologia', 'Social']
                            }, { onConflict: 'id' });
                            
                            // Mostra successo e switch a login
                            setError('');
                            setSuccess('âœ… Registrazione completata! Controlla la tua email per verificare l\'account.');
                            
                            // Switch automatico a login dopo 2 secondi
                            setTimeout(() => {
                                setIsSignIn(true);
                                setSuccess(null);
                            }, 2000);
                        }
                    }
                } catch (err) {
                    setError(err.message);
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="onboarding">
                    <div className="onboarding-card">
                        <div className="ultimate-logo">SP</div>
                        <h1>SocialSpot ULTIMATE</h1>
                        <p>ðŸš€ La piattaforma sociale piÃ¹ avanzata del mondo</p>
                        
                        <div className="auth-tabs">
                            <button 
                                className={`auth-tab ${isSignIn ? 'active' : ''}`} 
                                onClick={() => setIsSignIn(true)}
                            >
                                Accedi
                            </button>
                            <button 
                                className={`auth-tab ${!isSignIn ? 'active' : ''}`} 
                                onClick={() => setIsSignIn(false)}
                            >
                                Registrati
                            </button>
                        </div>
                        
                        <form onSubmit={handleAuth}>
                            {!isSignIn && (
                                <div className="form-group">
                                    <input 
                                        type="text" 
                                        className="form-input" 
                                        placeholder="ðŸ‘¤ Username" 
                                        value={username} 
                                        onChange={(e) => setUsername(e.target.value)} 
                                    />
                                </div>
                            )}
                            <div className="form-group">
                                <input 
                                    type="email" 
                                    className="form-input" 
                                    placeholder="ðŸ“§ Email" 
                                    value={email} 
                                    onChange={(e) => setEmail(e.target.value)} 
                                    required 
                                />
                            </div>
                            <div className="form-group">
                                <input 
                                    type="password" 
                                    className="form-input" 
                                    placeholder="ðŸ”’ Password" 
                                    value={password} 
                                    onChange={(e) => setPassword(e.target.value)} 
                                    required 
                                />
                            </div>
                            
                            {error && <div className="error-message">{error}</div>}
                            
                            <button type="submit" className="btn-ultimate" disabled={loading}>
                                {loading ? (
                                    <>
                                        <i className="fas fa-spinner fa-spin"></i>
                                        Caricamento...
                                    </>
                                ) : (
                                    <>
                                        <i className={isSignIn ? 'fas fa-sign-in-alt' : 'fas fa-user-plus'}></i>
                                        {isSignIn ? 'Entra nel futuro' : 'Unisciti alla rivoluzione'}
                                    </>
                                )}
                            </button>
                        </form>
                    </div>
                </div>
            );
        }

        // ðŸŒŸ COMPONENT CHAT EVENTI ULTIMATE
        function EventChat({ eventId, user, isParticipant }) {
            const [messages, setMessages] = useState([]);
            const [newMessage, setNewMessage] = useState('');
            const [loading, setLoading] = useState(true);
            const messagesEndRef = useRef(null);

            const scrollToBottom = () => {
                messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
            };

            useEffect(() => {
                if (isParticipant) {
                    loadMessages();
                    
                    const channel = supabase.channel(`event_chat_ultimate_${eventId}`)
                        .on('postgres_changes', {
                            event: 'INSERT',
                            schema: 'public',
                            table: 'event_chats',
                            filter: `event_id=eq.${eventId}`
                        }, () => {
                            loadMessages();
                        })
                        .subscribe();

                    return () => supabase.removeChannel(channel);
                }
            }, [eventId, isParticipant]);

            useEffect(scrollToBottom, [messages]);

            const loadMessages = async () => {
                try {
                    const { data, error } = await supabase
                        .from('event_chats')
                        .select(`
                            id,
                            content,
                            created_at,
                            profiles!event_chats_user_id_fkey(username)
                        `)
                        .eq('event_id', eventId)
                        .order('created_at', { ascending: true });

                    if (!error) {
                        setMessages(data || []);
                    }
                } catch (err) {
                    console.error('âŒ Errore caricamento chat:', err);
                } finally {
                    setLoading(false);
                }
            };

            const sendMessage = async (e) => {
                e.preventDefault();
                if (!newMessage.trim() || !isParticipant) return;

                try {
                    await supabase
                        .from('event_chats')
                        .insert({
                            event_id: eventId,
                            user_id: user.id,
                            content: newMessage.trim()
                        });
                    
                    setNewMessage('');
                } catch (err) {
                    console.error('âŒ Errore invio messaggio:', err);
                }
            };

            if (!isParticipant) {
                return (
                    <div className="chat-section">
                        <div className="chat-header">
                            <div className="chat-title">
                                <i className="fas fa-lock"></i>
                                Chat Evento
                            </div>
                        </div>
                        <div className="empty-state">
                            <i className="fas fa-lock"></i>
                            <h3>Chat Privata</h3>
                            <p>Partecipa all'evento per accedere alla chat di gruppo</p>
                        </div>
                    </div>
                );
            }

            return (
                <div className="chat-section">
                    <div className="chat-header">
                        <div className="chat-title">
                            <i className="fas fa-comments"></i>
                            Chat Evento
                            <div className="live-indicator-chat">LIVE</div>
                        </div>
                    </div>
                    
                    {loading ? (
                        <div className="loading">
                            <div className="spinner"></div>
                            <div className="loading-text">Caricamento chat...</div>
                        </div>
                    ) : (
                        <>
                            <div className="chat-messages">
                                {messages.length === 0 ? (
                                    <div className="empty-state">
                                        <i className="fas fa-comment-slash"></i>
                                        <h3>Nessun messaggio</h3>
                                        <p>Sii il primo a scrivere nella chat!</p>
                                    </div>
                                ) : (
                                    messages.map(msg => (
                                        <div key={msg.id} className="chat-message">
                                            <div className="chat-avatar">
                                                {msg.profiles?.username?.[0]?.toUpperCase() || 'U'}
                                            </div>
                                            <div className="chat-content">
                                                <div className="chat-author">{msg.profiles?.username || 'Utente'}</div>
                                                <div className="chat-text">{msg.content}</div>
                                                <div className="chat-time">
                                                    {new Date(msg.created_at).toLocaleTimeString('it-IT', {
                                                        hour: '2-digit',
                                                        minute: '2-digit'
                                                    })}
                                                </div>
                                            </div>
                                        </div>
                                    ))
                                )}
                                <div ref={messagesEndRef} />
                            </div>
                            
                            <form onSubmit={sendMessage} className="chat-form">
                                <input
                                    type="text"
                                    className="chat-input"
                                    placeholder="ðŸ’¬ Scrivi un messaggio..."
                                    value={newMessage}
                                    onChange={(e) => setNewMessage(e.target.value)}
                                    required
                                />
                                <button type="submit" className="chat-send">
                                    <i className="fas fa-paper-plane"></i>
                                </button>
                            </form>
                        </>
                    )}
                </div>
            );
        }

        // ðŸš€ COMPONENT MODAL EVENTO ULTIMATE
        function EventModal({ event, onClose, user, onJoinToggle }) {
            const [participants, setParticipants] = useState([]);
            const [isJoined, setIsJoined] = useState(false);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                loadParticipants();
            }, []);

            const loadParticipants = async () => {
                try {
                    const { data, error } = await supabase
                        .from('event_participants')
                        .select(`
                            user_id,
                            profiles!event_participants_user_id_fkey(username)
                        `)
                        .eq('event_id', event.id);

                    if (!error) {
                        setParticipants(data || []);
                        setIsJoined(data?.some(p => p.user_id === user.id) || false);
                    }
                } catch (err) {
                    console.error('âŒ Errore caricamento partecipanti:', err);
                } finally {
                    setLoading(false);
                }
            };

            const handleJoinToggle = async () => {
                try {
                    if (isJoined) {
                        await supabase
                            .from('event_participants')
                            .delete()
                            .eq('event_id', event.id)
                            .eq('user_id', user.id);
                    } else {
                        await supabase
                            .from('event_participants')
                            .insert({
                                event_id: event.id,
                                user_id: user.id
                            });
                    }
                    loadParticipants();
                    if (onJoinToggle) onJoinToggle();
                } catch (err) {
                    console.error('âŒ Errore toggle partecipazione:', err);
                }
            };

            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                        <div className="modal-header">
                            <h2 className="modal-title">{event.title}</h2>
                            <button className="modal-close" onClick={onClose}>
                                <i className="fas fa-times"></i>
                            </button>
                        </div>
                        <div className="modal-body">
                            <div className="event-category ultimate-glow" style={{marginBottom: '20px'}}>
                                {event.category}
                            </div>
                            <p style={{marginBottom: '20px', lineHeight: '1.6', fontSize: '16px'}}>
                                {event.description}
                            </p>
                            
                            <div className="event-meta">
                                <div className="event-meta-item">
                                    <i className="fas fa-calendar"></i>
                                    <span>{new Date(event.event_date).toLocaleString('it-IT')}</span>
                                </div>
                                <div className="event-meta-item">
                                    <i className="fas fa-map-marker-alt"></i>
                                    <span>{event.location}</span>
                                </div>
                                {event.profiles && (
                                    <div className="event-meta-item">
                                        <i className="fas fa-user"></i>
                                        <span>Organizzato da {event.profiles.username}</span>
                                    </div>
                                )}
                            </div>
                            
                            <div className="participants-count">
                                <i className="fas fa-users"></i>
                                <span>{participants.length} partecipanti</span>
                                {participants.length > 0 && <div className="stats-update-indicator">!</div>}
                            </div>
                            
                            <button 
                                className={`btn-ultimate join-btn ${isJoined ? 'secondary' : ''}`}
                                onClick={handleJoinToggle}
                                disabled={loading}
                                style={{marginTop: '25px'}}
                            >
                                <i className={isJoined ? 'fas fa-user-minus' : 'fas fa-user-plus'}></i>
                                {isJoined ? 'Abbandona evento' : 'Partecipa all\'evento'}
                            </button>

                            <EventChat eventId={event.id} user={user} isParticipant={isJoined} />
                        </div>
                    </div>
                </div>
            );
        }

        // ðŸŒŸ COMPONENT FEED ULTIMATE
        function Feed({ user }) {
            const [events, setEvents] = useState([]);
            const [suggestedEvents, setSuggestedEvents] = useState([]);
            const [loading, setLoading] = useState(true);
            const [favorites, setFavorites] = useState([]);
            const [participants, setParticipants] = useState({});
            const [selectedEvent, setSelectedEvent] = useState(null);
            const [realTimeUpdate, setRealTimeUpdate] = useState(false);
            const [userProfile, setUserProfile] = useState(null);

            useEffect(() => {
                loadUserProfile();
                loadEvents();
                loadFavorites();
                loadParticipants();
                
                // Real-time subscriptions ULTIMATE
                const eventsChannel = supabase.channel('events_feed_ultimate')
                    .on('postgres_changes', {
                        event: '*',
                        schema: 'public',
                        table: 'events'
                    }, () => {
                        setRealTimeUpdate(true);
                        loadEvents();
                        setTimeout(() => setRealTimeUpdate(false), 3000);
                    })
                    .subscribe();

                const participantsChannel = supabase.channel('participants_feed_ultimate')
                    .on('postgres_changes', {
                        event: '*',
                        schema: 'public',
                        table: 'event_participants'
                    }, () => {
                        loadParticipants();
                    })
                    .subscribe();

                return () => {
                    supabase.removeChannel(eventsChannel);
                    supabase.removeChannel(participantsChannel);
                };
            }, []);
            
            const loadUserProfile = async () => {
                try {
                    const { data } = await supabase
                        .from('profiles')
                        .select('location, current_city, interests')
                        .eq('id', user.id)
                        .single();
                    
                    if (data) {
                        setUserProfile(data);
                        loadSuggestedEvents(data);
                    }
                } catch (err) {
                    console.error('âŒ Errore profilo:', err);
                }
            };
            
            const loadSuggestedEvents = async (profile) => {
                try {
                    const targetCity = profile.current_city || profile.location;
                    
                    const { data, error } = await supabase
                        .from('events')
                        .select(`
                            *,
                            profiles!events_creator_id_fkey(username, location)
                        `)
                        .eq('location', targetCity)
                        .in('category', profile.interests || [])
                        .gte('event_date', new Date().toISOString())
                        .order('event_date', { ascending: true })
                        .limit(3);
                    
                    if (!error && data && data.length > 0) {
                        setSuggestedEvents(data);
                    } else {
                        // Fallback: eventi popolari della cittÃ 
                        const { data: fallbackData } = await supabase
                            .from('events')
                            .select(`
                                *,
                                profiles!events_creator_id_fkey(username, location)
                            `)
                            .eq('location', targetCity)
                            .gte('event_date', new Date().toISOString())
                            .order('created_at', { ascending: false })
                            .limit(3);
                        
                        setSuggestedEvents(fallbackData || []);
                    }
                } catch (err) {
                    console.error('âŒ Errore suggerimenti:', err);
                }
            };

            const loadEvents = async () => {
                try {
                    const { data, error } = await supabase
                        .from('events')
                        .select(`
                            *,
                            profiles!events_creator_id_fkey(username, location)
                        `)
                        .order('created_at', { ascending: false });
                    
                    if (!error) {
                        setEvents(data || []);
                    }
                } catch (err) {
                    console.error('âŒ Errore caricamento eventi:', err);
                } finally {
                    setLoading(false);
                }
            };

            const loadFavorites = async () => {
                try {
                    const { data } = await supabase
                        .from('event_favorites')
                        .select('event_id')
                        .eq('user_id', user.id);
                    setFavorites(data ? data.map(f => f.event_id) : []);
                } catch (err) {
                    console.error('âŒ Errore caricamento favoriti:', err);
                }
            };

            const loadParticipants = async () => {
                try {
                    const { data } = await supabase
                        .from('event_participants')
                        .select('event_id, user_id');
                    
                    const counts = {};
                    const userParticipations = [];
                    
                    (data || []).forEach(p => {
                        counts[p.event_id] = (counts[p.event_id] || 0) + 1;
                        if (p.user_id === user.id) {
                            userParticipations.push(p.event_id);
                        }
                    });
                    
                    setParticipants({ counts, userParticipations });
                } catch (err) {
                    console.error('âŒ Errore caricamento partecipanti:', err);
                }
            };

            const toggleFavorite = async (eventId) => {
                const isFavorite = favorites.includes(eventId);
                try {
                    if (isFavorite) {
                        await supabase
                            .from('event_favorites')
                            .delete()
                            .eq('event_id', eventId)
                            .eq('user_id', user.id);
                        setFavorites(favorites.filter(id => id !== eventId));
                    } else {
                        await supabase
                            .from('event_favorites')
                            .insert({ event_id: eventId, user_id: user.id });
                        setFavorites([...favorites, eventId]);
                    }
                } catch (err) {
                    console.error('âŒ Errore toggle favorito:', err);
                }
            };

            const toggleJoin = async (eventId) => {
                const isJoined = participants.userParticipations?.includes(eventId);
                try {
                    if (isJoined) {
                        await supabase
                            .from('event_participants')
                            .delete()
                            .eq('event_id', eventId)
                            .eq('user_id', user.id);
                    } else {
                        await supabase
                            .from('event_participants')
                            .insert({ event_id: eventId, user_id: user.id });
                    }
                    loadParticipants();
                } catch (err) {
                    console.error('âŒ Errore toggle partecipazione:', err);
                }
            };

            const formatDate = (dateString) => {
                const date = new Date(dateString);
                return date.toLocaleDateString('it-IT', {
                    day: 'numeric',
                    month: 'short',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            };

            if (loading) {
                return (
                    <div className="loading">
                        <div className="spinner"></div>
                        <div className="loading-text">Caricamento eventi ultimate...</div>
                    </div>
                );
            }

            return (
                <div className="feed">
                    {realTimeUpdate && (
                        <div className="real-time-indicator">
                            <i className="fas fa-sync-alt fa-spin"></i> 
                            Aggiornamento real-time ULTIMATE!
                        </div>
                    )}
                    
                    <div className="feed-header">
                        <h1 className="feed-title">ðŸš€ Eventi ULTIMATE</h1>
                        <p className="feed-subtitle">Scopri esperienze incredibili nella tua zona</p>
                    </div>
                    
                    {/* Sezione Suggerimenti Personalizzati */}
                    {suggestedEvents.length > 0 && (
                        <div style={{
                            background: 'linear-gradient(135deg, rgba(37, 99, 235, 0.1), rgba(249, 115, 22, 0.1))',
                            borderRadius: '20px',
                            padding: '25px',
                            marginBottom: '30px',
                            border: '2px solid rgba(37, 99, 235, 0.3)'
                        }}>
                            <div className="section-title" style={{marginBottom: '20px'}}>
                                <i className="fas fa-star"></i>
                                ðŸŽ¯ Consigliati per te
                                <span style={{
                                    fontSize: '12px',
                                    color: 'var(--color-text-muted)',
                                    fontWeight: 'normal',
                                    marginLeft: '10px'
                                }}>
                                    Basati su {userProfile?.current_city || userProfile?.location} e i tuoi interessi
                                </span>
                            </div>
                            <div className="events-grid">
                                {suggestedEvents.map(event => (
                                    <div key={event.id} className="event-card" style={{
                                        border: '2px solid rgba(37, 99, 235, 0.5)',
                                        boxShadow: '0 8px 32px rgba(37, 99, 235, 0.2)'
                                    }}>
                                        <div className="live-badge" style={{background: 'linear-gradient(135deg, #2563eb, #f97316)'}}>
                                            â­ PER TE
                                        </div>
                                        <div className="event-header">
                                            <div className="event-avatar ultimate-float">
                                                {event.profiles?.username?.[0]?.toUpperCase() || 'U'}
                                            </div>
                                            <div className="event-info">
                                                <div className="event-creator">{event.profiles?.username || 'Utente'}</div>
                                                <div className="event-location">
                                                    <i className="fas fa-map-marker-alt"></i>
                                                    {event.location}
                                                </div>
                                            </div>
                                            <div className="event-category ultimate-pulse">{event.category}</div>
                                        </div>
                                        <div className="event-content">
                                            <h3 className="event-title">{event.title}</h3>
                                            <p className="event-description">{event.description}</p>
                                            <div className="event-meta">
                                                <div className="event-meta-item">
                                                    <i className="fas fa-calendar"></i>
                                                    <span>{formatDate(event.event_date)}</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div className="event-actions">
                                            <button 
                                                className="action-btn"
                                                onClick={() => setSelectedEvent(event)}
                                            >
                                                <i className="fas fa-info-circle"></i>
                                                Dettagli
                                            </button>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}
                    
                    {/* Tutti gli eventi */}
                    <div className="section-title" style={{marginBottom: '20px'}}>
                        <i className="fas fa-calendar-alt"></i>
                        Tutti gli eventi
                    </div>
                    <div className="events-grid">
                        {events.length === 0 ? (
                            <div className="empty-state">
                                <i className="fas fa-rocket"></i>
                                <h3>Nessun evento ancora</h3>
                                <p>Sii il primo a creare un evento ULTIMATE nella tua zona!</p>
                            </div>
                        ) : (
                            events.map(event => (
                                <div key={event.id} className="event-card">
                                    <div className="live-badge">ULTIMATE</div>
                                    <div className="event-header">
                                        <div className="event-avatar ultimate-float">
                                            {event.profiles?.username?.[0]?.toUpperCase() || 'U'}
                                        </div>
                                        <div className="event-info">
                                            <div className="event-creator">{event.profiles?.username || 'Utente'}</div>
                                            <div className="event-location">
                                                <i className="fas fa-map-marker-alt"></i>
                                                {event.location}
                                            </div>
                                        </div>
                                        <div className="event-category ultimate-pulse">{event.category}</div>
                                    </div>
                                    
                                    <div className="event-content">
                                        <h3 className="event-title">{event.title}</h3>
                                        <p className="event-description">{event.description}</p>
                                        
                                        <div className="event-meta">
                                            <div className="event-meta-item">
                                                <i className="fas fa-calendar"></i>
                                                <span>{formatDate(event.event_date)}</span>
                                            </div>
                                            <div className="event-meta-item">
                                                <i className="fas fa-venus-mars"></i>
                                                <span>
                                                    {event.gender_preference === 'both' ? 'Tutti' : 
                                                     event.gender_preference === 'male' ? 'Uomini' : 'Donne'}
                                                </span>
                                            </div>
                                            <div className="event-meta-item">
                                                <i className="fas fa-user-friends"></i>
                                                <span>{event.min_age}-{event.max_age} anni</span>
                                            </div>
                                            <div className="event-meta-item">
                                                <i className="fas fa-users"></i>
                                                <span>{participants.counts?.[event.id] || 0} partecipanti</span>
                                                {participants.counts?.[event.id] > 0 && (
                                                    <div className="stats-update-indicator">
                                                        {participants.counts[event.id]}
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div className="event-actions">
                                        <button 
                                            className={`action-btn ${favorites.includes(event.id) ? 'liked' : ''}`}
                                            onClick={() => toggleFavorite(event.id)}
                                        >
                                            <i className={favorites.includes(event.id) ? 'fas fa-heart' : 'far fa-heart'}></i>
                                            Mi piace
                                        </button>
                                        <button 
                                            className={`action-btn ${participants.userParticipations?.includes(event.id) ? 'joined' : ''}`}
                                            onClick={() => toggleJoin(event.id)}
                                        >
                                            <i className="fas fa-user-plus"></i>
                                            {participants.userParticipations?.includes(event.id) ? 'Iscritto âœ“' : 'Partecipa'}
                                        </button>
                                        <button 
                                            className="action-btn"
                                            onClick={() => {
                                                const shareText = `ðŸŽ‰ ${event.title}\nðŸ“ ${event.location}\nðŸ“… ${formatDate(event.event_date)}\n\nPartecipa anche tu su SocialSpot!`;
                                                const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(shareText)}`;
                                                window.open(whatsappUrl, '_blank');
                                            }}
                                        >
                                            <i className="fas fa-share-alt"></i>
                                            Condividi
                                        </button>
                                        <button 
                                            className="action-btn"
                                            onClick={() => setSelectedEvent(event)}
                                        >
                                            <i className="fas fa-info-circle"></i>
                                            Dettagli
                                        </button>
                                    </div>
                                </div>
                            ))
                        )}
                    </div>

                    {selectedEvent && (
                        <EventModal 
                            event={selectedEvent} 
                            onClose={() => setSelectedEvent(null)} 
                            user={user}
                            onJoinToggle={loadParticipants}
                        />
                    )}
                </div>
            );
        }

        // ðŸš€ COMPONENT SEARCH ULTIMATE
        function Search({ user }) {
            const [searchTerm, setSearchTerm] = useState('');
            const [events, setEvents] = useState([]);
            const [people, setPeople] = useState([]);
            const [filteredEvents, setFilteredEvents] = useState([]);
            const [filteredPeople, setFilteredPeople] = useState([]);
            const [loading, setLoading] = useState(false);
            const [selectedCategory, setSelectedCategory] = useState('');

            useEffect(() => {
                loadData();
            }, []);

            useEffect(() => {
                filterResults();
            }, [searchTerm, selectedCategory, events, people]);

            const loadData = async () => {
                setLoading(true);
                try {
                    const { data: eventsData, error: eventsError } = await supabase
                        .from('events')
                        .select(`
                            *,
                            profiles!events_creator_id_fkey(username)
                        `)
                        .order('event_date', { ascending: true });
                    
                    if (!eventsError) {
                        setEvents(eventsData || []);
                        setFilteredEvents(eventsData || []);
                    }

                    const allPeople = [
                        ...(realUsers || []),
                        ...DEMO_USERS.filter(demo => demo.id !== user.id)
                    ];
                    
                    setPeople(allPeople);
                    setFilteredPeople(allPeople);
                } catch (err) {
                    console.error('âŒ Errore caricamento dati:', err);
                } finally {
                    setLoading(false);
                }
            };

            const filterResults = () => {
                let filteredEvts = events;
                let filteredPpl = people;
                
                if (searchTerm) {
                    const term = searchTerm.toLowerCase();
                    filteredEvts = filteredEvts.filter(event => 
                        event.title.toLowerCase().includes(term) ||
                        event.description.toLowerCase().includes(term) ||
                        event.location.toLowerCase().includes(term) ||
                        event.profiles?.username.toLowerCase().includes(term)
                    );
                    
                    filteredPpl = filteredPpl.filter(person =>
                        person.username?.toLowerCase().includes(term) ||
                        person.bio?.toLowerCase().includes(term) ||
                        person.location?.toLowerCase().includes(term)
                    );
                }
                
                if (selectedCategory) {
                    filteredEvts = filteredEvts.filter(event => event.category === selectedCategory);
                }
                
                setFilteredEvents(filteredEvts);
                setFilteredPeople(filteredPpl);
            };

            return (
                <div className="search-page">
                    <input
                        type="text"
                        className="search-bar"
                        placeholder="ðŸ” Cerca eventi, luoghi, persone ULTIMATE..."
                        value={searchTerm}
                        onChange={(e) => setSearchTerm(e.target.value)}
                    />
                    
                    <div style={{marginBottom: '30px'}}>
                        <div className="section-title">
                            <i className="fas fa-filter"></i>
                            Filtra per categoria
                        </div>
                        <div style={{display: 'flex', flexWrap: 'wrap', gap: '10px', marginTop: '15px'}}>
                            <button 
                                className={`action-btn ${!selectedCategory ? 'joined' : ''}`}
                                onClick={() => setSelectedCategory('')}
                                style={{fontSize: '14px', padding: '10px 15px'}}
                            >
                                Tutte
                            </button>
                            {CATEGORIES.map(cat => (
                                <button 
                                    key={cat}
                                    className={`action-btn ${selectedCategory === cat ? 'joined' : ''}`}
                                    onClick={() => setSelectedCategory(cat)}
                                    style={{fontSize: '14px', padding: '10px 15px'}}
                                >
                                    {cat}
                                </button>
                            ))}
                        </div>
                    </div>

                    {filteredPeople.length > 0 && (
                        <div className="people-section">
                            <div className="section-title">
                                <i className="fas fa-users"></i>
                                Persone ({filteredPeople.length})
                                <span className="demo-badge">ULTIMATE</span>
                            </div>
                            <div className="people-grid">
                                {filteredPeople.slice(0, 8).map(person => (
                                    <div key={person.id} className="person-card">
                                        <div className="person-avatar ultimate-float">
                                            {person.username?.[0]?.toUpperCase() || 'U'}
                                        </div>
                                        <div className="person-name">{person.username || 'Utente'}</div>
                                        <div className="person-bio">{person.bio || 'Membro della community'}</div>
                                        <div className="person-location">
                                            <i className="fas fa-map-marker-alt"></i>
                                            {person.location || 'Italia'}
                                        </div>
                                        <button className="connect-btn">
                                            <i className="fas fa-user-plus"></i>
                                            Connetti
                                        </button>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}

                    {filteredEvents.length > 0 && (
                        <div style={{marginTop: '40px'}}>
                            <div className="section-title">
                                <i className="fas fa-calendar-alt"></i>
                                Eventi ({filteredEvents.length})
                                <span className="demo-badge">LIVE</span>
                            </div>
                            <div className="events-grid">
                                {filteredEvents.slice(0, 6).map(event => (
                                    <div key={event.id} className="event-card">
                                        <div className="live-badge">TROVATO</div>
                                        <div className="event-header">
                                            <div className="event-avatar">
                                                {event.profiles?.username?.[0]?.toUpperCase() || 'U'}
                                            </div>
                                            <div className="event-info">
                                                <div className="event-creator">{event.profiles?.username || 'Utente'}</div>
                                                <div className="event-location">
                                                    <i className="fas fa-map-marker-alt"></i>
                                                    {event.location}
                                                </div>
                                            </div>
                                            <div className="event-category">{event.category}</div>
                                        </div>
                                        <div className="event-content">
                                            <h3 className="event-title">{event.title}</h3>
                                            <p className="event-description">{event.description}</p>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}

                    {loading && (
                        <div className="loading">
                            <div className="spinner"></div>
                            <div className="loading-text">Ricerca ULTIMATE in corso...</div>
                        </div>
                    )}
                </div>
            );
        }

        // ðŸŒŸ COMPONENT CREATE EVENT ULTIMATE
        function CreateEvent({ user, onEventCreated }) {
            const [title, setTitle] = useState('');
            const [description, setDescription] = useState('');
            const [location, setLocation] = useState('');
            const [date, setDate] = useState('');
            const [category, setCategory] = useState('');
            const [genderPreference, setGenderPreference] = useState('both');
            const [minAge, setMinAge] = useState(18);
            const [maxAge, setMaxAge] = useState(99);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState('');
            const [success, setSuccess] = useState(false);

            const handleCreate = async (e) => {
                e.preventDefault();
                setLoading(true);
                setError('');
                setSuccess(false);
                
                try {
                    // PRIMA: Assicurati che il profilo esista SEMPRE
                    const { data: checkProfile, error: profileCheckError } = await supabase
                        .from('profiles')
                        .select('id')
                        .eq('id', user.id)
                        .maybeSingle();
                    
                    if (!checkProfile) {
                        console.log('Profilo mancante, lo creo ora...');
                        const { error: insertError } = await supabase.from('profiles').insert({
                            id: user.id,
                            email: user.email,
                            username: user.email.split('@')[0],
                            full_name: user.email.split('@')[0],
                            date_of_birth: '2000-01-01',
                            gender: 'prefer_not_to_say'
                        });
                        
                        if (insertError) {
                            console.error('Errore creazione profilo:', insertError);
                            setError('Impossibile creare il profilo. Riprova.');
                            setLoading(false);
                            return;
                        }
                        
                        // Aspetta 500ms per sicurezza
                        await new Promise(resolve => setTimeout(resolve, 500));
                    }
                    
                    // ORA crea l'evento
                    const { error: eventError } = await supabase.from('events').insert({
                        title,
                        description,
                        location,
                        event_date: date,
                        category,
                        gender_preference: genderPreference,
                        min_age: minAge,
                        max_age: maxAge,
                        creator_id: user.id
                    });
                    
                    if (eventError) {
                        setError(eventError.message);
                    } else {
                        setTitle('');
                        setDescription('');
                        setLocation('');
                        setDate('');
                        setCategory('');
                        setSuccess(true);
                        
                        setTimeout(() => {
                            setSuccess(false);
                            if (onEventCreated) onEventCreated();
                        }, 2000);
                    }
                } catch (err) {
                    setError(err.message);
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="create-page">
                    <div className="create-header">
                        <h1 className="create-title">ðŸš€ Crea Evento ULTIMATE</h1>
                        <p className="create-subtitle">Condividi un'esperienza incredibile con la community</p>
                    </div>
                    
                    <form onSubmit={handleCreate} className="create-form">
                        <div className="form-row">
                            <div className="form-group">
                                <label className="form-label">
                                    <i className="fas fa-calendar"></i>
                                    Titolo evento
                                </label>
                                <input 
                                    type="text" 
                                    className="form-input"
                                    value={title} 
                                    onChange={(e) => setTitle(e.target.value)} 
                                    required 
                                    placeholder="ðŸŽ¯ Inserisci un titolo accattivante" 
                                />
                            </div>
                            
                            <div className="form-group">
                                <label className="form-label">
                                    <i className="fas fa-tag"></i>
                                    Categoria
                                </label>
                                <select 
                                    className="form-input form-select"
                                    value={category} 
                                    onChange={(e) => setCategory(e.target.value)} 
                                    required
                                >
                                    <option value="" disabled>ðŸŽ¯ Seleziona categoria</option>
                                    {CATEGORIES.map((cat) => (
                                        <option key={cat} value={cat}>{cat}</option>
                                    ))}
                                </select>
                            </div>
                        </div>
                        
                        <div className="form-group form-group-full">
                            <label className="form-label">
                                <i className="fas fa-align-left"></i>
                                Descrizione
                            </label>
                            <textarea 
                                className="form-input form-textarea"
                                value={description} 
                                onChange={(e) => setDescription(e.target.value)} 
                                required 
                                placeholder="ðŸ“ Descrivi il tuo evento in dettaglio..."
                            />
                        </div>
                        
                        <div className="form-row">
                            <div className="form-group">
                                <label className="form-label">
                                    <i className="fas fa-map-marker-alt"></i>
                                    Luogo
                                </label>
                                <LocationInput
                                    value={location}
                                    onChange={setLocation}
                                    placeholder="ðŸ“ Seleziona una location"
                                />
                            </div>
                            
                            <div className="form-group">
                                <label className="form-label">
                                    <i className="fas fa-clock"></i>
                                    Data e ora
                                </label>
                                <input 
                                    type="datetime-local" 
                                    className="form-input"
                                    value={date} 
                                    onChange={(e) => setDate(e.target.value)} 
                                    required 
                                />
                            </div>
                        </div>
                        
                        <div className="form-row">
                            <div className="form-group">
                                <label className="form-label">
                                    <i className="fas fa-venus-mars"></i>
                                    Sesso preferito *
                                </label>
                                <select 
                                    className="form-input form-select"
                                    value={genderPreference} 
                                    onChange={(e) => setGenderPreference(e.target.value)} 
                                    required
                                >
                                    <option value="both">Entrambi</option>
                                    <option value="male">Solo uomini</option>
                                    <option value="female">Solo donne</option>
                                </select>
                            </div>
                            
                            <div className="form-group">
                                <label className="form-label">
                                    <i className="fas fa-users"></i>
                                    Fascia d'etÃ  *
                                </label>
                                <div style={{display: 'flex', gap: '10px', alignItems: 'center'}}>
                                    <input 
                                        type="number" 
                                        className="form-input"
                                        value={minAge} 
                                        onChange={(e) => setMinAge(parseInt(e.target.value))} 
                                        min="13"
                                        max="99"
                                        required 
                                        placeholder="Min"
                                        style={{width: '80px'}}
                                    />
                                    <span>-</span>
                                    <input 
                                        type="number" 
                                        className="form-input"
                                        value={maxAge} 
                                        onChange={(e) => setMaxAge(parseInt(e.target.value))} 
                                        min="13"
                                        max="99"
                                        required 
                                        placeholder="Max"
                                        style={{width: '80px'}}
                                    />
                                </div>
                            </div>
                        </div>
                        
                        {error && <div className="error-message">âŒ {error}</div>}
                        {success && <div className="success-message">âœ… Evento creato con successo! ðŸŽ‰</div>}
                        
                        <button type="submit" className="btn-ultimate" disabled={loading}>
                            {loading ? (
                                <>
                                    <i className="fas fa-spinner fa-spin"></i>
                                    Creazione in corso...
                                </>
                            ) : (
                                <>
                                    <i className="fas fa-rocket"></i>
                                    Crea evento ULTIMATE
                                </>
                            )}
                        </button>
                    </form>
                </div>
            );
        }

        // ðŸš€ COMPONENT PROFILE ULTIMATE
        function Profile({ user, onSignOut }) {
            const { stats, loading: statsLoading } = useRealTimeStats(user.id);
            const [profile, setProfile] = useState({ username: '', location: '', interests: [], bio: '' });
            const [myEvents, setMyEvents] = useState([]);
            const [loading, setLoading] = useState(true);
            const [isEditing, setIsEditing] = useState(false);
            const [editForm, setEditForm] = useState({ bio: '', location: '', current_city: '' });

            useEffect(() => {
                loadProfile();
                loadMyEvents();
            }, []);

            const loadProfile = async () => {
                try {
                    const { data, error } = await supabase
                        .from('profiles')
                        .select('*')
                        .eq('id', user.id)
                        .single();
                    
                    if (data) {
                        setProfile(data);
                        setEditForm({
                            bio: data.bio || '',
                            location: data.location || '',
                            current_city: data.current_city || ''
                        });
                    }
                } catch (err) {
                    console.error('âŒ Errore caricamento profilo:', err);
                } finally {
                    setLoading(false);
                }
            };
            
            const saveProfile = async () => {
                try {
                    const { error } = await supabase
                        .from('profiles')
                        .update({
                            bio: editForm.bio,
                            location: editForm.location,
                            current_city: editForm.current_city || editForm.location
                        })
                        .eq('id', user.id);
                    
                    if (!error) {
                        setProfile({...profile, ...editForm, current_city: editForm.current_city || editForm.location});
                        setIsEditing(false);
                        alert('âœ… Profilo aggiornato!');
                    }
                } catch (err) {
                    console.error('âŒ Errore salvataggio:', err);
                    alert('âŒ Errore durante il salvataggio');
                }
            };

            const loadMyEvents = async () => {
                try {
                    const { data, error } = await supabase
                        .from('events')
                        .select('*')
                        .eq('creator_id', user.id)
                        .order('event_date', { ascending: false });
                    
                    if (!error) {
                        setMyEvents(data || []);
                    }
                } catch (err) {
                    console.error('âŒ Errore caricamento eventi:', err);
                }
            };
            
            const deleteEvent = async (eventId) => {
                if (!confirm('Sei sicuro di voler eliminare questo evento?')) return;
                
                try {
                    const { error } = await supabase
                        .from('events')
                        .delete()
                        .eq('id', eventId);
                    
                    if (!error) {
                        setMyEvents(myEvents.filter(e => e.id !== eventId));
                        alert('âœ… Evento eliminato!');
                    }
                } catch (err) {
                    console.error('âŒ Errore eliminazione:', err);
                    alert('âŒ Impossibile eliminare l\'evento');
                }
            };

            if (loading) {
                return (
                    <div className="loading">
                        <div className="spinner"></div>
                        <div className="loading-text">Caricamento profilo ULTIMATE...</div>
                    </div>
                );
            }

            return (
                <div className="profile-page">
                    <div className="profile-header">
                        <div className="profile-avatar-large">
                            {profile.username?.[0]?.toUpperCase() || user.email[0].toUpperCase()}
                        </div>
                        <div className="profile-name">{profile.username || 'Utente ULTIMATE'}</div>
                        <div className="profile-email">{user.email}</div>
                        
                        <div className="profile-stats">
                            <div className="stat-item">
                                <div className="stat-number ultimate-glow">
                                    {statsLoading ? '...' : stats.events}
                                </div>
                                <div className="stat-label">Eventi Creati</div>
                            </div>
                            <div className="stat-item">
                                <div className="stat-number ultimate-glow">
                                    {statsLoading ? '...' : stats.followers}
                                </div>
                                <div className="stat-label">Followers</div>
                            </div>
                            <div className="stat-item">
                                <div className="stat-number ultimate-glow">
                                    {statsLoading ? '...' : stats.following}
                                </div>
                                <div className="stat-label">Following</div>
                            </div>
                        </div>
                        
                        <div className="profile-actions">
                            <button className="profile-btn" onClick={() => setIsEditing(true)}>
                                <i className="fas fa-edit"></i>
                                Modifica Profilo
                            </button>
                            <button className="profile-btn secondary" onClick={onSignOut}>
                                <i className="fas fa-sign-out-alt"></i>
                                Logout
                            </button>
                        </div>
                    </div>
                    
                    {/* Modal Edit Profile */}
                    {isEditing && (
                        <div className="modal-overlay" onClick={() => setIsEditing(false)}>
                            <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                                <div className="modal-header">
                                    <h2 className="modal-title">Modifica Profilo</h2>
                                    <button className="modal-close" onClick={() => setIsEditing(false)}>
                                        <i className="fas fa-times"></i>
                                    </button>
                                </div>
                                <div className="modal-body">
                                    <div className="form-group">
                                        <label className="form-label">
                                            <i className="fas fa-align-left"></i>
                                            Bio
                                        </label>
                                        <textarea
                                            className="form-input form-textarea"
                                            value={editForm.bio}
                                            onChange={(e) => setEditForm({...editForm, bio: e.target.value})}
                                            placeholder="Racconta qualcosa di te..."
                                            maxLength={200}
                                        />
                                        <small style={{color: 'var(--color-text-muted)', fontSize: '12px'}}>
                                            {editForm.bio.length}/200 caratteri
                                        </small>
                                    </div>
                                    <div className="form-group">
                                        <label className="form-label">
                                            <i className="fas fa-map-marker-alt"></i>
                                            CittÃ 
                                        </label>
                                        <input
                                            type="text"
                                            className="form-input"
                                            value={editForm.location}
                                            onChange={(e) => setEditForm({...editForm, location: e.target.value})}
                                            placeholder="Es: Milano, Lombardia"
                                        />
                                    </div>
                                    <div className="form-group">
                                        <label className="form-label">
                                            <i className="fas fa-plane"></i>
                                            CittÃ  attuale (viaggiatore)
                                        </label>
                                        <input
                                            type="text"
                                            className="form-input"
                                            value={editForm.current_city}
                                            onChange={(e) => setEditForm({...editForm, current_city: e.target.value})}
                                            placeholder="Lascia vuoto se sei a casa"
                                        />
                                    </div>
                                    <button className="btn-primary" onClick={saveProfile}>
                                        <i className="fas fa-save"></i>
                                        Salva Modifiche
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {myEvents.length > 0 && (
                        <div style={{
                            background: 'rgba(26, 26, 26, 0.8)',
                            backdropFilter: 'blur(20px)',
                            borderRadius: '25px',
                            padding: '30px',
                            border: '1px solid rgba(255, 255, 255, 0.1)',
                            marginBottom: '25px'
                        }}>
                            <div className="section-title">
                                <i className="fas fa-calendar-check"></i>
                                I miei eventi ({myEvents.length})
                                <span className="demo-badge">REAL</span>
                            </div>
                            <div className="events-grid">
                                {myEvents.slice(0, 10).map(event => (
                                    <div key={event.id} className="event-card">
                                        <div className="live-badge">MIO</div>
                                        <div className="event-content">
                                            <h3 className="event-title">{event.title}</h3>
                                            <p className="event-description">{event.description}</p>
                                            <div className="event-meta">
                                                <div className="event-meta-item">
                                                    <i className="fas fa-calendar"></i>
                                                    <span>{new Date(event.event_date).toLocaleDateString('it-IT')}</span>
                                                </div>
                                                <div className="event-meta-item">
                                                    <i className="fas fa-map-marker-alt"></i>
                                                    <span>{event.location}</span>
                                                </div>
                                            </div>
                                            <button 
                                                className="action-btn" 
                                                onClick={() => deleteEvent(event.id)}
                                                style={{
                                                    marginTop: '15px',
                                                    width: '100%',
                                                    background: 'rgba(239, 68, 68, 0.1)',
                                                    borderColor: 'rgba(239, 68, 68, 0.3)',
                                                    color: '#ef4444'
                                                }}
                                            >
                                                <i className="fas fa-trash"></i>
                                                Elimina evento
                                            </button>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // ðŸŒŸ COMPONENT NOTIFICHE ULTIMATE
        function Notifications({ user }) {
            const [notifications, setNotifications] = useState([]);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                loadNotifications();
                
                // Real-time listener
                const channel = supabase.channel('notifications_realtime')
                    .on('postgres_changes', {
                        event: 'INSERT',
                        schema: 'public',
                        table: 'notifications',
                        filter: `user_id=eq.${user.id}`
                    }, () => {
                        loadNotifications();
                    })
                    .subscribe();

                return () => supabase.removeChannel(channel);
            }, []);

            const loadNotifications = async () => {
                try {
                    const { data, error } = await supabase
                        .from('notifications')
                        .select('*')
                        .eq('user_id', user.id)
                        .order('created_at', { ascending: false })
                        .limit(50);
                    
                    if (!error) {
                        setNotifications(data || []);
                    }
                } catch (err) {
                    console.error('âŒ Errore caricamento notifiche:', err);
                } finally {
                    setLoading(false);
                }
            };

            const markAsRead = async (id) => {
                try {
                    await supabase
                        .from('notifications')
                        .update({ is_read: true })
                        .eq('id', id);
                    
                    setNotifications(notifications.map(notif => 
                        notif.id === id ? { ...notif, is_read: true } : notif
                    ));
                } catch (err) {
                    console.error('âŒ Errore aggiornamento notifica:', err);
                }
            };

            const formatTime = (timestamp) => {
                const diff = Date.now() - new Date(timestamp).getTime();
                const minutes = Math.floor(diff / 60000);
                const hours = Math.floor(diff / 3600000);
                const days = Math.floor(diff / 86400000);
                
                if (minutes < 1) return 'Ora';
                if (minutes < 60) return `${minutes} minuti fa`;
                if (hours < 24) return `${hours} ore fa`;
                return `${days} giorni fa`;
            };

            if (loading) {
                return (
                    <div className="loading">
                        <div className="spinner"></div>
                        <div className="loading-text">Caricamento notifiche...</div>
                    </div>
                );
            }

            return (
                <div className="notifications-page">
                    <div className="section-title">
                        <i className="fas fa-bell"></i>
                        Notifiche
                    </div>
                    
                    {notifications.length === 0 ? (
                        <div className="empty-state">
                            <i className="fas fa-bell-slash"></i>
                            <h3>Nessuna notifica</h3>
                            <p>Quando riceverai notifiche, appariranno qui</p>
                        </div>
                    ) : (
                        notifications.map(notif => (
                            <div 
                                key={notif.id} 
                                className={`notification-item ${!notif.is_read ? 'unread' : ''}`}
                            >
                                <div className="notification-avatar ultimate-float">
                                    <i className="fas fa-bell"></i>
                                </div>
                                <div className="notification-content">
                                    <div className="notification-text">
                                        <strong>{notif.title}</strong>
                                        <br/>
                                        {notif.content}
                                    </div>
                                    <div className="notification-time">{formatTime(notif.created_at)}</div>
                                </div>
                                {!notif.is_read && (
                                    <button 
                                        className="notification-action"
                                        onClick={() => markAsRead(notif.id)}
                                    >
                                        Segna come letto
                                    </button>
                                )}
                            </div>
                        ))
                    )}
                </div>
            );
        }

        // ðŸŒŸ COMPONENT LIVE STATS COUNTER
        function LiveStatsCounter({ user }) {
            const [stats, setStats] = useState({ activeEvents: 0, todayParticipants: 0, totalUsers: 0 });
            
            useEffect(() => {
                loadStats();
                const interval = setInterval(loadStats, 30000); // Update ogni 30 sec
                return () => clearInterval(interval);
            }, []);
            
            const loadStats = async () => {
                try {
                    // Eventi attivi
                    const { count: eventsCount } = await supabase
                        .from('events')
                        .select('*', { count: 'exact', head: true })
                        .eq('status', 'active')
                        .gte('event_date', new Date().toISOString());
                    
                    // Partecipanti oggi
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                    const { count: participantsCount } = await supabase
                        .from('event_participants')
                        .select('*', { count: 'exact', head: true })
                        .gte('joined_at', today.toISOString());
                    
                    // Utenti totali
                    const { count: usersCount } = await supabase
                        .from('profiles')
                        .select('*', { count: 'exact', head: true });
                    
                    setStats({
                        activeEvents: eventsCount || 0,
                        todayParticipants: participantsCount || 0,
                        totalUsers: usersCount || 0
                    });
                } catch (err) {
                    console.error('âŒ Errore stats:', err);
                }
            };
            
            return (
                <div style={{
                    background: 'linear-gradient(135deg, rgba(37, 99, 235, 0.15), rgba(249, 115, 22, 0.15))',
                    backdropFilter: 'blur(10px)',
                    padding: '12px 20px',
                    display: 'flex',
                    justifyContent: 'center',
                    gap: '30px',
                    borderBottom: '1px solid rgba(255, 255, 255, 0.1)',
                    position: 'sticky',
                    top: '70px',
                    zIndex: 100,
                    animation: 'slideDown 0.5s ease'
                }}>
                    <div style={{display: 'flex', alignItems: 'center', gap: '8px'}}>
                        <span style={{fontSize: '20px'}}>ðŸŽ‰</span>
                        <span style={{fontWeight: '600', color: 'var(--color-primary)'}}>{stats.activeEvents}</span>
                        <span style={{fontSize: '13px', color: 'var(--color-text-muted)'}}>eventi attivi</span>
                    </div>
                    <div style={{display: 'flex', alignItems: 'center', gap: '8px'}}>
                        <span style={{fontSize: '20px'}}>ðŸ‘¥</span>
                        <span style={{fontWeight: '600', color: 'var(--color-secondary)'}}>{stats.todayParticipants}</span>
                        <span style={{fontSize: '13px', color: 'var(--color-text-muted)'}}>iscritti oggi</span>
                    </div>
                    <div style={{display: 'flex', alignItems: 'center', gap: '8px'}}>
                        <span style={{fontSize: '20px'}}>ðŸŒŸ</span>
                        <span style={{fontWeight: '600', color: 'var(--color-accent)'}}>{stats.totalUsers}</span>
                        <span style={{fontSize: '13px', color: 'var(--color-text-muted)'}}>utenti</span>
                    </div>
                </div>
            );
        }

        // ðŸš€ COMPONENT PRINCIPALE APP ULTIMATE
        function App() {
            const [user, setUser] = useState(null);
            const [currentPage, setCurrentPage] = useState('feed');
            const [loading, setLoading] = useState(true);
            const [unreadNotifications, setUnreadNotifications] = useState(0);

            useEffect(() => {
                // Controlla sessione esistente
                supabase.auth.getSession().then(({ data: { session } }) => {
                    setUser(session?.user ?? null);
                    setLoading(false);
                });

                // Ascolta cambiamenti auth
                const { data: { subscription } } = supabase.auth.onAuthStateChange((_event, session) => {
                    setUser(session?.user ?? null);
                });

                return () => subscription.unsubscribe();
            }, []);
            
            // Counter notifiche non lette
            useEffect(() => {
                if (!user) return;
                
                const loadUnreadCount = async () => {
                    const { count } = await supabase
                        .from('notifications')
                        .select('*', { count: 'exact', head: true })
                        .eq('user_id', user.id)
                        .eq('is_read', false);
                    setUnreadNotifications(count || 0);
                };
                
                loadUnreadCount();
                
                // Real-time updates
                const channel = supabase.channel('notifications_count')
                    .on('postgres_changes', {
                        event: '*',
                        schema: 'public',
                        table: 'notifications',
                        filter: `user_id=eq.${user.id}`
                    }, loadUnreadCount)
                    .subscribe();
                
                return () => supabase.removeChannel(channel);
            }, [user]);

            const handleSignOut = async () => {
                await supabase.auth.signOut();
                setUser(null);
                setCurrentPage('feed');
            };

            if (loading) {
                return (
                    <div className="loading" style={{minHeight: '100vh'}}>
                        <div className="spinner"></div>
                        <div className="loading-text">Inizializzazione ULTIMATE...</div>
                    </div>
                );
            }

            if (!user) {
                return <Onboarding onComplete={setUser} />;
            }

            return (
                <div className="app">
                    {/* Top Bar ULTIMATE */}
                    <div className="top-bar">
                        <div className="logo-ultimate">
                            <div className="logo-icon">SP</div>
                            <div className="logo-text">SocialSpot</div>
                        </div>
                    </div>
                    
                    {/* Live Stats Counter */}
                    <LiveStatsCounter user={user} />

                    {/* Content ULTIMATE */}
                    <div className="content">
                        {currentPage === 'feed' && <Feed user={user} />}
                        {currentPage === 'search' && <Search user={user} />}
                        {currentPage === 'create' && <CreateEvent user={user} onEventCreated={() => setCurrentPage('feed')} />}
                        {currentPage === 'notifications' && <Notifications user={user} />}
                        {currentPage === 'profile' && <Profile user={user} onSignOut={handleSignOut} />}
                    </div>

                    {/* Bottom Navigation ULTIMATE */}
                    <div className="bottom-nav">
                        <div 
                            className={`nav-item ${currentPage === 'feed' ? 'active' : ''}`}
                            onClick={() => setCurrentPage('feed')}
                        >
                            <i className="fas fa-home"></i>
                            <span>Feed</span>
                        </div>
                        <div 
                            className={`nav-item ${currentPage === 'search' ? 'active' : ''}`}
                            onClick={() => setCurrentPage('search')}
                        >
                            <i className="fas fa-search"></i>
                            <span>Cerca</span>
                        </div>
                        <div 
                            className={`nav-item ${currentPage === 'create' ? 'active' : ''}`}
                            onClick={() => setCurrentPage('create')}
                        >
                            <i className="fas fa-plus-circle"></i>
                            <span>Crea</span>
                        </div>
                        <div 
                            className={`nav-item ${currentPage === 'notifications' ? 'active' : ''}`}
                            onClick={() => setCurrentPage('notifications')}
                        >
                            <i className="fas fa-bell"></i>
                            <span>Notifiche</span>
                            {unreadNotifications > 0 && <div className="nav-badge">{unreadNotifications}</div>}
                        </div>
                        <div 
                            className={`nav-item ${currentPage === 'profile' ? 'active' : ''}`}
                            onClick={() => setCurrentPage('profile')}
                        >
                            <i className="fas fa-user"></i>
                            <span>Profilo</span>
                        </div>
                    </div>
                </div>
            );
        }

        // ðŸš€ RENDER ULTIMATE
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
