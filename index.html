<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SocialSpot</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: #000; color: #fff; }
        .app { min-height: 100vh; background: #000; }
        .top-bar { position: fixed; top: 0; left: 0; right: 0; background: rgba(0,0,0,0.9); backdrop-filter: blur(20px); border-bottom: 1px solid #333; padding: 15px 20px; display: flex; align-items: center; justify-content: space-between; z-index: 999; }
        .logo-text { font-size: 24px; font-weight: bold; background: linear-gradient(135deg, #667eea, #764ba2); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .content { padding-top: 70px; padding-bottom: 90px; min-height: 100vh; }
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: rgba(0,0,0,0.9); backdrop-filter: blur(20px); border-top: 1px solid #333; display: flex; padding: 10px 0; z-index: 1000; }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; padding: 8px; cursor: pointer; color: #888; }
        .nav-item.active { color: #667eea; }
        .nav-item i { font-size: 24px; margin-bottom: 4px; }
        .nav-item span { font-size: 10px; font-weight: 500; }
        .onboarding { min-height: 100vh; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; padding: 20px; }
        .onboarding-card { background: rgba(255,255,255,0.1); backdrop-filter: blur(20px); border-radius: 20px; padding: 40px; text-align: center; max-width: 400px; width: 100%; border: 1px solid rgba(255,255,255,0.2); }
        .logo { width: 80px; height: 80px; background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 20px; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px; font-size: 32px; font-weight: bold; color: white; }
        .auth-tabs { display: flex; background: rgba(255,255,255,0.1); border-radius: 12px; padding: 4px; margin-bottom: 30px; }
        .auth-tab { flex: 1; padding: 12px; background: none; border: none; color: rgba(255,255,255,0.7); border-radius: 8px; cursor: pointer; font-weight: 500; }
        .auth-tab.active { background: rgba(255,255,255,0.2); color: white; }
        .form-group { margin-bottom: 20px; }
        .form-input { width: 100%; padding: 16px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 12px; color: white; font-size: 16px; }
        .form-input::placeholder { color: rgba(255,255,255,0.5); }
        .btn-primary { width: 100%; padding: 16px; background: linear-gradient(135deg, #667eea, #764ba2); border: none; border-radius: 12px; color: white; font-size: 16px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .feed { padding: 0; }
        .post { border-bottom: 1px solid #333; margin-bottom: 20px; }
        .post-header { display: flex; align-items: center; padding: 15px 20px; gap: 12px; }
        .post-avatar { width: 40px; height: 40px; border-radius: 50%; background: #667eea; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; }
        .post-info { flex: 1; }
        .post-username { font-weight: 600; font-size: 14px; }
        .post-location { font-size: 12px; color: #888; }
        .post-image { width: 100%; aspect-ratio: 1; background: #1a1a1a; display: flex; align-items: center; justify-content: center; color: #666; font-size: 48px; }
        .post-actions { display: flex; padding: 15px 20px; gap: 15px; }
        .action-btn { background: none; border: none; color: white; font-size: 24px; cursor: pointer; }
        .action-btn.liked { color: #ff3b30; }
        .post-stats { padding: 0 20px; font-size: 14px; font-weight: 600; }
        .post-caption { padding: 8px 20px; font-size: 14px; }
        .post-time { padding: 8px 20px 15px; font-size: 12px; color: #888; }
        .loading { display: flex; align-items: center; justify-content: center; min-height: 50vh; }
        .spinner { width: 40px; height: 40px; border: 3px solid #333; border-top: 3px solid #667eea; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .search-page, .create-page, .notifications-page, .profile-page { padding: 20px; }
        .search-bar { background: #1a1a1a; border: none; border-radius: 12px; padding: 12px 16px; color: white; width: 100%; margin-bottom: 20px; font-size: 16px; }
        .create-options { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-top: 40px; }
        .create-option { background: #1a1a1a; border: none; border-radius: 20px; padding: 40px 20px; color: white; cursor: pointer; text-align: center; }
        .create-option i { font-size: 48px; margin-bottom: 15px; display: block; }
        .notification-item { display: flex; align-items: center; padding: 15px 0; border-bottom: 1px solid #333; gap: 12px; }
        .notification-avatar { width: 40px; height: 40px; border-radius: 50%; background: #667eea; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; }
        .notification-content { flex: 1; }
        .notification-text { font-size: 14px; margin-bottom: 5px; }
        .notification-time { font-size: 12px; color: #888; }
        .profile-header { text-align: center; margin-bottom: 30px; }
        .profile-avatar-large { width: 100px; height: 100px; border-radius: 50%; background: #667eea; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px; font-size: 36px; color: white; font-weight: bold; }
        .profile-stats { display: flex; justify-content: center; gap: 30px; margin: 20px 0; }
        .stat-item { text-align: center; }
        .stat-number { font-size: 20px; font-weight: bold; }
        .stat-label { font-size: 12px; color: #888; }
        .profile-actions { display: flex; gap: 10px; margin: 20px 0; }
        .profile-btn { flex: 1; padding: 10px; background: #667eea; border: none; border-radius: 8px; color: white; font-weight: 600; cursor: pointer; }
        .profile-btn.secondary { background: #333; }
        .profile-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; margin-top: 20px; }
        .profile-post { aspect-ratio: 1; background: #1a1a1a; display: flex; align-items: center; justify-content: center; color: #666; cursor: pointer; }
        .error-message { background: rgba(239,68,68,0.2); color: #ff6b6b; padding: 12px; border-radius: 8px; margin-bottom: 20px; font-size: 14px; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const SUPABASE_URL = 'https://wsmjnssfmujdfgthyizw.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndzbWpuc3NmbXVqZGZndGh5aXp3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA4ODA3NjIsImV4cCI6MjA2NjQ1Njc2Mn0.t91X-fGIolFBPnhr5_sexJMqzgdCDmXuEUXiL_pFId4';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        const { useState, useEffect } = React;

        function Onboarding({ onComplete }) {
            const [isSignIn, setIsSignIn] = useState(true);
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState('');

            const handleAuth = async (e) => {
                e.preventDefault();
                setLoading(true);
                setError('');
                try {
                    let result;
                    if (isSignIn) {
                        result = await supabase.auth.signInWithPassword({ email, password });
                    } else {
                        result = await supabase.auth.signUp({ email, password });
                    }
                    if (result.error) {
                        setError(result.error.message);
                    } else {
                        onComplete(result.data.user);
                    }
                } catch (err) {
                    setError(err.message);
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="onboarding">
                    <div className="onboarding-card">
                        <div className="logo">SS</div>
                        <h1>SocialSpot</h1>
                        <p>Scopri eventi e connettiti</p>
                        <div className="auth-tabs">
                            <button className={`auth-tab ${isSignIn ? 'active' : ''}`} onClick={() => setIsSignIn(true)}>Accedi</button>
                            <button className={`auth-tab ${!isSignIn ? 'active' : ''}`} onClick={() => setIsSignIn(false)}>Registrati</button>
                        </div>
                        <form onSubmit={handleAuth}>
                            <div className="form-group">
                                <input type="email" className="form-input" placeholder="Email" value={email} onChange={(e) => setEmail(e.target.value)} required />
                            </div>
                            <div className="form-group">
                                <input type="password" className="form-input" placeholder="Password" value={password} onChange={(e) => setPassword(e.target.value)} required />
                            </div>
                            {error && <div className="error-message">{error}</div>}
                            <button type="submit" className="btn-primary" disabled={loading}>
                                {loading ? <i className="fas fa-spinner fa-spin"></i> : <i className="fas fa-sign-in-alt"></i>}
                                {isSignIn ? 'Accedi' : 'Registrati'}
                            </button>
                        </form>
                    </div>
                </div>
            );
        }

        function Feed() {
            const [posts, setPosts] = useState([]);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                setTimeout(() => {
                    setPosts([
                        { id: 1, username: 'marco_events', location: 'Milano', likes: 142, caption: 'Partita di calcetto domani sera!', time: '2 ore fa', liked: false },
                        { id: 2, username: 'anna_music', location: 'Roma', likes: 89, caption: 'Concerto jazz questo weekend!', time: '5 ore fa', liked: true }
                    ]);
                    setLoading(false);
                }, 1000);
            }, []);

            const toggleLike = (postId) => {
                setPosts(prev => prev.map(post => 
                    post.id === postId ? { ...post, liked: !post.liked, likes: post.liked ? post.likes - 1 : post.likes + 1 } : post
                ));
            };

            if (loading) return <div className="loading"><div className="spinner"></div></div>;

            return (
                <div className="feed">
                    {posts.map(post => (
                        <div key={post.id} className="post">
                            <div className="post-header">
                                <div className="post-avatar">{post.username[0].toUpperCase()}</div>
                                <div className="post-info">
                                    <div className="post-username">{post.username}</div>
                                    <div className="post-location">{post.location}</div>
                                </div>
                            </div>
                            <div className="post-image"><i className="fas fa-image"></i></div>
                            <div className="post-actions">
                                <button className={`action-btn ${post.liked ? 'liked' : ''}`} onClick={() => toggleLike(post.id)}>
                                    <i className={post.liked ? 'fas fa-heart' : 'far fa-heart'}></i>
                                </button>
                                <button className="action-btn"><i className="far fa-comment"></i></button>
                            </div>
                            <div className="post-stats">{post.likes} mi piace</div>
                            <div className="post-caption"><strong>{post.username}</strong> {post.caption}</div>
                            <div className="post-time">{post.time}</div>
                        </div>
                    ))}
                </div>
            );
        }

        function Search() {
            const [searchTerm, setSearchTerm] = useState('');
            return (
                <div className="search-page">
                    <input type="text" className="search-bar" placeholder="Cerca eventi..." value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} />
                    <div>Risultati per: {searchTerm}</div>
                </div>
            );
        }

        function Create() {
            return (
                <div className="create-page">
                    <h2>Crea contenuto</h2>
                    <div className="create-options">
                        <button className="create-option"><i className="fas fa-calendar-plus"></i><div>Evento</div></button>
                        <button className="create-option"><i className="fas fa-camera"></i><div>Foto</div></button>
                    </div>
                </div>
            );
        }

        function Notifications() {
            const notifications = [
                { id: 1, username: 'marco_events', text: 'ha messo mi piace', time: '2m' },
                { id: 2, username: 'anna_music', text: 'ha iniziato a seguirti', time: '1h' }
            ];

            return (
                <div className="notifications-page">
                    <h2>Notifiche</h2>
                    {notifications.map(notif => (
                        <div key={notif.id} className="notification-item">
                            <div className="notification-avatar">{notif.username[0].toUpperCase()}</div>
                            <div className="notification-content">
                                <div className="notification-text"><strong>{notif.username}</strong> {notif.text}</div>
                                <div className="notification-time">{notif.time}</div>
                            </div>
                        </div>
                    ))}
                </div>
            );
        }

        function Profile({ user, onSignOut }) {
            return (
                <div className="profile-page">
                    <div className="profile-header">
                        <div className="profile-avatar-large">{user.email[0].toUpperCase()}</div>
                        <h2>{user.email.split('@')[0]}</h2>
                        <div className="profile-stats">
                            <div className="stat-item"><div className="stat-number">12</div><div className="stat-label">Eventi</div></div>
                            <div className="stat-item"><div className="stat-number">1.2k</div><div className="stat-label">Follower</div></div>
                            <div className="stat-item"><div className="stat-number">847</div><div className="stat-label">Seguiti</div></div>
                        </div>
                        <div className="profile-actions">
                            <button className="profile-btn">Modifica</button>
                            <button className="profile-btn secondary" onClick={onSignOut}>Logout</button>
                        </div>
                    </div>
                    <div className="profile-grid">
                        {Array.from({length: 9}).map((_, i) => (
                            <div key={i} className="profile-post"><i className="fas fa-calendar"></i></div>
                        ))}
                    </div>
                </div>
            );
        }

        function MainApp({ user, onSignOut }) {
            const [currentPage, setCurrentPage] = useState('feed');
            const pages = {
                feed: <Feed />,
                search: <Search />,
                create: <Create />,
                notifications: <Notifications />,
                profile: <Profile user={user} onSignOut={onSignOut} />
            };

            return (
                <div className="app">
                    <div className="top-bar">
                        <div className="logo-text">SocialSpot</div>
                    </div>
                    <div className="content">{pages[currentPage]}</div>
                    <div className="bottom-nav">
                        <div className={`nav-item ${currentPage === 'feed' ? 'active' : ''}`} onClick={() => setCurrentPage('feed')}>
                            <i className="fas fa-home"></i><span>Home</span>
                        </div>
                        <div className={`nav-item ${currentPage === 'search' ? 'active' : ''}`} onClick={() => setCurrentPage('search')}>
                            <i className="fas fa-search"></i><span>Cerca</span>
                        </div>
                        <div className={`nav-item ${currentPage === 'create' ? 'active' : ''}`} onClick={() => setCurrentPage('create')}>
                            <i className="fas fa-plus"></i><span>Crea</span>
                        </div>
                        <div className={`nav-item ${currentPage === 'notifications' ? 'active' : ''}`} onClick={() => setCurrentPage('notifications')}>
                            <i className="fas fa-heart"></i><span>Notifiche</span>
                        </div>
                        <div className={`nav-item ${currentPage === 'profile' ? 'active' : ''}`} onClick={() => setCurrentPage('profile')}>
                            <i className="fas fa-user"></i><span>Profilo</span>
                        </div>
                    </div>
                </div>
            );
        }

        function App() {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                supabase.auth.getSession().then(({ data: { session } }) => {
                    setUser(session?.user ?? null);
                    setLoading(false);
                });
                const { data: { subscription } } = supabase.auth.onAuthStateChange((_event, session) => {
                    setUser(session?.user ?? null);
                });
                return () => subscription.unsubscribe();
            }, []);

            const handleSignOut = async () => {
                await supabase.auth.signOut();
                setUser(null);
            };

            if (loading) return <div className="loading"><div className="spinner"></div></div>;
            if (!user) return <Onboarding onComplete={setUser} />;
            return <MainApp user={user} onSignOut={handleSignOut} />;
        }

        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);
    </script>
</body>
</html>
