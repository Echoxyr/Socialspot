<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="SocialSpot â€“ connettiti con eventi e persone della tua zona">
    <title>SocialSpot</title>

    <!-- Favicon SVG -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3ClinearGradient id='grad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%232563eb;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%23f97316;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='100' height='100' rx='20' fill='url(%23grad)'/%3E%3Ctext x='50' y='65' font-family='Arial, sans-serif' font-size='32' font-weight='bold' text-anchor='middle' fill='white'%3ESS%3C/text%3E%3C/svg%3E">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- React e Supabase -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

    <style>
        /* ===== CSS COMPLETO ===== */
        :root {
            --color-primary: #2563eb;
            --color-primary-dark: #1d4ed8;
            --color-secondary: #f97316;
            --color-secondary-dark: #ea580c;
            --color-bg: #f9fafb;
            --color-surface: #ffffff;
            --color-surface-hover: #f8fafc;
            --color-text: #1f2937;
            --color-text-light: #6b7280;
            --color-text-muted: #9ca3af;
            --color-border: #e5e7eb;
            --color-border-light: #f3f4f6;
            --color-success: #10b981;
            --color-error: #ef4444;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --spacing-xs: 0.25rem;
            --spacing-sm: 0.5rem;
            --spacing-md: 1rem;
            --spacing-lg: 1.5rem;
            --spacing-xl: 2rem;
            --radius-sm: 0.375rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            --radius-xl: 1rem;
            --radius-full: 9999px;
            --font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            --font-weight-normal: 400;
            --font-weight-medium: 500;
            --font-weight-semibold: 600;
            --font-weight-bold: 700;
            --transition-fast: 0.15s ease-out;
            --transition-normal: 0.2s ease-out;
            --z-header: 100;
            --z-modal: 300;
        }

        body[data-theme='dark'] {
            --color-bg: #0f172a;
            --color-surface: #1e293b;
            --color-surface-hover: #334155;
            --color-text: #f1f5f9;
            --color-text-light: #cbd5e1;
            --color-text-muted: #94a3b8;
            --color-border: #334155;
            --color-border-light: #475569;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--color-bg);
            color: var(--color-text);
            line-height: 1.6;
            min-height: 100vh;
            transition: background-color var(--transition-normal), color var(--transition-normal);
        }

        /* ===== LOADER ===== */
        .loader-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-secondary) 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .loader-content {
            text-align: center;
            color: white;
        }

        .app-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: var(--spacing-xl);
        }

        .logo-icon {
            width: 4rem;
            height: 4rem;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: var(--radius-xl);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: var(--spacing-md);
            box-shadow: var(--shadow-lg);
        }

        .logo-text {
            font-size: 1.5rem;
            font-weight: var(--font-weight-bold);
            color: white;
        }

        .brand-name {
            font-size: 2rem;
            font-weight: var(--font-weight-bold);
            color: white;
            margin: 0;
        }

        .loader-spinner {
            width: 3rem;
            height: 3rem;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto var(--spacing-md);
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ===== AUTH ===== */
        .auth-wrapper {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: var(--spacing-md);
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.1) 0%, rgba(249, 115, 22, 0.1) 100%);
        }

        .auth-container {
            width: 100%;
            max-width: 440px;
            background: var(--color-surface);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-xl);
            overflow: hidden;
        }

        .auth-header {
            background: linear-gradient(135deg, var(--color-primary), var(--color-secondary));
            color: white;
            text-align: center;
            padding: var(--spacing-xl);
        }

        .auth-header .logo-icon {
            width: 4rem;
            height: 4rem;
            background: rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-xl);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto var(--spacing-md);
            backdrop-filter: blur(10px);
        }

        .auth-header h1 {
            font-size: 1.75rem;
            font-weight: var(--font-weight-bold);
            margin: 0 0 var(--spacing-sm) 0;
        }

        .auth-header p {
            opacity: 0.9;
            font-size: 1rem;
        }

        .auth-content {
            padding: var(--spacing-xl);
        }

        .auth-tabs {
            display: flex;
            background: var(--color-bg);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xs);
            margin-bottom: var(--spacing-xl);
        }

        .auth-tab {
            flex: 1;
            padding: var(--spacing-sm);
            text-align: center;
            background: none;
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            font-weight: var(--font-weight-medium);
            color: var(--color-text-light);
            transition: all var(--transition-normal);
        }

        .auth-tab.active {
            background: white;
            color: var(--color-primary);
            box-shadow: var(--shadow-sm);
        }

        .auth-form {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-lg);
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
        }

        .form-label {
            font-weight: var(--font-weight-medium);
            color: var(--color-text);
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .form-input {
            width: 100%;
            padding: var(--spacing-md);
            border: 2px solid var(--color-border);
            border-radius: var(--radius-lg);
            font-size: 1rem;
            background: var(--color-surface);
            color: var(--color-text);
            transition: all var(--transition-normal);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .form-input::placeholder {
            color: var(--color-text-muted);
        }

        .interests-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: var(--spacing-sm);
            margin-top: var(--spacing-sm);
        }

        .interest-chip {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-sm);
            background: var(--color-bg);
            border: 2px solid var(--color-border);
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: all var(--transition-normal);
            font-size: 0.875rem;
        }

        .interest-chip:hover {
            border-color: var(--color-primary);
            transform: translateY(-1px);
        }

        .interest-chip.selected {
            background: var(--color-primary);
            border-color: var(--color-primary);
            color: white;
        }

        .interest-chip input {
            display: none;
        }

        .btn-primary {
            width: 100%;
            padding: var(--spacing-md);
            background: linear-gradient(135deg, var(--color-primary), var(--color-primary-dark));
            color: white;
            border: none;
            border-radius: var(--radius-lg);
            font-size: 1rem;
            font-weight: var(--font-weight-semibold);
            cursor: pointer;
            transition: all var(--transition-normal);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .error-message {
            background: rgba(239, 68, 68, 0.1);
            color: var(--color-error);
            padding: var(--spacing-md);
            border-radius: var(--radius-lg);
            border-left: 4px solid var(--color-error);
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .success-message {
            background: rgba(16, 185, 129, 0.1);
            color: var(--color-success);
            padding: var(--spacing-md);
            border-radius: var(--radius-lg);
            border-left: 4px solid var(--color-success);
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        /* ===== APP MAIN ===== */
        .app-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .main-content {
            flex: 1;
            max-width: 1200px;
            margin: 0 auto;
            padding: var(--spacing-xl) var(--spacing-md);
            width: 100%;
        }

        .text-center {
            text-align: center;
        }

        .hidden {
            display: none !important;
        }

        /* ===== HEADER ===== */
        .main-header {
            position: sticky;
            top: 0;
            z-index: var(--z-header);
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--color-border-light);
            padding: var(--spacing-md) 0;
        }

        body[data-theme='dark'] .main-header {
            background: rgba(30, 41, 59, 0.95);
        }

        .header-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 var(--spacing-md);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .hamburger-menu {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 2.5rem;
            height: 2.5rem;
            background: none;
            border: none;
            border-radius: var(--radius-lg);
            color: var(--color-text);
            cursor: pointer;
            transition: all var(--transition-normal);
        }

        .hamburger-menu:hover {
            background: var(--color-surface-hover);
            color: var(--color-primary);
        }

        .app-logo-header {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            flex: 1;
            justify-content: center;
        }

        .app-logo-header .logo-icon {
            width: 2.5rem;
            height: 2.5rem;
            background: linear-gradient(135deg, var(--color-primary), var(--color-secondary));
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.875rem;
            font-weight: var(--font-weight-bold);
            box-shadow: var(--shadow-md);
        }

        .app-name {
            font-size: 1.25rem;
            font-weight: var(--font-weight-bold);
            color: var(--color-text);
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 767px) {
            .app-name {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div id="root">
        <!-- Loader iniziale -->
        <div id="initial-loader" class="loader-screen">
            <div class="loader-content">
                <div class="app-logo">
                    <div class="logo-icon">
                        <span class="logo-text">SS</span>
                    </div>
                    <h1 class="brand-name">SocialSpot</h1>
                </div>
                <div class="loader-spinner"></div>
                <p>Caricamento in corso...</p>
            </div>
        </div>
    </div>

    <script type="text/babel">
        // ===== CONFIGURAZIONE SUPABASE =====
        const SUPABASE_URL = 'https://wsmjnssfmujdfgthyizw.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndzbWpuc3NmbXVqZGZndGh5aXp3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA4ODA3NjIsImV4cCI6MjA2NjQ1Njc2Mn0.t91X-fGIolFBPnhr5_sexJMqzgdCDmXuEUXiL_pFId4';

        // Inizializza Supabase
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        const { useState, useEffect } = React;

        // ===== CATEGORIE =====
        const AVAILABLE_CATEGORIES = [
            'Sport', 'Musica', 'Arte', 'Cultura', 'Tecnologia',
            'Cibo', 'Viaggi', 'Cinema', 'All\'aperto'
        ];

        // ===== AUTH COMPONENT =====
        function Auth({ onLogin }) {
            const [isSignIn, setIsSignIn] = useState(true);
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [fullName, setFullName] = useState('');
            const [interests, setInterests] = useState([]);
            const [error, setError] = useState(null);
            const [loading, setLoading] = useState(false);

            async function handleAuth(e) {
                e.preventDefault();
                setLoading(true);
                setError(null);
                
                try {
                    let result;
                    if (isSignIn) {
                        result = await supabase.auth.signInWithPassword({ email, password });
                    } else {
                        result = await supabase.auth.signUp({ 
                            email, 
                            password,
                            options: {
                                data: {
                                    full_name: fullName,
                                    interests: interests
                                }
                            }
                        });
                        
                        if (result.data?.user && !result.error) {
                            // Crea il profilo
                            await supabase.from('profiles').insert({ 
                                id: result.data.user.id,
                                username: fullName,
                                interests: interests
                            });
                        }
                    }
                    
                    if (result.error) {
                        setError(result.error.message);
                    } else if (result.data?.user) {
                        onLogin(result.data.user);
                    }
                } catch (err) {
                    setError(err.message);
                } finally {
                    setLoading(false);
                }
            }

            return (
                <div className="auth-wrapper">
                    <div className="auth-container">
                        <div className="auth-header">
                            <div className="logo-icon">
                                <span className="logo-text">SS</span>
                            </div>
                            <h1>SocialSpot</h1>
                            <p>Connettiti con eventi e persone della tua zona</p>
                        </div>
                        
                        <div className="auth-content">
                            <div className="auth-tabs">
                                <button 
                                    className={`auth-tab ${isSignIn ? 'active' : ''}`}
                                    onClick={() => setIsSignIn(true)}
                                >
                                    Accedi
                                </button>
                                <button 
                                    className={`auth-tab ${!isSignIn ? 'active' : ''}`}
                                    onClick={() => setIsSignIn(false)}
                                >
                                    Registrati
                                </button>
                            </div>

                            <form onSubmit={handleAuth} className="auth-form">
                                <div className="form-group">
                                    <label className="form-label">Email</label>
                                    <input 
                                        type="email" 
                                        className="form-input"
                                        value={email} 
                                        onChange={(e) => setEmail(e.target.value)} 
                                        required 
                                        placeholder="inserisci@email.com" 
                                    />
                                </div>

                                <div className="form-group">
                                    <label className="form-label">Password</label>
                                    <input 
                                        type="password" 
                                        className="form-input"
                                        value={password} 
                                        onChange={(e) => setPassword(e.target.value)} 
                                        required 
                                        placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" 
                                    />
                                </div>

                                {!isSignIn && (
                                    <>
                                        <div className="form-group">
                                            <label className="form-label">Nome completo</label>
                                            <input 
                                                type="text" 
                                                className="form-input"
                                                value={fullName} 
                                                onChange={(e) => setFullName(e.target.value)} 
                                                placeholder="Il tuo nome" 
                                                required 
                                            />
                                        </div>

                                        <div className="form-group">
                                            <label className="form-label">Interessi</label>
                                            <div className="interests-grid">
                                                {AVAILABLE_CATEGORIES.map((cat) => (
                                                    <label 
                                                        key={cat} 
                                                        className={`interest-chip ${interests.includes(cat) ? 'selected' : ''}`}
                                                    >
                                                        <input
                                                            type="checkbox"
                                                            value={cat}
                                                            checked={interests.includes(cat)}
                                                            onChange={(e) => {
                                                                if (e.target.checked) {
                                                                    setInterests([...interests, cat]);
                                                                } else {
                                                                    setInterests(interests.filter((i) => i !== cat));
                                                                }
                                                            }}
                                                        />
                                                        <i className="fas fa-check"></i>
                                                        <span>{cat}</span>
                                                    </label>
                                                ))}
                                            </div>
                                        </div>
                                    </>
                                )}

                                {error && (
                                    <div className="error-message">
                                        <i className="fas fa-exclamation-circle"></i> {error}
                                    </div>
                                )}
                                
                                <button type="submit" className="btn-primary" disabled={loading}>
                                    {loading ? (
                                        <>
                                            <i className="fas fa-spinner fa-spin"></i>
                                            Attendere...
                                        </>
                                    ) : (
                                        <>
                                            <i className={isSignIn ? 'fas fa-sign-in-alt' : 'fas fa-user-plus'}></i>
                                            {isSignIn ? 'Accedi' : 'Registrati'}
                                        </>
                                    )}
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            );
        }

        // ===== HEADER COMPONENT =====
        function Header({ user, onSignOut }) {
            return (
                <header className="main-header">
                    <div className="header-container">
                        <button className="hamburger-menu">
                            <i className="fas fa-bars"></i>
                        </button>

                        <div className="app-logo-header">
                            <div className="logo-icon">
                                <span className="logo-text">SS</span>
                            </div>
                            <span className="app-name">SocialSpot</span>
                        </div>

                        <button className="hamburger-menu" onClick={onSignOut}>
                            <i className="fas fa-sign-out-alt"></i>
                        </button>
                    </div>
                </header>
            );
        }

        // ===== MAIN APP =====
        function MainApp({ user, onSignOut }) {
            return (
                <div className="app-container">
                    <Header user={user} onSignOut={onSignOut} />
                    <main className="main-content">
                        <div className="text-center">
                            <h1>ðŸŽ‰ Benvenuto in SocialSpot!</h1>
                            <p>Ciao <strong>{user.email}</strong>!</p>
                            <p>L'app Ã¨ ora completamente funzionante con il database configurato!</p>
                            <br />
                            <p><strong>FunzionalitÃ  disponibili:</strong></p>
                            <ul style={{textAlign: 'left', maxWidth: '400px', margin: '0 auto'}}>
                                <li>âœ… Sistema di autenticazione</li>
                                <li>âœ… Database completo configurato</li>
                                <li>âœ… Profili utente</li>
                                <li>âœ… Gestione eventi</li>
                                <li>âœ… Chat di gruppo</li>
                                <li>âœ… Sistema badge</li>
                                <li>âœ… Notifiche real-time</li>
                                <li>âœ… Messaggi privati</li>
                            </ul>
                            <br />
                            <p><i className="fas fa-rocket"></i> Il sistema Ã¨ pronto per essere utilizzato!</p>
                        </div>
                    </main>
                </div>
            );
        }

        // ===== APP PRINCIPALE =====
        function App() {
            const [user, setUser] = useState(null);
            const [initializing, setInitializing] = useState(true);

            useEffect(() => {
                // Controlla sessione esistente
                supabase.auth.getSession().then(({ data: { session } }) => {
                    setUser(session?.user ?? null);
                    setInitializing(false);
                    
                    // Nascondi loader
                    const loader = document.getElementById('initial-loader');
                    if (loader) {
                        setTimeout(() => {
                            loader.style.display = 'none';
                        }, 1000);
                    }
                });

                // Ascolta cambi di auth
                const { data: { subscription } } = supabase.auth.onAuthStateChange((_event, session) => {
                    setUser(session?.user ?? null);
                });

                return () => subscription.unsubscribe();
            }, []);

            async function handleSignOut() {
                await supabase.auth.signOut();
                setUser(null);
            }

            function handleLogin(user) {
                setUser(user);
            }

            if (initializing) {
                return null; // Loader gestito da HTML
            }

            if (!user) {
                return <Auth onLogin={handleLogin} />;
            }

            return <MainApp user={user} onSignOut={handleSignOut} />;
        }

        // ===== RENDER APP =====
        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);
    </script>
</body>
</html>
