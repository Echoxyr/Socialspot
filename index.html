React.createElement('p', { className: "text-gray-600" },
                                    new Date(event.event_date).toLocaleDateString('it-IT', { 
                                        weekday: 'long',
                                        day: 'numeric', 
                                        month: 'long',
                                        year: 'numeric'
                                    })
                                )
                            )
                        ),
                        React.createElement('div', { className: "flex items-center gap-3 p-4 bg-gray-50 rounded-lg" },
                            React.createElement(ClockIcon),
                            React.createElement('div', null,
                                React.createElement('p', { className: "font-medium" }, "Orario"),
                                React.createElement('p', { className: "text-gray-600" }, event.event_time?.substring(0, 5))
                            )
                        ),
                        React.createElement('div', { className: "flex items-center gap-3 p-4 bg-gray-50 rounded-lg" },
                            React.createElement(MapPinIcon),
                            React.createElement('div', null,
                                React.createElement('p', { className: "font-medium" }, "Luogo"),
                                React.createElement('p', { className: "text-gray-600" }, event.location)
                            )
                        ),
                        React.createElement('div', { className: "flex items-center gap-3 p-4 bg-gray-50 rounded-lg" },
                            React.createElement(UsersIcon),
                            React.createElement('div', null,
                                React.createElement('p', { className: "font-medium" }, "Partecipanti"),
                                React.createElement('p', { className: "text-gray-600" }, 
                                    participants.length, "/", event.max_participants, " persone"
                                )
                            )
                        ),
                        event.price && React.createElement('div', { className: "flex items-center gap-3 p-4 bg-green-50 rounded-lg" },
                            React.createElement('div', { className: "w-5 h-5 bg-green-600 rounded-full flex items-center justify-center" },
                                React.createElement('span', { className: "text-white text-xs font-bold" }, "€")
                            ),
                            React.createElement('div', null,
                                React.createElement('p', { className: "font-medium" }, "Prezzo"),
                                React.createElement('p', { className: "text-gray-600" }, event.price)
                            )
                        )
                    ),
                    participants.length > 0 && React.createElement('div', null,
                        React.createElement('h3', { className: "font-semibold text-gray-900 mb-3" },
                            "Partecipanti (", participants.length, ")"
                        ),
                        React.createElement('div', { className: "space-y-2" },
                            participants.map(participant =>
                                React.createElement('div', {
                                    key: participant.id,
                                    className: "flex items-center gap-3 p-3 bg-gray-50 rounded-lg"
                                },
                                    React.createElement('div', { className: "w-8 h-8 rounded-full bg-gradient-blue flex items-center justify-center text-white text-sm font-bold" },
                                        (participant.profiles?.username?.substring(0, 2)?.toUpperCase() || "U")
                                    ),
                                    React.createElement('div', null,
                                        React.createElement('p', { className: "font-medium text-sm" }, participant.profiles?.full_name),
                                        React.createElement('p', { className: "text-xs text-gray-500" }, "@", participant.profiles?.username)
                                    ),
                                    participant.user_id === event.organizer_id && React.createElement('span', { className: "ml-auto text-xs bg-blue-100 text-blue-600 px-2 py-1 rounded-full" },
                                        "Organizzatore"
                                    )
                                )
                            )
                        )
                    )
                ),
                React.createElement('div', { className: "sticky bottom-0 bg-white border-t border-gray-200 p-4 space-y-3" },
                    canAccessChat && React.createElement('button', {
                        onClick: () => setShowChat(true),
                        className: "w-full btn-secondary py-3 rounded-xl font-semibold hover:bg-gray-200 transition-colors flex items-center justify-center gap-2"
                    },
                        React.createElement(MessageCircleIcon),
                        "Apri Chat Gruppo"
                    ),
                    !isOrganizer && React.createElement('button', {
                        onClick: handleJoinEvent,
                        disabled: !isParticipant && participants.length >= event.max_participants,
                        className: `w-full py-3 rounded-xl font-semibold transition-colors ${
                            isParticipant
                                ? 'btn-secondary hover:bg-gray-200'
                                : participants.length >= event.max_participants
                                ? 'bg-gray-100 text-gray-400 cursor-not-allowed'
                                : 'btn btn-primary'
                        }`
                    },
                        isParticipant 
                            ? 'Abbandona evento' 
                            : participants.length >= event.max_participants 
                            ? 'Evento completo'
                            : 'Partecipa'
                    )
                )
            );
        }

        // Event Chat Component
        function EventChat({ eventId, user, participants, onClose }) {
            const [messages, setMessages] = useState([]);
            const [newMessage, setNewMessage] = useState('');
            const [loading, setLoading] = useState(true);
            const [sending, setSending] = useState(false);
            const messagesEndRef = useRef(null);

            const scrollToBottom = () => {
                messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
            };

            useEffect(() => {
                loadMessages();
                const interval = setInterval(loadMessages, 3000);
                return () => clearInterval(interval);
            }, [eventId]);

            useEffect(() => {
                scrollToBottom();
            }, [messages]);

            const loadMessages = async () => {
                try {
                    const client = window.getSupabase();
                    if (!client) return;

                    const { data, error } = await client
                        .from('event_messages')
                        .select(`*, profiles (username, full_name)`)
                        .eq('event_id', eventId)
                        .order('created_at', { ascending: true });
                    
                    if (error) throw error;
                    setMessages(data || []);
                } catch (error) {
                    console.error('Errore nel caricamento messaggi:', error);
                } finally {
                    setLoading(false);
                }
            };

            const sendMessage = async (e) => {
                e.preventDefault();
                if (!newMessage.trim() || sending) return;

                setSending(true);
                try {
                    const client = window.getSupabase();
                    if (!client) return;

                    const { error } = await client
                        .from('event_messages')
                        .insert([{
                            event_id: eventId,
                            user_id: user.id,
                            message: newMessage.trim(),
                            message_type: 'text'
                        }]);
                    
                    if (error) throw error;
                    
                    setNewMessage('');
                    await loadMessages();
                } catch (error) {
                    console.error('Errore invio messaggio:', error);
                    alert('Errore nell\'invio del messaggio');
                } finally {
                    setSending(false);
                }
            };

            const formatTime = (timestamp) => {
                const date = new Date(timestamp);
                const now = new Date();
                const isToday = date.toDateString() === now.toDateString();
                
                if (isToday) {
                    return date.toLocaleTimeString('it-IT', { hour: '2-digit', minute: '2-digit' });
                } else {
                    return date.toLocaleDateString('it-IT', { 
                        day: 'numeric', 
                        month: 'short',
                        hour: '2-digit', 
                        minute: '2-digit' 
                    });
                }
            };

            if (loading) {
                return React.createElement('div', { className: "fixed inset-0 bg-white z-50 flex items-center justify-center" },
                    React.createElement('div', { className: "text-center" },
                        React.createElement('div', { className: "animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2" }),
                        React.createElement('p', { className: "text-gray-600" }, "Caricamento chat...")
                    )
                );
            }

            return React.createElement('div', { className: "fixed inset-0 bg-white z-50 flex flex-col" },
                React.createElement('div', { className: "bg-white border-b border-gray-200 p-4 flex items-center gap-3" },
                    React.createElement('button', {
                        onClick: onClose,
                        className: "p-2 rounded-lg text-gray-600 hover:bg-gray-100"
                    }, React.createElement(XIcon)),
                    React.createElement('div', { className: "flex-1" },
                        React.createElement('h2', { className: "font-semibold text-gray-900" }, "Chat Evento"),
                        React.createElement('p', { className: "text-sm text-gray-500" },
                            participants.length, " partecipant", participants.length !== 1 ? 'i' : 'e'
                        )
                    ),
                    React.createElement('div', { className: "flex items-center gap-1" },
                        React.createElement(UsersIcon),
                        React.createElement('span', { className: "text-sm text-gray-600" }, participants.length)
                    )
                ),
                React.createElement('div', { className: "flex-1 overflow-y-auto p-4 space-y-4" },
                    messages.length === 0 ? React.createElement('div', { className: "text-center py-12" },
                        React.createElement(MessageCircleIcon, { size: 48, className: "mx-auto mb-3 text-gray-300" }),
                        React.createElement('p', { className: "text-gray-500" }, "Nessun messaggio ancora"),
                        React.createElement('p', { className: "text-sm text-gray-400 mt-1" }, "Inizia la conversazione!")
                    ) : messages.map((message, index) => {
                        const isOwn = message.user_id === user.id;
                        const showAuthor = index === 0 || messages[index - 1].user_id !== message.user_id;
                        
                        return React.createElement('div', {
                            key: message.id,
                            className: `flex ${isOwn ? 'justify-end' : 'justify-start'}`
                        },
                            React.createElement('div', { className: `max-w-[80%] ${isOwn ? 'order-2' : 'order-1'}` },
                                showAuthor && !isOwn && React.createElement('p', { className: "text-xs text-gray-500 mb-1 px-3" },
                                    message.profiles?.full_name || 'Utente'
                                ),
                                React.createElement('div', { className: `rounded-2xl px-4 py-2 ${
                                    isOwn 
                                        ? 'bg-blue-600 text-white' 
                                        : 'bg-gray-100 text-gray-900'
                                }` },
                                    React.createElement('p', { className: "text-sm" }, message.message),
                                    React.createElement('p', { className: `text-xs mt-1 ${
                                        isOwn ? 'text-blue-100' : 'text-gray-500'
                                    }` }, formatTime(message.created_at))
                                )
                            )
                        );
                    }),
                    React.createElement('div', { ref: messagesEndRef })
                ),
                React.createElement('div', { className: "border-t border-gray-200 p-4" },
                    React.createElement('form', { onSubmit: sendMessage, className: "flex gap-2" },
                        React.createElement('input', {
                            type: "text",
                            value: newMessage,
                            onChange: (e) => setNewMessage(e.target.value),
                            placeholder: "Scrivi un messaggio...",
                            className: "flex-1 px-4 py-2 border border-gray-300 rounded-full focus:ring-2 focus:ring-blue-500 focus:border-transparent",
                            disabled: sending
                        }),
                        React.createElement('button', {
                            type: "submit",
                            disabled: !newMessage.trim() || sending,
                            className: "w-10 h-10 bg-blue-600 text-white rounded-full flex items-center justify-center hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                        },
                            sending ? React.createElement('div', { className: "animate-spin rounded-full h-4 w-4 border-b-2 border-white" })
                                : React.createElement(SendIcon)
                        )
                    )
                )
            );
        }

        // Auth Form Component
        function AuthForm({ onSuccess }) {
            const [isLogin, setIsLogin] = useState(true);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState('');
            const [formData, setFormData] = useState({
                email: '',
                password: '',
                username: '',
                fullName: '',
                city: 'Milano',
                district: ''
            });

            const handleSubmit = async (e) => {
                e.preventDefault();
                setLoading(true);
                setError('');
                
                try {
                    const client = window.getSupabase();
                    if (!client) throw new Error('Client non disponibile');

                    if (isLogin) {
                        const { error } = await client.auth.signInWithPassword({
                            email: formData.email,
                            password: formData.password
                        });
                        if (error) throw error;
                    } else {
                        const { data: authData, error: authError } = await client.auth.signUp({
                            email: formData.email,
                            password: formData.password,
                            options: {
                                data: {
                                    username: formData.username,
                                    full_name: formData.fullName,
                                    city: formData.city,
                                    district: formData.district
                                }
                            }
                        });
                        
                        if (authError) throw authError;
                        
                        if (authData.user) {
                            await new Promise(resolve => setTimeout(resolve, 1000));
                        }
                    }
                    onSuccess();
                } catch (error) {
                    setError(error.message);
                } finally {
                    setLoading(false);
                }
            };

            return React.createElement('div', { className: "min-h-screen bg-gradient-blue flex items-center justify-center p-4" },
                React.createElement('div', { className: "bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md" },
                    React.createElement('div', { className: "text-center mb-8" },
                        React.createElement('div', { className: "w-20 h-20 bg-gradient-blue rounded-2xl flex items-center justify-center mx-auto mb-4" },
                            React.createElement('span', { className: "text-white font-bold text-3xl" }, "SS")
                        ),
                        React.createElement('h1', { className: "text-3xl font-bold bg-gradient-blue bg-clip-text text-transparent" }, "SocialSpot"),
                        React.createElement('p', { className: "text-gray-600 mt-2" }, "Connettiti con eventi locali")
                    ),
                    React.createElement('form', { onSubmit: handleSubmit, className: "space-y-4" },
                        React.createElement('div', null,
                            React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-1" }, "Email"),
                            React.createElement('input', {
                                type: "email",
                                required: true,
                                value: formData.email,
                                onChange: e => setFormData({ ...formData, email: e.target.value }),
                                className: "input"
                            })
                        ),
                        React.createElement('div', null,
                            React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-1" }, "Password"),
                            React.createElement('input', {
                                type: "password",
                                required: true,
                                value: formData.password,
                                onChange: e => setFormData({ ...formData, password: e.target.value }),
                                className: "input"
                            })
                        ),
                        !isLogin && React.createElement(React.Fragment, null,
                            React.createElement('div', null,
                                React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-1" }, "Username"),
                                React.createElement('input', {
                                    type: "text",
                                    required: true,
                                    value: formData.username,
                                    onChange: e => setFormData({ ...formData, username: e.target.value }),
                                    className: "input"
                                })
                            ),
                            React.createElement('div', null,
                                React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-1" }, "Nome completo"),
                                React.createElement('input', {
                                    type: "text",
                                    required: true,
                                    value: formData.fullName,
                                    onChange: e => setFormData({ ...formData, fullName: e.target.value }),
                                    className: "input"
                                })
                            ),
                            React.createElement('div', null,
                                React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-1" }, "Quartiere"),
                                React.createElement('input', {
                                    type: "text",
                                    value: formData.district,
                                    onChange: e => setFormData({ ...formData, district: e.target.value }),
                                    placeholder: "es. Navigli",
                                    className: "input"
                                })
                            )
                        ),
                        error && React.createElement('div', { className: "bg-red-50 text-red-600 p-3 rounded-lg text-sm" }, error),
                        React.createElement('button', {
                            type: "submit",
                            disabled: loading,
                            className: "btn btn-primary w-full"
                        }, loading ? 'Caricamento...' : (isLogin ? 'Accedi' : 'Registrati'))
                    ),
                    React.createElement('div', { className: "mt-6 text-center" },
                        React.createElement('button', {
                            onClick: () => { setIsLogin(!isLogin); setError(''); },
                            className: "text-blue-600 hover:underline"
                        }, isLogin ? 'Non hai un account? Registrati' : 'Hai già un account? Accedi')
                    )
                )
            );
        }

        // Profile Section Component
        function ProfileSection({ profile, eventsCreated, eventsJoined, userCreatedEvents, onEventClick }) {
            const [showCreatedEvents, setShowCreatedEvents] = useState(false);

            const formatEventDate = (dateStr) => {
                const date = new Date(dateStr);
                const now = new Date();
                const isPast = date < now;
                
                return {
                    formatted: date.toLocaleDateString('it-IT', { 
                        day: 'numeric', 
                        month: 'short',
                        year: date.getFullYear() !== now.getFullYear() ? 'numeric' : undefined
                    }),
                    isPast
                };
            };

            return React.createElement('div', { className: "p-6 pb-24" },
                React.createElement('div', { className: "flex flex-col items-center" },
                    React.createElement('div', { className: "w-24 h-24 rounded-full bg-gradient-blue flex items-center justify-center text-white text-3xl font-bold shadow-lg mb-4" },
                        (profile?.username?.substring(0, 2)?.toUpperCase() || "UT")
                    ),
                    React.createElement('h2', { className: "text-2xl font-bold" }, profile?.full_name),
                    React.createElement('p', { className: "text-gray-600" }, "@", profile?.username),
                    React.createElement('p', { className: "text-sm text-gray-500 mt-1" },
                        profile?.city, " ", (profile?.district ? `- ${profile.district}` : "")
                    ),
                    React.createElement('div', { className: "flex items-center gap-1 mt-2" },
                        React.createElement(StarIcon, { fill: true }),
                        React.createElement('span', { className: "font-semibold text-lg" }, profile?.rating || 5.0)
                    )
                ),
                React.createElement('div', { className: "mt-8 space-y-4" },
                    React.createElement('div', { className: "card p-6" },
                        React.createElement('h3', { className: "text-lg font-semibold mb-4" }, "Le tue statistiche"),
                        React.createElement('div', { className: "space-y-3" },
                            React.createElement('div', { className: "flex justify-between items-center" },
                                React.createElement('span', { className: "text-gray-600" }, "Eventi organizzati"),
                                React.createElement('span', { className: "font-bold text-xl text-blue-600" }, eventsCreated)
                            ),
                            React.createElement('div', { className: "flex justify-between items-center" },
                                React.createElement('span', { className: "text-gray-600" }, "Eventi partecipati"),
                                React.createElement('span', { className: "font-bold text-xl text-green-600" }, eventsJoined)
                            ),
                            React.createElement('div', { className: "flex justify-between items-center" },
                                React.createElement('span', { className: "text-gray-600" }, "Valutazione media"),
                                React.createElement('span', { className: "font-bold flex items-center gap-1" },
                                    React.createElement(StarIcon, { fill: true }),
                                    profile?.rating || 5.0
                                )
                            )
                        )
                    ),
                    React.createElement('div', { className: "card p-6" },
                        React.createElement('div', { className: "flex justify-between items-center mb-4" },
                            React.createElement('h3', { className: "text-lg font-semibold" }, "I tuoi eventi"),
                            eventsCreated > 0 && React.createElement('button', {
                                onClick: () => setShowCreatedEvents(!showCreatedEvents),
                                className: "text-blue-600 text-sm font-medium hover:text-blue-700"
                            }, showCreatedEvents ? 'Nascondi' : 'Mostra tutti')
                        ),
                        eventsCreated === 0 ? React.createElement('div', { className: "text-center py-8 text-gray-500" },
                            React.createElement(CalendarIcon, { size: 48, className: "mx-auto mb-3 text-gray-300" }),
                            React.createElement('p', null, "Non hai ancora creato eventi"),
                            React.createElement('p', { className: "text-sm mt-1" }, "Inizia creando il tuo primo evento!")
                        ) : !showCreatedEvents ? React.createElement('div', { className: "text-center py-4" },
                            React.createElement('p', { className: "text-gray-600" },
                                "Hai creato ", React.createElement('span', { className: "font-semibold text-blue-600" }, eventsCreated), " eventi"
                            ),
                            React.createElement('button', {
                                onClick: () => setShowCreatedEvents(true),
                                className: "mt-2 text-blue-600 text-sm hover:text-blue-700"
                            }, "Visualizza lista →")
                        ) : React.createElement('div', { className: "space-y-3 max-h-80 overflow-y-auto" },
                            (userCreatedEvents || []).map(event => {
                                const dateInfo = formatEventDate(event.event_date);
                                return React.createElement('div', {
                                    key: event.id,
                                    onClick: () => onEventClick && onEventClick(event),
                                    className: "border border-gray-200 rounded-lg p-4 hover:bg-gray-50 cursor-pointer transition-colors"
                                },
                                    React.createElement('div', { className: "flex justify-between items-start mb-2" },
                                        React.createElement('h4', { className: "font-semibold text-gray-900 flex-1" }, event.title),
                                        React.createElement('span', { className: `text-xs px-2 py-1 rounded-full ${
                                            dateInfo.isPast 
                                                ? 'bg-gray-100 text-gray-600' 
                                                : 'bg-green-100 text-green-700'
                                        }` }, dateInfo.isPast ? 'Passato' : 'Futuro')
                                    ),
                                    React.createElement('div', { className: "flex items-center gap-4 text-sm text-gray-600 mb-2" },
                                        React.createElement('div', { className: "flex items-center gap-1" },
                                            React.createElement(CalendarIcon),
                                            React.createElement('span', null, dateInfo.formatted)
                                        ),
                                        React.createElement('div', { className: "flex items-center gap-1" },
                                            React.createElement(ClockIcon),
                                            React.createElement('span', null, event.event_time?.substring(0, 5))
                                        )
                                    ),
                                    React.createElement('div', { className: "flex items-center gap-4 text-sm text-gray-600" },
                                        React.createElement('div', { className: "flex items-center gap-1" },
                                            React.createElement(MapPinIcon),
                                            React.createElement('span', { className: "truncate" }, event.location)
                                        ),
                                        React.createElement('div', { className: "flex items-center gap-1" },
                                            React.createElement(UsersIcon),
                                            React.createElement('span', null, (event.current_participants || 1), "/", event.max_participants)
                                        )
                                    )
                                );
                            })
                        )
                    ),
                    eventsCreated >= 5 && React.createElement('div', { className: "bg-gradient text-white rounded-2xl p-4 text-center" },
                        React.createElement('div', { className: "text-2xl mb-2" }, "🏆"),
                        React.createElement('h4', { className: "font-semibold" }, "Organizzatore Esperto"),
                        React.createElement('p', { className: "text-sm opacity-90" }, "Hai creato più di 5 eventi!")
                    )
                )
            );
        }

        // Main App Component
        function SocialSpot() {
            const [currentView, setCurrentView] = useState('home');
            const [user, setUser] = useState(null);
            const [profile, setProfile] = useState(null);
            const [events, setEvents] = useState([]);
            const [userCreatedEvents, setUserCreatedEvents] = useState([]);
            const [loading, setLoading] = useState(true);
            const [searchTerm, setSearchTerm] = useState('');
            const [showCreateForm, setShowCreateForm] = useState(false);
            const [selectedCategory, setSelectedCategory] = useState(null);
            const [userStats, setUserStats] = useState({ created: 0, joined: 0 });
            const [selectedEvent, setSelectedEvent] = useState(null);
            const [showWelcomePopup, setShowWelcomePopup] = useState(false);

            const categories = [
                { id: 'aperitivo', name: 'Aperitivi', icon: CoffeeIcon, color: 'bg-orange-100 text-orange-600' },
                { id: 'cinema', name: 'Cinema', icon: FilmIcon, color: 'bg-purple-100 text-purple-600' },
                { id: 'sport', name: 'Sport', icon: DumbbellIcon, color: 'bg-green-100 text-green-600' },
                { id: 'cultura', name: 'Cultura', icon: PaletteIcon, color: 'bg-blue-100 text-blue-600' }
            ];

            useEffect(() => {
                checkUser();
            }, []);

            useEffect(() => {
                if (user) {
                    loadEvents();
                    loadUserStats();
                    loadUserCreatedEvents();
                    setShowWelcomePopup(true);
                }
            }, [user]);

            const checkUser = async () => {
                try {
                    const client = window.getSupabase();
                    if (!client) return;

                    const { data: { user } } = await client.auth.getUser();
                    if (user) {
                        setUser(user);
                        await loadProfile(user.id);
                    }
                } catch (error) {
                    console.error('Errore nel controllo utente:', error);
                } finally {
                    setLoading(false);
                }
            };

            const loadProfile = async (userId) => {
                try {
                    const client = window.getSupabase();
                    if (!client) return;

                    const { data, error } = await client
                        .from('profiles')
                        .select('*')
                        .eq('id', userId)
                        .single();
                    
                    if (error) throw error;
                    setProfile(data);
                } catch (error) {
                    console.error('Errore nel caricamento profilo:', error);
                }
            };

            const loadEvents = async () => {
                try {
                    const client = window.getSupabase();
                    if (!client) return;

                    const { data, error } = await client
                        .from('events')
                        .select(`
                            *,
                            profiles!organizer_id (username, full_name, rating),
                            event_participants (user_id, status)
                        `)
                        .gte('event_date', new Date().toISOString().split('T')[0])
                        .order('event_date', { ascending: true });
                    
                    if (error) throw error;
                    setEvents(data || []);
                } catch (error) {
                    console.error('Errore nel caricamento eventi:', error);
                }
            };

            const loadUserCreatedEvents = async () => {
                if (!user) return;
                
                try {
                    const client = window.getSupabase();
                    if (!client) return;

                    const { data, error } = await client
                        .from('events')
                        .select('*')
                        .eq('organizer_id', user.id)
                        .order('event_date', { ascending: false });
                    
                    if (error) throw error;
                    setUserCreatedEvents(data || []);
                } catch (error) {
                    console.error('Errore nel caricamento eventi creati:', error);
                }
            };

            const loadUserStats = async () => {
                if (!user) return;
                
                try {
                    const client = window.getSupabase();
                    if (!client) return;

                    const { count: created } = await client
                        .from('events')
                        .select('*', { count: 'exact', head: true })
                        .eq('organizer_id', user.id);
                    
                    const { data: participatedEvents } = await client
                        .from('event_participants')
                        .select('event_id, events!inner(organizer_id)')
                        .eq('user_id', user.id)
                        .eq('status', 'accepted')
                        .neq('events.organizer_id', user.id);
                    
                    const joinedCount = participatedEvents?.length || 0;
                    
                    setUserStats({ 
                        created: created || 0, 
                        joined: joinedCount 
                    });
                    
                    await client
                        .from('profiles')
                        .update({ 
                            events_created: created || 0,
                            events_joined: joinedCount
                        })
                        .eq('id', user.id);
                        
                } catch (error) {
                    console.error('Errore nel caricamento statistiche:', error);
                }
            };

            const filteredEvents = events.filter(event => {
                const matchesSearch = !searchTerm || 
                    event.title?.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    event.description?.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    event.location?.toLowerCase().includes(searchTerm.toLowerCase());
                
                const matchesCategory = !selectedCategory || event.category_id === selectedCategory;
                
                return matchesSearch && matchesCategory;
            });

            const getCategoryCount = (categoryId) => {
                return events.filter(event => event.category_id === categoryId).length;
            };

            const handleEventClick = (event) => {
                setSelectedEvent(event);
            };

            if (loading) {
                return React.createElement('div', { className: "min-h-screen flex items-center justify-center bg-gradient-blue" },
                    React.createElement('div', { className: "bg-white rounded-2xl shadow-xl px-8 py-8" },
                        React.createElement('div', { className: "flex items-center space-x-3" },
                            React.createElement('div', { className: "w-12 h-12 bg-gradient-blue rounded-xl animate-pulse" }),
                            React.createElement('span', { className: "text-2xl font-bold text-gray-800" }, "Caricamento...")
                        )
                    )
                );
            }

            if (!user) {
                return React.createElement(AuthForm, { onSuccess: checkUser });
            }

            if (selectedEvent) {
                return React.createElement(EventDetail, {
                    event: selectedEvent,
                    user: user,
                    onClose: () => setSelectedEvent(null),
                    onUpdate: () => {
                        loadEvents();
                        loadUserStats();
                        loadUserCreatedEvents();
                    }
                });
            }

            return React.createElement('div', { className: "min-h-screen pb-20 bg-gray-50" },
                React.createElement(Header, {
                    profile: profile,
                    showWelcome: showWelcomePopup,
                    setShowWelcome: setShowWelcomePopup
                }),
                React.createElement('main', { className: "px-4 max-w-2xl pt-6" },
                    // Home View
                    currentView === 'home' && React.createElement('div', null,
                        React.createElement('div', { className: "grid grid-cols-2 gap-3 mb-6" },
                            categories.map(cat =>
                                React.createElement(CategoryCard, {
                                    key: cat.id,
                                    category: cat,
                                    count: getCategoryCount(cat.id),
                                    isSelected: selectedCategory === cat.id,
                                    onClick: () => setSelectedCategory(
                                        selectedCategory === cat.id ? null : cat.id
                                    )
                                })
                            )
                        ),
                        React.createElement('h2', { className: "text-xl font-bold mb-4 text-gray-800" },
                            selectedCategory 
                                ? `Eventi ${categories.find(c => c.id === selectedCategory)?.name}`
                                : 'Eventi nelle vicinanze'
                        ),
                        filteredEvents.length === 0 ? React.createElement('div', { className: "text-center py-12 card" },
                            React.createElement(CalendarIcon, { size: 48 }),
                            React.createElement('p', { className: "text-gray-500 mt-4" }, "Nessun evento disponibile"),
                            React.createElement('button', {
                                onClick: () => setShowCreateForm(true),
                                className: "mt-4 btn btn-primary"
                            }, "Crea il primo evento")
                        ) : filteredEvents.map(event =>
                            React.createElement(EventCard, {
                                key: event.id,
                                event: event,
                                user: user,
                                onClick: () => handleEventClick(event),
                                onUpdate: () => {
                                    loadEvents();
                                    loadUserStats();
                                }
                            })
                        )
                    ),

                    // Search View
                    currentView === 'search' && React.createElement('div', { className: "pt-6" },
                        React.createElement('div', { className: "mb-6" },
                            React.createElement('input', {
                                type: "text",
                                placeholder: "Cerca eventi, luoghi o categorie...",
                                value: searchTerm,
                                onChange: (e) => setSearchTerm(e.target.value),
                                className: "w-full px-4 py-3 rounded-2xl border border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-transparent shadow-sm",
                                autoFocus: true
                            })
                        ),
                        searchTerm && React.createElement('p', { className: "text-sm text-gray-600 mb-4" },
                            filteredEvents.length, " risultati per \"", searchTerm, "\""
                        ),
                        filteredEvents.length === 0 && searchTerm ? React.createElement('div', { className: "text-center py-12 card" },
                            React.createElement(SearchIcon),
                            React.createElement('p', { className: "text-gray-500 mt-4" }, "Nessun risultato trovato")
                        ) : filteredEvents.map(event =>
                            React.createElement(EventCard, {
                                key: event.id,
                                event: event,
                                user: user,
                                onClick: () => handleEventClick(event),
                                onUpdate: () => {
                                    loadEvents();
                                    loadUserStats();
                                }
                            })
                        )
                    ),

                    // Profile View
                    currentView === 'profile' && profile && React.createElement(ProfileSection, {
                        profile: profile,
                        eventsCreated: userStats.created,
                        eventsJoined: userStats.joined,
                        userCreatedEvents: userCreatedEvents,
                        onEventClick: handleEventClick
                    }),

                    // Create Event Form
                    (currentView === 'create' || showCreateForm) && React.createElement(CreateEventForm, {
                        user: user,
                        onClose: () => {
                            setShowCreateForm(false);
                            setCurrentView('home');
                        },
                        onSuccess: () => {
                            loadEvents();
                            loadUserStats();
                            loadUserCreatedEvents();
                            setShowCreateForm(false);
                            setCurrentView('home');
                        }
                    })
                ),
                React.createElement(BottomNav, {
                    currentView: currentView,
                    setCurrentView: setCurrentView
                })
            );
        }

        // Initialize the app
        ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(SocialSpot));
    </script>
</body>
</html><!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SocialSpot - Connettiti con eventi locali</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            background: #f8fafc;
            color: #1a202c;
        }
        
        /* Layout Classes */
        .min-h-screen { min-height: 100vh; }
        .h-full { height: 100%; }
        .w-full { width: 100%; }
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .flex-1 { flex: 1 1 0%; }
        .items-center { align-items: center; }
        .justify-center { justify-content: center; }
        .justify-between { justify-content: space-between; }
        .justify-around { justify-content: space-around; }
        .text-center { text-align: center; }
        .text-left { text-align: left; }
        .max-w-2xl { max-width: 42rem; margin: 0 auto; }
        .max-w-md { max-width: 28rem; }
        .max-w-sm { max-width: 24rem; }
        .max-w-xs { max-width: 20rem; }
        .mx-auto { margin-left: auto; margin-right: auto; }
        
        /* Spacing */
        .p-2 { padding: 0.5rem; }
        .p-3 { padding: 0.75rem; }
        .p-4 { padding: 1rem; }
        .p-5 { padding: 1.25rem; }
        .p-6 { padding: 1.5rem; }
        .p-8 { padding: 2rem; }
        .px-3 { padding-left: 0.75rem; padding-right: 0.75rem; }
        .px-4 { padding-left: 1rem; padding-right: 1rem; }
        .px-6 { padding-left: 1.5rem; padding-right: 1.5rem; }
        .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
        .py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
        .py-4 { padding-top: 1rem; padding-bottom: 1rem; }
        .py-6 { padding-top: 1.5rem; padding-bottom: 1.5rem; }
        .py-8 { padding-top: 2rem; padding-bottom: 2rem; }
        .py-12 { padding-top: 3rem; padding-bottom: 3rem; }
        .pt-6 { padding-top: 1.5rem; }
        .pb-20 { padding-bottom: 5rem; }
        .pb-24 { padding-bottom: 6rem; }
        .mb-1 { margin-bottom: 0.25rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-3 { margin-bottom: 0.75rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mb-6 { margin-bottom: 1.5rem; }
        .mb-8 { margin-bottom: 2rem; }
        .mt-1 { margin-top: 0.25rem; }
        .mt-2 { margin-top: 0.5rem; }
        .mt-4 { margin-top: 1rem; }
        .mt-6 { margin-top: 1.5rem; }
        .mt-8 { margin-top: 2rem; }
        .ml-2 { margin-left: 0.5rem; }
        .ml-auto { margin-left: auto; }
        .-mt-4 { margin-top: -1rem; }
        
        /* Sizing */
        .w-8 { width: 2rem; }
        .w-10 { width: 2.5rem; }
        .w-12 { width: 3rem; }
        .w-16 { width: 4rem; }
        .w-20 { width: 5rem; }
        .w-24 { width: 6rem; }
        .w-80 { width: 20rem; }
        .h-8 { height: 2rem; }
        .h-10 { height: 2.5rem; }
        .h-12 { height: 3rem; }
        .h-16 { height: 4rem; }
        .h-20 { height: 5rem; }
        .h-24 { height: 6rem; }
        .max-h-80 { max-height: 20rem; }
        .max-h-90vh { max-height: 90vh; }
        
        /* Colors */
        .bg-white { background-color: white; }
        .bg-gray-50 { background-color: #f9fafb; }
        .bg-gray-100 { background-color: #f3f4f6; }
        .bg-gray-200 { background-color: #e5e7eb; }
        .bg-blue-50 { background-color: #eff6ff; }
        .bg-blue-100 { background-color: #dbeafe; }
        .bg-blue-600 { background-color: #2563eb; }
        .bg-blue-700 { background-color: #1d4ed8; }
        .bg-green-50 { background-color: #f0fdf4; }
        .bg-green-100 { background-color: #dcfce7; }
        .bg-green-600 { background-color: #16a34a; }
        .bg-orange-100 { background-color: #fed7aa; }
        .bg-orange-500 { background-color: #f97316; }
        .bg-orange-600 { background-color: #ea580c; }
        .bg-purple-100 { background-color: #f3e8ff; }
        .bg-red-50 { background-color: #fef2f2; }
        .bg-yellow-400 { background-color: #facc15; }
        .bg-black { background-color: black; }
        .bg-gradient { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .bg-gradient-blue { background: linear-gradient(135deg, #2563eb 0%, #f97316 100%); }
        
        .text-white { color: white; }
        .text-gray-400 { color: #9ca3af; }
        .text-gray-500 { color: #6b7280; }
        .text-gray-600 { color: #4b5563; }
        .text-gray-700 { color: #374151; }
        .text-gray-800 { color: #1f2937; }
        .text-gray-900 { color: #111827; }
        .text-blue-600 { color: #2563eb; }
        .text-blue-700 { color: #1d4ed8; }
        .text-green-600 { color: #16a34a; }
        .text-green-700 { color: #15803d; }
        .text-orange-600 { color: #ea580c; }
        .text-purple-600 { color: #9333ea; }
        .text-red-600 { color: #dc2626; }
        .text-yellow-600 { color: #ca8a04; }
        
        /* Typography */
        .text-xs { font-size: 0.75rem; line-height: 1rem; }
        .text-sm { font-size: 0.875rem; line-height: 1.25rem; }
        .text-base { font-size: 1rem; line-height: 1.5rem; }
        .text-lg { font-size: 1.125rem; line-height: 1.75rem; }
        .text-xl { font-size: 1.25rem; line-height: 1.75rem; }
        .text-2xl { font-size: 1.5rem; line-height: 2rem; }
        .text-3xl { font-size: 1.875rem; line-height: 2.25rem; }
        .text-4xl { font-size: 2.25rem; line-height: 2.5rem; }
        .font-medium { font-weight: 500; }
        .font-semibold { font-weight: 600; }
        .font-bold { font-weight: 700; }
        .leading-relaxed { line-height: 1.625; }
        
        /* Borders */
        .border { border-width: 1px; }
        .border-t { border-top-width: 1px; }
        .border-b { border-bottom-width: 1px; }
        .border-2 { border-width: 2px; }
        .border-gray-100 { border-color: #f3f4f6; }
        .border-gray-200 { border-color: #e5e7eb; }
        .border-gray-300 { border-color: #d1d5db; }
        .rounded-lg { border-radius: 0.5rem; }
        .rounded-xl { border-radius: 0.75rem; }
        .rounded-2xl { border-radius: 1rem; }
        .rounded-full { border-radius: 9999px; }
        
        /* Shadows */
        .shadow-sm { box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); }
        .shadow-md { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .shadow-lg { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        .shadow-xl { box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); }
        .shadow-2xl { box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); }
        
        /* Position */
        .sticky { position: sticky; }
        .fixed { position: fixed; }
        .absolute { position: absolute; }
        .relative { position: relative; }
        .inset-0 { top: 0; right: 0; bottom: 0; left: 0; }
        .top-0 { top: 0; }
        .left-0 { left: 0; }
        .bottom-0 { bottom: 0; }
        .right-0 { right: 0; }
        .z-40 { z-index: 40; }
        .z-50 { z-index: 50; }
        
        /* Grid */
        .grid { display: grid; }
        .grid-cols-1 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
        .grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
        .gap-1 { gap: 0.25rem; }
        .gap-2 { gap: 0.5rem; }
        .gap-3 { gap: 0.75rem; }
        .gap-4 { gap: 1rem; }
        
        /* Spacing between children */
        .space-y-2 > * + * { margin-top: 0.5rem; }
        .space-y-3 > * + * { margin-top: 0.75rem; }
        .space-y-4 > * + * { margin-top: 1rem; }
        .space-y-6 > * + * { margin-top: 1.5rem; }
        
        /* Display */
        .hidden { display: none; }
        .block { display: block; }
        .inline-block { display: inline-block; }
        .inline-flex { display: inline-flex; }
        
        /* Overflow */
        .overflow-hidden { overflow: hidden; }
        .overflow-y-auto { overflow-y: auto; }
        .truncate { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        
        /* Cursor */
        .cursor-pointer { cursor: pointer; }
        .cursor-not-allowed { cursor: not-allowed; }
        
        /* Transitions */
        .transition-all { transition: all 0.15s ease-in-out; }
        .transition-colors { transition: color 0.15s ease-in-out, background-color 0.15s ease-in-out; }
        .transition-opacity { transition: opacity 0.15s ease-in-out; }
        .transition-transform { transition: transform 0.15s ease-in-out; }
        
        /* Hover states */
        .hover\\:bg-gray-100:hover { background-color: #f3f4f6; }
        .hover\\:bg-gray-200:hover { background-color: #e5e7eb; }
        .hover\\:bg-blue-200:hover { background-color: #bfdbfe; }
        .hover\\:bg-blue-700:hover { background-color: #1d4ed8; }
        .hover\\:bg-red-50:hover { background-color: #fef2f2; }
        .hover\\:text-gray-700:hover { color: #374151; }
        .hover\\:text-gray-900:hover { color: #111827; }
        .hover\\:text-blue-700:hover { color: #1d4ed8; }
        .hover\\:shadow-md:hover { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .hover\\:shadow-lg:hover { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        .hover\\:opacity-90:hover { opacity: 0.9; }
        .hover\\:scale-105:hover { transform: scale(1.05); }
        .hover\\:underline:hover { text-decoration: underline; }
        
        /* Focus states */
        .focus\\:outline-none:focus { outline: 2px solid transparent; outline-offset: 2px; }
        .focus\\:ring-2:focus { box-shadow: 0 0 0 2px #3b82f6; }
        .focus\\:border-transparent:focus { border-color: transparent; }
        
        /* Disabled states */
        .disabled\\:opacity-50:disabled { opacity: 0.5; }
        .disabled\\:cursor-not-allowed:disabled { cursor: not-allowed; }
        
        /* Opacity */
        .opacity-75 { opacity: 0.75; }
        .opacity-90 { opacity: 0.9; }
        .bg-opacity-50 { background-color: rgba(0, 0, 0, 0.5); }
        
        /* Animations */
        .animate-spin { animation: spin 1s linear infinite; }
        .animate-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        .animate-bounce { animation: bounce 1s infinite; }
        
        @keyframes spin { to { transform: rotate(360deg); } }
        @keyframes pulse { 50% { opacity: .5; } }
        @keyframes bounce {
            0%, 20%, 53%, 80%, 100% { animation-timing-function: cubic-bezier(0.215, 0.61, 0.355, 1); transform: translate3d(0, 0, 0); }
            40%, 43% { animation-timing-function: cubic-bezier(0.755, 0.05, 0.855, 0.06); transform: translate3d(0, -30px, 0); }
            70% { animation-timing-function: cubic-bezier(0.755, 0.05, 0.855, 0.06); transform: translate3d(0, -15px, 0); }
            90% { transform: translate3d(0, -4px, 0); }
        }
        
        /* Custom components */
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: 600;
            transition: all 0.2s;
            cursor: pointer;
            border: none;
            font-family: inherit;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #2563eb 0%, #f97316 100%);
            color: white;
        }
        
        .btn-primary:hover {
            opacity: 0.9;
            transform: translateY(-1px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        
        .btn-secondary {
            background-color: #f3f4f6;
            color: #374151;
        }
        
        .btn-secondary:hover {
            background-color: #e5e7eb;
        }
        
        .input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            transition: all 0.2s;
        }
        
        .input:focus {
            outline: none;
            border-color: transparent;
            box-shadow: 0 0 0 2px #3b82f6;
        }
        
        .card {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            transition: all 0.2s;
        }
        
        .card:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }
        
        /* Mobile responsive */
        @media (max-width: 640px) {
            .max-w-2xl { max-width: 100%; padding: 0 1rem; }
            .grid-cols-2 { grid-template-columns: 1fr; }
            .text-4xl { font-size: 1.875rem; }
            .text-3xl { font-size: 1.5rem; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script>
        // Configurazione globale
        window.SUPABASE_CONFIG = {
            url: 'https://wsmjnssfmujdfgthyizw.supabase.co',
            key: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndzbWpuc3NmbXVqZGZndGh5aXp3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA4ODA3NjIsImV4cCI6MjA2NjQ1Njc2Mn0.t91X-fGIolFBPnhr5_sexJMqzgdCDmXuEUXiL_pFId4'
        };

        // Supabase Client Singleton
        window.getSupabase = function() {
            if (!window._supabaseClient) {
                if (typeof supabase === 'undefined') {
                    console.error('Supabase library not loaded');
                    return null;
                }
                window._supabaseClient = supabase.createClient(
                    window.SUPABASE_CONFIG.url,
                    window.SUPABASE_CONFIG.key
                );
            }
            return window._supabaseClient;
        };

        // React components using React.createElement
        const { useState, useEffect, useRef } = React;

        // Icons as functions
        function HomeIcon() {
            return React.createElement('svg', {
                width: 24, height: 24, viewBox: "0 0 24 24", fill: "none",
                stroke: "currentColor", strokeWidth: 2, strokeLinecap: "round", strokeLinejoin: "round"
            },
                React.createElement('path', { d: "m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" }),
                React.createElement('polyline', { points: "9 22 9 12 15 12 15 22" })
            );
        }

        function SearchIcon() {
            return React.createElement('svg', {
                width: 24, height: 24, viewBox: "0 0 24 24", fill: "none",
                stroke: "currentColor", strokeWidth: 2, strokeLinecap: "round", strokeLinejoin: "round"
            },
                React.createElement('circle', { cx: 11, cy: 11, r: 8 }),
                React.createElement('path', { d: "m21 21-4.35-4.35" })
            );
        }

        function PlusIcon() {
            return React.createElement('svg', {
                width: 24, height: 24, viewBox: "0 0 24 24", fill: "none",
                stroke: "currentColor", strokeWidth: 2, strokeLinecap: "round", strokeLinejoin: "round"
            },
                React.createElement('line', { x1: 12, y1: 5, x2: 12, y2: 19 }),
                React.createElement('line', { x1: 5, y1: 12, x2: 19, y2: 12 })
            );
        }

        function UserIcon() {
            return React.createElement('svg', {
                width: 24, height: 24, viewBox: "0 0 24 24", fill: "none",
                stroke: "currentColor", strokeWidth: 2, strokeLinecap: "round", strokeLinejoin: "round"
            },
                React.createElement('path', { d: "M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" }),
                React.createElement('circle', { cx: 12, cy: 7, r: 4 })
            );
        }

        function MenuIcon() {
            return React.createElement('svg', {
                width: 20, height: 20, viewBox: "0 0 24 24", fill: "none",
                stroke: "currentColor", strokeWidth: 2, strokeLinecap: "round", strokeLinejoin: "round"
            },
                React.createElement('line', { x1: 3, y1: 6, x2: 21, y2: 6 }),
                React.createElement('line', { x1: 3, y1: 12, x2: 21, y2: 12 }),
                React.createElement('line', { x1: 3, y1: 18, x2: 21, y2: 18 })
            );
        }

        function XIcon() {
            return React.createElement('svg', {
                width: 20, height: 20, viewBox: "0 0 24 24", fill: "none",
                stroke: "currentColor", strokeWidth: 2, strokeLinecap: "round", strokeLinejoin: "round"
            },
                React.createElement('line', { x1: 18, y1: 6, x2: 6, y2: 18 }),
                React.createElement('line', { x1: 6, y1: 6, x2: 18, y2: 18 })
            );
        }

        function CalendarIcon() {
            return React.createElement('svg', {
                width: 18, height: 18, viewBox: "0 0 24 24", fill: "none",
                stroke: "currentColor", strokeWidth: 2, strokeLinecap: "round", strokeLinejoin: "round"
            },
                React.createElement('rect', { x: 3, y: 4, width: 18, height: 18, rx: 2, ry: 2 }),
                React.createElement('line', { x1: 16, y1: 2, x2: 16, y2: 6 }),
                React.createElement('line', { x1: 8, y1: 2, x2: 8, y2: 6 }),
                React.createElement('line', { x1: 3, y1: 10, x2: 21, y2: 10 })
            );
        }

        function ClockIcon() {
            return React.createElement('svg', {
                width: 18, height: 18, viewBox: "0 0 24 24", fill: "none",
                stroke: "currentColor", strokeWidth: 2, strokeLinecap: "round", strokeLinejoin: "round"
            },
                React.createElement('circle', { cx: 12, cy: 12, r: 10 }),
                React.createElement('polyline', { points: "12 6 12 12 16 14" })
            );
        }

        function MapPinIcon() {
            return React.createElement('svg', {
                width: 18, height: 18, viewBox: "0 0 24 24", fill: "none",
                stroke: "currentColor", strokeWidth: 2, strokeLinecap: "round", strokeLinejoin: "round"
            },
                React.createElement('path', { d: "M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" }),
                React.createElement('circle', { cx: 12, cy: 10, r: 3 })
            );
        }

        function UsersIcon() {
            return React.createElement('svg', {
                width: 18, height: 18, viewBox: "0 0 24 24", fill: "none",
                stroke: "currentColor", strokeWidth: 2, strokeLinecap: "round", strokeLinejoin: "round"
            },
                React.createElement('path', { d: "M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" }),
                React.createElement('circle', { cx: 9, cy: 7, r: 4 }),
                React.createElement('path', { d: "M23 21v-2a4 4 0 0 0-3-3.87" }),
                React.createElement('path', { d: "M16 3.13a4 4 0 0 1 0 7.75" })
            );
        }

        function MessageCircleIcon() {
            return React.createElement('svg', {
                width: 20, height: 20, viewBox: "0 0 24 24", fill: "none",
                stroke: "currentColor", strokeWidth: 2, strokeLinecap: "round", strokeLinejoin: "round"
            },
                React.createElement('path', { d: "M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z" })
            );
        }

        function StarIcon({ fill = false }) {
            return React.createElement('svg', {
                width: 16, height: 16, viewBox: "0 0 24 24",
                fill: fill ? "currentColor" : "none",
                stroke: "currentColor", strokeWidth: 2, strokeLinecap: "round", strokeLinejoin: "round"
            },
                React.createElement('polygon', { points: "12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" })
            );
        }

        function CoffeeIcon() {
            return React.createElement('svg', {
                width: 24, height: 24, viewBox: "0 0 24 24", fill: "none",
                stroke: "currentColor", strokeWidth: 2, strokeLinecap: "round", strokeLinejoin: "round"
            },
                React.createElement('path', { d: "M18 8h1a4 4 0 0 1 0 8h-1" }),
                React.createElement('path', { d: "M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z" }),
                React.createElement('line', { x1: 6, y1: 1, x2: 6, y2: 4 }),
                React.createElement('line', { x1: 10, y1: 1, x2: 10, y2: 4 }),
                React.createElement('line', { x1: 14, y1: 1, x2: 14, y2: 4 })
            );
        }

        function FilmIcon() {
            return React.createElement('svg', {
                width: 24, height: 24, viewBox: "0 0 24 24", fill: "none",
                stroke: "currentColor", strokeWidth: 2, strokeLinecap: "round", strokeLinejoin: "round"
            },
                React.createElement('rect', { x: 2, y: 2, width: 20, height: 20, rx: 2.18, ry: 2.18 }),
                React.createElement('line', { x1: 7, y1: 2, x2: 7, y2: 22 }),
                React.createElement('line', { x1: 17, y1: 2, x2: 17, y2: 22 }),
                React.createElement('line', { x1: 2, y1: 12, x2: 22, y2: 12 })
            );
        }

        function DumbbellIcon() {
            return React.createElement('svg', {
                width: 24, height: 24, viewBox: "0 0 24 24", fill: "none",
                stroke: "currentColor", strokeWidth: 2, strokeLinecap: "round", strokeLinejoin: "round"
            },
                React.createElement('path', { d: "m6.5 6.5 11 11" }),
                React.createElement('path', { d: "M21 21v-7a2 2 0 0 0-4 0v7" }),
                React.createElement('path', { d: "M3 3h7a2 2 0 0 1 0 4H3" })
            );
        }

        function PaletteIcon() {
            return React.createElement('svg', {
                width: 24, height: 24, viewBox: "0 0 24 24", fill: "none",
                stroke: "currentColor", strokeWidth: 2, strokeLinecap: "round", strokeLinejoin: "round"
            },
                React.createElement('circle', { cx: 13.5, cy: 6.5, r: 0.5 }),
                React.createElement('circle', { cx: 17.5, cy: 10.5, r: 0.5 }),
                React.createElement('path', { d: "M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z" })
            );
        }

        function SendIcon() {
            return React.createElement('svg', {
                width: 16, height: 16, viewBox: "0 0 24 24", fill: "none",
                stroke: "currentColor", strokeWidth: 2, strokeLinecap: "round", strokeLinejoin: "round"
            },
                React.createElement('line', { x1: 22, y1: 2, x2: 11, y2: 13 }),
                React.createElement('polygon', { points: "22 2 15 22 11 13 2 9 22 2" })
            );
        }

        // Header Component
        function Header({ profile, onMenuClick, showWelcome, setShowWelcome }) {
            const [sideMenuOpen, setSideMenuOpen] = useState(false);

            const closeWelcome = () => {
                setShowWelcome(false);
            };

            return React.createElement(React.Fragment, null,
                // Header bar
                React.createElement('header', { className: "bg-white shadow-sm border-b border-gray-100 sticky top-0 z-40" },
                    React.createElement('div', { className: "max-w-2xl px-4" },
                        React.createElement('div', { className: "flex justify-between items-center h-16" },
                            React.createElement('button', {
                                onClick: () => setSideMenuOpen(true),
                                className: "p-2 rounded-lg text-gray-600 hover:text-gray-900 hover:bg-gray-100 transition-colors"
                            }, React.createElement(MenuIcon)),
                            React.createElement('div', { className: "flex items-center" },
                                React.createElement('div', { className: "w-10 h-10 bg-gradient-blue rounded-xl flex items-center justify-center" },
                                    React.createElement('span', { className: "text-white font-bold text-lg" }, "SS")
                                )
                            ),
                            React.createElement('div', { className: "w-10" })
                        )
                    )
                ),

                // Welcome popup
                showWelcome && React.createElement('div', { className: "fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50" },
                    React.createElement('div', { className: "bg-white rounded-2xl p-6 w-full max-w-sm text-center card" },
                        React.createElement('div', { className: "w-16 h-16 bg-gradient-blue rounded-2xl flex items-center justify-center mx-auto mb-4" },
                            React.createElement('span', { className: "text-white font-bold text-2xl" }, "SS")
                        ),
                        React.createElement('h2', { className: "text-2xl font-bold mb-2" }, "Benvenuto in SocialSpot!"),
                        React.createElement('p', { className: "text-gray-600 mb-6" },
                            "Ciao ", profile?.full_name?.split(' ')[0] || 'Utente', "! 👋", React.createElement('br'),
                            "Scopri eventi fantastici nella tua zona e connettiti con nuove persone."
                        ),
                        React.createElement('button', {
                            onClick: closeWelcome,
                            className: "btn btn-primary w-full"
                        }, "Inizia ad esplorare")
                    )
                ),

                // Side menu
                sideMenuOpen && React.createElement('div', { className: "fixed inset-0 z-50" },
                    React.createElement('div', { 
                        className: "absolute inset-0 bg-black bg-opacity-50",
                        onClick: () => setSideMenuOpen(false)
                    }),
                    React.createElement('div', { className: "absolute left-0 top-0 h-full w-80 bg-white shadow-xl" },
                        React.createElement('div', { className: "p-6 border-b border-gray-200" },
                            React.createElement('div', { className: "flex items-center justify-between mb-4" },
                                React.createElement('h2', { className: "text-xl font-bold text-gray-900" }, "Menu"),
                                React.createElement('button', {
                                    onClick: () => setSideMenuOpen(false),
                                    className: "p-2 rounded-lg text-gray-500 hover:text-gray-700 hover:bg-gray-100"
                                }, React.createElement(XIcon))
                            ),
                            React.createElement('div', { className: "flex items-center gap-3" },
                                React.createElement('div', { className: "w-12 h-12 rounded-full bg-gradient-blue flex items-center justify-center text-white font-bold" },
                                    (profile?.username?.substring(0, 2)?.toUpperCase() || "UT")
                                ),
                                React.createElement('div', null,
                                    React.createElement('p', { className: "font-semibold text-gray-900" }, profile?.full_name || 'Utente'),
                                    React.createElement('p', { className: "text-sm text-gray-500" }, "@", profile?.username || 'utente')
                                )
                            )
                        ),
                        React.createElement('div', { className: "p-6 space-y-4" },
                            React.createElement('button', { className: "flex items-center gap-3 w-full p-3 rounded-lg hover:bg-gray-100 transition-colors text-left" },
                                React.createElement(UserIcon), React.createElement('span', { className: "text-gray-700" }, "Il mio profilo")
                            ),
                            React.createElement('button', { className: "flex items-center gap-3 w-full p-3 rounded-lg hover:bg-gray-100 transition-colors text-left" },
                                React.createElement(CalendarIcon), React.createElement('span', { className: "text-gray-700" }, "I miei eventi")
                            ),
                            React.createElement('hr', { className: "my-4" }),
                            React.createElement('button', {
                                onClick: async () => {
                                    const client = window.getSupabase();
                                    if (client) await client.auth.signOut();
                                    window.location.reload();
                                },
                                className: "flex items-center gap-3 w-full p-3 rounded-lg hover:bg-red-50 transition-colors text-left text-red-600"
                            }, "🚪 Esci")
                        )
                    )
                )
            );
        }

        // Bottom Navigation
        function BottomNav({ currentView, setCurrentView }) {
            return React.createElement('nav', { className: "fixed bottom-0 left-0 right-0 z-40 bg-white border-t border-gray-200 rounded-t-3xl shadow-lg" },
                React.createElement('div', { className: "flex justify-around py-3" },
                    React.createElement('button', {
                        onClick: () => setCurrentView('home'),
                        className: `flex flex-col items-center p-2 transition-colors ${currentView === 'home' ? 'text-blue-600' : 'text-gray-400'}`
                    },
                        React.createElement(HomeIcon),
                        React.createElement('span', { className: "text-xs mt-1" }, "Eventi")
                    ),
                    React.createElement('button', {
                        onClick: () => setCurrentView('search'),
                        className: `flex flex-col items-center p-2 transition-colors ${currentView === 'search' ? 'text-blue-600' : 'text-gray-400'}`
                    },
                        React.createElement(SearchIcon),
                        React.createElement('span', { className: "text-xs mt-1" }, "Cerca")
                    ),
                    React.createElement('button', {
                        onClick: () => setCurrentView('create'),
                        className: "flex flex-col items-center p-2 -mt-4"
                    },
                        React.createElement('div', { className: "bg-gradient-blue text-white rounded-full p-3 shadow-lg hover:scale-105 transition-transform" },
                            React.createElement(PlusIcon)
                        ),
                        React.createElement('span', { className: "text-xs mt-1 text-orange-600" }, "Crea")
                    ),
                    React.createElement('button', {
                        onClick: () => setCurrentView('profile'),
                        className: `flex flex-col items-center p-2 transition-colors ${currentView === 'profile' ? 'text-blue-600' : 'text-gray-400'}`
                    },
                        React.createElement(UserIcon),
                        React.createElement('span', { className: "text-xs mt-1" }, "Profilo")
                    )
                )
            );
        }

        // Event Card Component
        function EventCard({ event, user, onUpdate, onClick }) {
            const categories = [
                { id: 'aperitivo', name: 'Aperitivi', icon: CoffeeIcon, color: 'bg-orange-100 text-orange-600' },
                { id: 'cinema', name: 'Cinema', icon: FilmIcon, color: 'bg-purple-100 text-purple-600' },
                { id: 'sport', name: 'Sport', icon: DumbbellIcon, color: 'bg-green-100 text-green-600' },
                { id: 'cultura', name: 'Cultura', icon: PaletteIcon, color: 'bg-blue-100 text-blue-600' }
            ];

            const categoryInfo = categories.find(cat => cat.id === event.category_id);
            const CategoryIcon = categoryInfo?.icon || CoffeeIcon;
            const isParticipant = event.event_participants?.some(p => p.user_id === user?.id);
            const participantCount = event.current_participants || 1;

            const handleJoinEvent = async (e) => {
                e.stopPropagation();
                if (!user) return alert('Devi effettuare il login per partecipare');
                
                try {
                    const client = window.getSupabase();
                    if (!client) return;

                    if (isParticipant) {
                        await client.from('event_participants').delete()
                            .eq('event_id', event.id).eq('user_id', user.id);
                    } else {
                        await client.from('event_participants').insert([{ 
                            event_id: event.id, 
                            user_id: user.id,
                            status: 'accepted'
                        }]);
                    }
                    onUpdate();
                } catch (error) {
                    console.error('Errore:', error);
                    alert('Errore durante l\'operazione');
                }
            };

            return React.createElement('div', {
                className: "card p-5 mb-4 cursor-pointer",
                onClick: onClick
            },
                React.createElement('div', { className: "flex justify-between items-start mb-3" },
                    React.createElement('div', { className: "flex gap-3" },
                        React.createElement('div', { className: `p-3 rounded-xl ${categoryInfo?.color || 'bg-gray-100'}` },
                            React.createElement(CategoryIcon)
                        ),
                        React.createElement('div', null,
                            React.createElement('h3', { className: "font-bold text-lg text-gray-900" }, event.title),
                            React.createElement('p', { className: "text-sm text-gray-500 mt-1" },
                                "da ", React.createElement('span', { className: "font-medium" }, event.profiles?.full_name || 'Utente'),
                                event.profiles?.rating && React.createElement('span', { className: "ml-2 inline-flex items-center gap-1" },
                                    React.createElement(StarIcon, { fill: true }),
                                    React.createElement('span', { className: "text-yellow-600 font-medium" }, event.profiles.rating)
                                )
                            )
                        )
                    )
                ),
                React.createElement('p', { className: "text-gray-600 mb-4 leading-relaxed" }, event.description),
                React.createElement('div', { className: "grid grid-cols-2 gap-3 mb-4" },
                    React.createElement('div', { className: "flex items-center gap-2 text-sm text-gray-600" },
                        React.createElement(MapPinIcon),
                        React.createElement('span', { className: "truncate" }, event.location)
                    ),
                    React.createElement('div', { className: "flex items-center gap-2 text-sm text-gray-600" },
                        React.createElement(UsersIcon),
                        React.createElement('span', null, participantCount, "/", event.max_participants)
                    ),
                    React.createElement('div', { className: "flex items-center gap-2 text-sm text-gray-600" },
                        React.createElement(CalendarIcon),
                        React.createElement('span', null, new Date(event.event_date).toLocaleDateString('it-IT', { 
                            day: 'numeric', 
                            month: 'short' 
                        }))
                    ),
                    React.createElement('div', { className: "flex items-center gap-2 text-sm text-gray-600" },
                        React.createElement(ClockIcon),
                        React.createElement('span', null, event.event_time?.substring(0, 5))
                    )
                ),
                event.price && React.createElement('div', { className: "mb-4" },
                    React.createElement('span', { className: "inline-block bg-green-100 text-green-700 px-3 py-1 rounded-full text-sm font-medium" },
                        event.price
                    )
                ),
                React.createElement('button', {
                    onClick: handleJoinEvent,
                    disabled: !isParticipant && participantCount >= event.max_participants,
                    className: `w-full py-3 rounded-xl font-semibold transition-all ${
                        isParticipant
                            ? 'btn-secondary'
                            : participantCount >= event.max_participants
                            ? 'bg-gray-100 text-gray-400 cursor-not-allowed'
                            : 'btn btn-primary'
                    }`
                },
                    isParticipant 
                        ? 'Abbandona evento' 
                        : participantCount >= event.max_participants 
                        ? 'Evento completo'
                        : 'Partecipa'
                )
            );
        }

        // Category Card Component
        function CategoryCard({ category, count, onClick, isSelected }) {
            const IconComponent = category.icon;
            return React.createElement('button', {
                onClick: onClick,
                className: `card p-4 transition-all ${category.color} ${isSelected ? 'ring-2 ring-blue-500' : ''}`
            },
                React.createElement(IconComponent),
                React.createElement('h3', { className: "font-semibold mt-2" }, category.name),
                React.createElement('p', { className: "text-sm opacity-75" }, count, " eventi")
            );
        }

        // Create Event Form
        function CreateEventForm({ user, onClose, onSuccess }) {
            const [formData, setFormData] = useState({
                title: '',
                description: '',
                category_id: 'aperitivo',
                location: '',
                event_date: '',
                event_time: '',
                max_participants: 10,
                price: ''
            });
            const [loading, setLoading] = useState(false);

            const categories = [
                { id: 'aperitivo', name: 'Aperitivi', icon: CoffeeIcon },
                { id: 'cinema', name: 'Cinema', icon: FilmIcon },
                { id: 'sport', name: 'Sport', icon: DumbbellIcon },
                { id: 'cultura', name: 'Cultura', icon: PaletteIcon }
            ];

            const handleSubmit = async (e) => {
                e.preventDefault();
                setLoading(true);
                
                try {
                    const client = window.getSupabase();
                    if (!client) throw new Error('Client non disponibile');

                    const { data: newEvent, error: eventError } = await client
                        .from('events')
                        .insert([{
                            ...formData,
                            organizer_id: user.id,
                            current_participants: 1
                        }])
                        .select()
                        .single();
                    
                    if (eventError) throw eventError;
                    
                    const { error: participantError } = await client
                        .from('event_participants')
                        .insert([{ 
                            event_id: newEvent.id,
                            user_id: user.id,
                            status: 'accepted'
                        }]);
                    
                    if (participantError) throw participantError;
                    
                    onSuccess();
                    onClose();
                } catch (error) {
                    alert('Errore durante la creazione dell\'evento: ' + error.message);
                } finally {
                    setLoading(false);
                }
            };

            return React.createElement('div', { className: "fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50" },
                React.createElement('div', { className: "bg-white rounded-2xl p-6 w-full max-w-md max-h-90vh overflow-y-auto" },
                    React.createElement('h2', { className: "text-2xl font-bold mb-6" }, "Crea nuovo evento"),
                    React.createElement('form', { onSubmit: handleSubmit, className: "space-y-4" },
                        React.createElement('div', null,
                            React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-1" }, "Titolo"),
                            React.createElement('input', {
                                type: "text",
                                required: true,
                                value: formData.title,
                                onChange: e => setFormData({ ...formData, title: e.target.value }),
                                className: "input"
                            })
                        ),
                        React.createElement('div', null,
                            React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-1" }, "Descrizione"),
                            React.createElement('textarea', {
                                required: true,
                                value: formData.description,
                                onChange: e => setFormData({ ...formData, description: e.target.value }),
                                rows: 3,
                                className: "input"
                            })
                        ),
                        React.createElement('div', null,
                            React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-1" }, "Categoria"),
                            React.createElement('select', {
                                value: formData.category_id,
                                onChange: e => setFormData({ ...formData, category_id: e.target.value }),
                                className: "input"
                            },
                                categories.map(cat =>
                                    React.createElement('option', { key: cat.id, value: cat.id }, cat.name)
                                )
                            )
                        ),
                        React.createElement('div', null,
                            React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-1" }, "Luogo"),
                            React.createElement('input', {
                                type: "text",
                                required: true,
                                value: formData.location,
                                onChange: e => setFormData({ ...formData, location: e.target.value }),
                                placeholder: "es. Bar Centrale, Via Roma 1",
                                className: "input"
                            })
                        ),
                        React.createElement('div', { className: "grid grid-cols-2 gap-2" },
                            React.createElement('div', null,
                                React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-1" }, "Data"),
                                React.createElement('input', {
                                    type: "date",
                                    required: true,
                                    min: new Date().toISOString().split('T')[0],
                                    value: formData.event_date,
                                    onChange: e => setFormData({ ...formData, event_date: e.target.value }),
                                    className: "input"
                                })
                            ),
                            React.createElement('div', null,
                                React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-1" }, "Ora"),
                                React.createElement('input', {
                                    type: "time",
                                    required: true,
                                    value: formData.event_time,
                                    onChange: e => setFormData({ ...formData, event_time: e.target.value }),
                                    className: "input"
                                })
                            )
                        ),
                        React.createElement('div', { className: "grid grid-cols-2 gap-2" },
                            React.createElement('div', null,
                                React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-1" }, "Partecipanti max"),
                                React.createElement('input', {
                                    type: "number",
                                    min: "2",
                                    max: "100",
                                    required: true,
                                    value: formData.max_participants,
                                    onChange: e => setFormData({ ...formData, max_participants: parseInt(e.target.value, 10) }),
                                    className: "input"
                                })
                            ),
                            React.createElement('div', null,
                                React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-1" }, "Prezzo"),
                                React.createElement('input', {
                                    type: "text",
                                    value: formData.price,
                                    onChange: e => setFormData({ ...formData, price: e.target.value }),
                                    placeholder: "es. €10 o Gratuito",
                                    className: "input"
                                })
                            )
                        ),
                        React.createElement('div', { className: "flex gap-2 mt-6" },
                            React.createElement('button', {
                                type: "button",
                                onClick: onClose,
                                className: "btn-secondary flex-1"
                            }, "Annulla"),
                            React.createElement('button', {
                                type: "submit",
                                disabled: loading,
                                className: "btn btn-primary flex-1"
                            }, loading ? "Creazione..." : "Crea evento")
                        )
                    )
                )
            );
        }

        // Event Detail Component
        function EventDetail({ event, user, onClose, onUpdate }) {
            const [showChat, setShowChat] = useState(false);
            const [participants, setParticipants] = useState([]);
            const [loading, setLoading] = useState(true);

            const isParticipant = participants.some(p => p.user_id === user?.id);
            const isOrganizer = event.organizer_id === user?.id;
            const canAccessChat = isParticipant || isOrganizer;

            useEffect(() => {
                loadParticipants();
            }, [event.id]);

            const loadParticipants = async () => {
                try {
                    const client = window.getSupabase();
                    if (!client) return;

                    const { data, error } = await client
                        .from('event_participants')
                        .select(`*, profiles (username, full_name)`)
                        .eq('event_id', event.id)
                        .eq('status', 'accepted');
                    
                    if (error) throw error;
                    setParticipants(data || []);
                } catch (error) {
                    console.error('Errore nel caricamento partecipanti:', error);
                } finally {
                    setLoading(false);
                }
            };

            const handleJoinEvent = async () => {
                if (!user) return alert('Devi effettuare il login per partecipare');
                
                try {
                    const client = window.getSupabase();
                    if (!client) return;

                    if (isParticipant) {
                        await client.from('event_participants').delete()
                            .eq('event_id', event.id).eq('user_id', user.id);
                    } else {
                        await client.from('event_participants').insert([{ 
                            event_id: event.id, 
                            user_id: user.id,
                            status: 'accepted'
                        }]);
                    }
                    await loadParticipants();
                    onUpdate && onUpdate();
                } catch (error) {
                    console.error('Errore:', error);
                    alert('Errore durante l\'operazione');
                }
            };

            if (showChat && canAccessChat) {
                return React.createElement(EventChat, {
                    eventId: event.id,
                    user: user,
                    participants: participants,
                    onClose: () => setShowChat(false)
                });
            }

            return React.createElement('div', { className: "fixed inset-0 bg-white z-50 overflow-y-auto" },
                React.createElement('div', { className: "bg-white border-b border-gray-200 p-4 flex items-center gap-3 sticky top-0" },
                    React.createElement('button', {
                        onClick: onClose,
                        className: "p-2 rounded-lg text-gray-600 hover:bg-gray-100"
                    }, React.createElement(XIcon)),
                    React.createElement('h1', { className: "font-semibold text-lg flex-1" }, "Dettagli Evento"),
                    canAccessChat && React.createElement('button', {
                        onClick: () => setShowChat(true),
                        className: "p-2 rounded-lg bg-blue-100 text-blue-600 hover:bg-blue-200 transition-colors"
                    }, React.createElement(MessageCircleIcon))
                ),
                React.createElement('div', { className: "p-6 space-y-6" },
                    React.createElement('div', null,
                        React.createElement('h2', { className: "text-2xl font-bold text-gray-900 mb-2" }, event.title),
                        React.createElement('div', { className: "flex items-center gap-2 text-gray-600" },
                            React.createElement('span', null, "Organizzato da"),
                            React.createElement('span', { className: "font-medium" }, event.profiles?.full_name || 'Utente'),
                            event.profiles?.rating && React.createElement('div', { className: "flex items-center gap-1" },
                                React.createElement(StarIcon, { fill: true }),
                                React.createElement('span', { className: "text-yellow-600 text-sm" }, event.profiles.rating)
                            )
                        )
                    ),
                    React.createElement('div', null,
                        React.createElement('h3', { className: "font-semibold text-gray-900 mb-2" }, "Descrizione"),
                        React.createElement('p', { className: "text-gray-700 leading-relaxed" }, event.description)
                    ),
                    React.createElement('div', { className: "grid grid-cols-1 gap-4" },
                        React.createElement('div', { className: "flex items-center gap-3 p-4 bg-gray-50 rounded-lg" },
                            React.createElement(CalendarIcon),
                            React.createElement('div', null,
                                React.createElement('p', { className: "font-medium" }, "Data"),
