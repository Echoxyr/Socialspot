<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SocialSpot</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;
        const { createClient } = supabase;

        const SUPABASE_URL = 'https://wsmjnssfmujdfgthyizw.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndzbWpuc3NmbXVqZGZndGh5aXp3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA4ODA3NjIsImV4cCI6MjA2NjQ1Njc2Mn0.t91X-fGIolFBPnhr5_sexJMqzgdCDmXuEUXiL_pFId4';

        const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // --- ICONS ---
const { useState, useEffect } = React;
const { createClient } = supabase;

// Configurazione Supabase (con le tue chiavi)
const SUPABASE_URL = 'https://wsmjnssfmujdfgthyizw.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndzbWpuc3NmbXVqZGZndGh5aXp3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA4ODA3NjIsImV4cCI6MjA2NjQ1Njc2Mn0.t91X-fGIolFBPnhr5_sexJMqzgdCDmXuEUXiL_pFId4';
const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

// === ICONS ===
const HomeIcon = () => (
  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
    <polyline points="9 22 9 12 15 12 15 22"></polyline>
  </svg>
);
const SearchIcon = () => (
  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <circle cx="11" cy="11" r="8"></circle>
    <path d="m21 21-4.35-4.35"></path>
  </svg>
);
const PlusIcon = () => (
  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <line x1="12" y1="5" x2="12" y2="19"></line>
    <line x1="5" y1="12" x2="19" y2="12"></line>
  </svg>
);
const UserIcon = () => (
  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path>
    <circle cx="12" cy="7" r="4"></circle>
  </svg>
);
const MapPinIcon = ({ size = 24 }) => (
  <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
    <circle cx="12" cy="10" r="3"></circle>
  </svg>
);
const CalendarIcon = ({ size = 24 }) => (
  <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
    <line x1="16" y1="2" x2="16" y2="6"></line>
    <line x1="8" y1="2" x2="8" y2="6"></line>
    <line x1="3" y1="10" x2="21" y2="10"></line>
  </svg>
);
const ClockIcon = ({ size = 24 }) => (
  <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <circle cx="12" cy="12" r="10"></circle>
    <polyline points="12 6 12 12 16 14"></polyline>
  </svg>
);
const UsersIcon = ({ size = 24 }) => (
  <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
    <circle cx="9" cy="7" r="4"></circle>
    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
  </svg>
);
const StarIcon = ({ size = 24, fill = false }) => (
  <svg width={size} height={size} viewBox="0 0 24 24" fill={fill ? "currentColor" : "none"} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
  </svg>
);
const CoffeeIcon = ({ size = 24 }) => (
  <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <path d="M18 8h1a4 4 0 0 1 0 8h-1"></path>
    <path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"></path>
    <line x1="6" y1="1" x2="6" y2="4"></line>
    <line x1="10" y1="1" x2="10" y2="4"></line>
    <line x1="14" y1="1" x2="14" y2="4"></line>
  </svg>
);
const FilmIcon = ({ size = 24 }) => (
  <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18"></rect>
    <line x1="7" y1="2" x2="7" y2="22"></line>
    <line x1="17" y1="2" x2="17" y2="22"></line>
    <line x1="2" y1="12" x2="22" y2="12"></line>
    <line x1="2" y1="7" x2="7" y2="7"></line>
    <line x1="2" y1="17" x2="7" y2="17"></line>
    <line x1="17" y1="17" x2="22" y2="17"></line>
    <line x1="17" y1="7" x2="22" y2="7"></line>
  </svg>
);
const DumbbellIcon = ({ size = 24 }) => (
  <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <path d="m6.5 6.5 11 11"></path>
    <path d="M21 21v-7a2 2 0 0 0-4 0v7"></path>
    <path d="M3 3h7a2 2 0 0 1 0 4H3"></path>
    <path d="M14 3h7a2 2 0 0 1 0 4h-7"></path>
    <path d="M3 17v4a2 2 0 0 0 4 0v-4"></path>
  </svg>
);
const PaletteIcon = ({ size = 24 }) => (
  <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <circle cx="13.5" cy="6.5" r=".5"></circle>
    <circle cx="17.5" cy="10.5" r=".5"></circle>
    <circle cx="8.5" cy="7.5" r=".5"></circle>
    <circle cx="6.5" cy="12.5" r=".5"></circle>
    <path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z"></path>
  </svg>
);
const LogOutIcon = ({ size = 24 }) => (
  <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
    <polyline points="16 17 21 12 16 7"></polyline>
    <line x1="21" y1="12" x2="9" y2="12"></line>
  </svg>
);

// === AuthForm ===
const AuthForm = ({ onSuccess }) => {
  const [isLogin, setIsLogin] = useState(true);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState('');
  const [formData, setFormData] = useState({
    email: '',
    password: '',
    username: '',
    fullName: '',
    city: 'Milano',
    district: ''
  });

  const handleSubmit = async (e) => {
    e.preventDefault();
    setLoading(true);
    setError('');
    try {
      if (isLogin) {
        const { error } = await supabaseClient.auth.signInWithPassword({
          email: formData.email,
          password: formData.password
        });
        if (error) throw error;
      } else {
        const { error } = await supabaseClient.auth.signUp({
          email: formData.email,
          password: formData.password,
          options: {
            data: {
              username: formData.username,
              full_name: formData.fullName,
              city: formData.city,
              district: formData.district
            }
          }
        });
        if (error) throw error;
      }
      onSuccess();
    } catch (error) {
      setError(error.message);
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-600 to-orange-500 flex items-center justify-center p-4">
      <div className="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md">
        <div className="text-center mb-8">
          <div className="w-20 h-20 bg-gradient-to-r from-blue-600 to-orange-500 rounded-2xl flex items-center justify-center mx-auto mb-4">
            <span className="text-white font-bold text-3xl">SS</span>
          </div>
          <h1 className="text-3xl font-bold bg-gradient-to-r from-blue-600 to-orange-500 bg-clip-text text-transparent">
            SocialSpot
          </h1>
          <p className="text-gray-600 mt-2">Connettiti con eventi locali</p>
        </div>

        <form onSubmit={handleSubmit} className="space-y-4">
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">Email</label>
            <input type="email" required value={formData.email}
              onChange={e => setFormData({ ...formData, email: e.target.value })}
              className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">Password</label>
            <input type="password" required value={formData.password}
              onChange={e => setFormData({ ...formData, password: e.target.value })}
              className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            />
          </div>
          {!isLogin && <>
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">Username</label>
              <input type="text" required value={formData.username}
                onChange={e => setFormData({ ...formData, username: e.target.value })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              />
            </div>
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">Nome completo</label>
              <input type="text" required value={formData.fullName}
                onChange={e => setFormData({ ...formData, fullName: e.target.value })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              />
            </div>
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">Quartiere</label>
              <input type="text" value={formData.district}
                onChange={e => setFormData({ ...formData, district: e.target.value })}
                placeholder="es. Navigli"
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              />
            </div>
          </>}
          {error && <div className="bg-red-50 text-red-600 p-3 rounded-lg text-sm">{error}</div>}
          <button type="submit" disabled={loading}
            className="w-full bg-gradient-to-r from-blue-600 to-orange-500 text-white py-3 rounded-lg font-semibold hover:opacity-90 disabled:opacity-50"
          >
            {loading ? 'Caricamento...' : (isLogin ? 'Accedi' : 'Registrati')}
          </button>
        </form>
        <div className="mt-6 text-center">
          <button onClick={() => { setIsLogin(!isLogin); setError(''); }}
            className="text-blue-600 hover:underline">
            {isLogin ? 'Non hai un account? Registrati' : 'Hai già un account? Accedi'}
          </button>
        </div>
      </div>
    </div>
  );
};

// === Main App ===
const SocialSpot = () => {
  const [currentView, setCurrentView] = useState('home');
  const [user, setUser] = useState(null);
  const [profile, setProfile] = useState(null);
  const [events, setEvents] = useState([]);
  const [loading, setLoading] = useState(true);

  const categories = [
    { id: 'aperitivo', name: 'Aperitivi', icon: CoffeeIcon, color: 'bg-orange-100 text-orange-600' },
    { id: 'cinema', name: 'Cinema', icon: FilmIcon, color: 'bg-purple-100 text-purple-600' },
    { id: 'sport', name: 'Sport', icon: DumbbellIcon, color: 'bg-green-100 text-green-600' },
    { id: 'cultura', name: 'Cultura', icon: PaletteIcon, color: 'bg-blue-100 text-blue-600' }
  ];

  useEffect(() => {
    checkUser();
    loadEvents();
  }, []);

  const checkUser = async () => {
    try {
      const { data: { user } } = await supabaseClient.auth.getUser();
      if (user) {
        setUser(user);
        loadProfile(user.id);
      }
    } catch { } finally {
      setLoading(false);
    }
  };
  const loadProfile = async (userId) => {
    try {
      const { data } = await supabaseClient
        .from('profiles')
        .select('*')
        .eq('id', userId)
        .single();
      setProfile(data);
    } catch { }
  };
  const loadEvents = async () => {
    try {
      const { data } = await supabaseClient
        .from('events')
        .select(`
          *,
          profiles!organizer_id (username, full_name, rating),
          event_participants (user_id)
        `)
        .gte('event_date', new Date().toISOString().split('T')[0])
        .order('event_date', { ascending: true });
      setEvents(data || []);
    } catch { }
  };
  const handleLogout = async () => {
    await supabaseClient.auth.signOut();
    setUser(null);
    setProfile(null);
  };

  // EVENT CARD
  const EventCard = ({ event }) => {
    const categoryInfo = categories.find(cat => cat.id === event.category_id);
    const CategoryIcon = categoryInfo?.icon || CoffeeIcon;
    const isParticipant = event.event_participants?.some(p => p.user_id === user?.id);

    const handleJoinEvent = async () => {
      if (!user) return alert('Devi effettuare il login per partecipare');
      try {
        if (isParticipant) {
          await supabaseClient.from('event_participants')
            .delete()
            .eq('event_id', event.id)
            .eq('user_id', user.id);
        } else {
          await supabaseClient.from('event_participants')
            .insert([{ event_id: event.id, user_id: user.id }]);
        }
        loadEvents();
      } catch {
        alert('Errore durante l\'operazione');
      }
    };

    return (
      <div className="bg-white rounded-xl shadow-sm border border-gray-100 p-4 mb-4">
        <div className="flex items-start justify-between mb-3">
          <div className="flex items-center gap-3">
            <div className={`p-2 rounded-lg ${categoryInfo?.color || 'bg-gray-100'}`}>
              <CategoryIcon size={20} />
            </div>
            <div>
              <h3 className="font-semibold text-gray-900">{event.title}</h3>
              <p className="text-sm text-gray-600">da {event.profiles?.full_name || 'Utente'}</p>
            </div>
          </div>
          <div className="flex items-center gap-1 text-yellow-500">
            <StarIcon size={16} fill={true} />
            <span className="text-sm font-medium">{event.profiles?.rating || 5.0}</span>
          </div>
        </div>
        <p className="text-gray-700 mb-4 text-sm">{event.description}</p>
        <div className="space-y-2 mb-4">
          <div className="flex items-center gap-2 text-sm text-gray-600">
            <MapPinIcon size={16} />
            <span>{event.location}</span>
          </div>
          <div className="flex items-center gap-4 text-sm text-gray-600">
            <div className="flex items-center gap-1">
              <CalendarIcon size={16} />
              <span>{new Date(event.event_date).toLocaleDateString('it-IT')}</span>
            </div>
            <div className="flex items-center gap-1">
              <ClockIcon size={16} />
              <span>{event.event_time}</span>
            </div>
          </div>
          <div className="flex items-center justify-between text-sm text-gray-600">
            <div className="flex items-center gap-2">
              <UsersIcon size={16} />
              <span>{event.current_participants}/{event.max_participants} partecipanti</span>
            </div>
            <span className="bg-green-100 text-green-700 px-2 py-1 rounded-full text-xs">
              {event.price || 'Gratuito'}
            </span>
          </div>
        </div>
        <div className="flex gap-2">
          <button
            onClick={handleJoinEvent}
            className={`flex-1 py-2 px-4 rounded-lg font-medium ${
              isParticipant
                ? 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                : 'bg-blue-600 text-white hover:bg-blue-700'
            }`}
          >
            {isParticipant ? 'Abbandona' : 'Partecipa'}
          </button>
          <button className="flex-1 border border-gray-300 text-gray-700 py-2 px-4 rounded-lg font-medium hover:bg-gray-50">
            Dettagli
          </button>
        </div>
      </div>
    );
  };

  // FORM CREAZIONE EVENTO
  const CreateEventForm = ({ onClose, onSuccess }) => {
    const [formData, setFormData] = useState({
      title: '',
      description: '',
      category_id: 'aperitivo',
      location: '',
      event_date: '',
      event_time: '',
      max_participants: 10,
      price: ''
    });
    const [loading, setLoading] = useState(false);

    const handleSubmit = async (e) => {
      e.preventDefault();
      setLoading(true);
      try {
        await supabaseClient
          .from('events')
          .insert([{ ...formData, organizer_id: user.id }]);
        onSuccess();
        onClose();
      } catch {
        alert('Errore durante la creazione dell\'evento');
      } finally {
        setLoading(false);
      }
    };

    return (
      <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div className="bg-white rounded-xl p-6 w-full max-w-md max-h-[90vh] overflow-y-auto">
          <h2 className="text-xl font-bold mb-4">Crea nuovo evento</h2>
          <form onSubmit={handleSubmit} className="space-y-4">
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">Titolo</label>
              <input
                type="text"
                required
                value={formData.title}
                onChange={e => setFormData({ ...formData, title: e.target.value })}
                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
              />
            </div>
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">Descrizione</label>
              <textarea
                required
                value={formData.description}
                onChange={e => setFormData({ ...formData, description: e.target.value })}
                rows={3}
                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
              />
            </div>
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">Categoria</label>
              <select
                value={formData.category_id}
                onChange={e => setFormData({ ...formData, category_id: e.target.value })}
                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
              >
                {categories.map(cat => (
                  <option key={cat.id} value={cat.id}>{cat.name}</option>
                ))}
              </select>
            </div>
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">Luogo</label>
              <input
                type="text"
                required
                value={formData.location}
                onChange={e => setFormData({ ...formData, location: e.target.value })}
                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
              />
            </div>
            <div className="flex gap-2">
              <div className="w-1/2">
                <label className="block text-sm font-medium text-gray-700 mb-1">Data</label>
                <input
                  type="date"
                  required
                  value={formData.event_date}
                  onChange={e => setFormData({ ...formData, event_date: e.target.value })}
                  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                />
              </div>
              <div className="w-1/2">
                <label className="block text-sm font-medium text-gray-700 mb-1">Ora</label>
                <input
                  type="time"
                  required
                  value={formData.event_time}
                  onChange={e => setFormData({ ...formData, event_time: e.target.value })}
                  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                />
              </div>
            </div>
            <div className="flex gap-2">
              <div className="w-1/2">
                <label className="block text-sm font-medium text-gray-700 mb-1">Partecipanti max</label>
                <input
                  type="number"
                  min="2"
                  max="100"
                  required
                  value={formData.max_participants}
                  onChange={e => setFormData({ ...formData, max_participants: parseInt(e.target.value, 10) })}
                  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                />
              </div>
              <div className="w-1/2">
                <label className="block text-sm font-medium text-gray-700 mb-1">Prezzo (€ o "Gratuito")</label>
                <input
                  type="text"
                  value={formData.price}
                  onChange={e => setFormData({ ...formData, price: e.target.value })}
                  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                />
              </div>
            </div>
            <div className="flex gap-2 mt-4">
              <button
                type="button"
                onClick={onClose}
                className="flex-1 py-2 rounded-lg bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold"
              >
                Annulla
              </button>
              <button
                type="submit"
                disabled={loading}
                className="flex-1 py-2 rounded-lg bg-blue-600 hover:bg-blue-700 text-white font-semibold"
              >
                {loading ? "Creazione..." : "Crea evento"}
              </button>
            </div>
          </form>
        </div>
      </div>
    );
  };

  // BOTTOM NAV
  const BottomNav = ({ view, setView, onLogout }) => (
    <nav className="fixed bottom-0 left-0 right-0 z-50 bg-white border-t border-gray-200 flex justify-around py-2 shadow-xl rounded-t-2xl">
      <button className={`flex flex-col items-center ${view === 'home' ? 'text-blue-600' : 'text-gray-500'}`} onClick={() => setView('home')}>
        <HomeIcon />
        <span className="text-xs">Eventi</span>
      </button>
      <button className={`flex flex-col items-center ${view === 'search' ? 'text-blue-600' : 'text-gray-500'}`} onClick={() => setView('search')}>
        <SearchIcon />
        <span className="text-xs">Cerca</span>
      </button>
      <button className="flex flex-col items-center text-orange-600" onClick={() => setView('create')}>
        <PlusIcon />
        <span className="text-xs">Nuovo</span>
      </button>
      <button className={`flex flex-col items-center ${view === 'profile' ? 'text-blue-600' : 'text-gray-500'}`} onClick={() => setView('profile')}>
        <UserIcon />
        <span className="text-xs">Profilo</span>
      </button>
      <button className="flex flex-col items-center text-gray-500" onClick={onLogout}>
        <LogOutIcon />
        <span className="text-xs">Esci</span>
      </button>
    </nav>
  );

  // PROFILO
  const ProfileSection = ({ profile }) => (
    <div className="flex flex-col items-center pt-8 pb-20 px-6">
      <div className="w-24 h-24 rounded-full bg-gradient-to-r from-blue-600 to-orange-400 flex items-center justify-center text-white text-3xl font-bold shadow-lg mb-4">
        {profile?.username?.substring(0, 2)?.toUpperCase() || "UT"}
      </div>
      <div className="text-center">
        <h2 className="text-2xl font-semibold">{profile?.full_name}</h2>
        <div className="text-gray-600">@{profile?.username}</div>
        <div className="mt-2 text-sm text-gray-700">{profile?.city} {profile?.district ? `- ${profile.district}` : ""}</div>
        <div className="mt-2 flex items-center justify-center gap-1 text-yellow-500">
          <StarIcon size={18} fill={true} />
          <span className="font-semibold">{profile?.rating || 5.0}</span>
        </div>
      </div>
    </div>
  );

  // SEARCH STATE
  const [searchTerm, setSearchTerm] = useState("");
  const filteredEvents = searchTerm
    ? events.filter(ev =>
        (ev.title?.toLowerCase().includes(searchTerm.toLowerCase()) ||
         ev.description?.toLowerCase().includes(searchTerm.toLowerCase()) ||
         ev.location?.toLowerCase().includes(searchTerm.toLowerCase()) ||
         ev.category_id?.toLowerCase().includes(searchTerm.toLowerCase()))
      )
    : events;

  if (loading) {
    return (
      <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-600 to-orange-500">
        <div className="bg-white rounded-2xl shadow-xl px-8 py-8">
          <span className="block text-2xl font-bold text-blue-600 animate-pulse">Caricamento...</span>
        </div>
      </div>
    );
  }

  if (!user) {
    return <AuthForm onSuccess={checkUser} />;
  }

  return (
    <div className="min-h-screen pb-20 bg-gradient-to-br from-blue-100 to-orange-100">
      {/* Header */}
      <header className="sticky top-0 bg-white shadow z-20 px-4 py-3 flex items-center justify-between">
        <div className="flex items-center gap-2">
          <span className="bg-gradient-to-r from-blue-600 to-orange-500 text-white rounded-xl px-3 py-2 text-lg font-bold">SS</span>
          <span className="font-semibold text-xl text-gray-800">SocialSpot</span>
        </div>
        <button onClick={handleLogout} className="text-gray-400 hover:text-red-500" title="Logout">
          <LogOutIcon size={24} />
        </button>
      </header>
      {/* Viste */}
      <main className="px-4 max-w-lg mx-auto pt-4 pb-20">
        {currentView === 'home' && (
          <>
            <h2 className="text-xl font-bold mb-2 text-blue-800">Eventi nelle vicinanze</h2>
            {events.length === 0 && (
              <div className="text-center text-gray-500 mt-8">
                Nessun evento trovato.
              </div>
            )}
            {events.map(event => (
              <EventCard event={event} key={event.id} />
            ))}
          </>
        )}
        {currentView === 'search' && (
          <div>
            <input
              type="text"
              placeholder="Cerca eventi, luoghi o categorie..."
              value={searchTerm}
              onChange={e => setSearchTerm(e.target.value)}
              className="w-full mb-4 px-4 py-2 rounded-lg border border-blue-300 focus:ring-2 focus:ring-blue-500"
            />
            {filteredEvents.length === 0 && (
              <div className="text-center text-gray-500 mt-8">
                Nessun risultato per la ricerca.
              </div>
            )}
            {filteredEvents.map(event => (
              <EventCard event={event} key={event.id} />
            ))}
          </div>
        )}
        {currentView === 'profile' && profile && (
          <ProfileSection profile={profile} />
        )}
        {currentView === 'create' && (
          <CreateEventForm onClose={() => setCurrentView('home')} onSuccess={loadEvents} />
        )}
      </main>
      <BottomNav view={currentView} setView={setCurrentView} onLogout={handleLogout} />
    </div>
  );
};

// RENDER
ReactDOM.createRoot(document.getElementById("root")).render(<SocialSpot />);


    </script>
</body>
</html>
