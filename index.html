<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SocialNet Neural - AI-Powered Social Events</title>
    
    <!-- Essential Meta Tags -->
    <meta name="description" content="SocialNet Neural: La piattaforma AI per eventi sociali intelligenti. Connetti, scopri, partecipa con l'aiuto dell'intelligenza artificiale.">
    <meta name="keywords" content="eventi, social, AI, intelligenza artificiale, networking, community">
    <meta name="author" content="SocialNet Neural Team">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://socialnet-neural.vercel.app/">
    <meta property="og:title" content="SocialNet Neural - AI-Powered Social Events">
    <meta property="og:description" content="La prima piattaforma che usa l'AI per creare eventi perfetti e connessioni autentiche.">
    <meta property="og:image" content="/og-image.jpg">
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="SocialNet Neural">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    <link rel="manifest" href="/manifest.json">
    
    <!-- External CSS Libraries -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Space+Grotesk:wght@600;700&display=swap" rel="stylesheet">
    
    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- React 18 -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Custom Styles -->
    <link rel="stylesheet" href="./style.css">
    
    <!-- Schema.org Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "SocialNet Neural",
        "description": "AI-powered platform for intelligent social events and networking",
        "url": "https://socialnet-neural.vercel.app/",
        "applicationCategory": "SocialNetworkingApplication",
        "operatingSystem": "Web, iOS, Android"
    }
    </script>
</head>

<body>
    <!-- Initial Loading Screen -->
    <div id="initial-loader" class="loader-screen">
        <div class="loader-content">
            <div class="app-logo-loading">
                <div class="logo-icon-loading">
                    <span class="logo-text-loading">SN.n</span>
                    <div class="loading-rings">
                        <div class="ring ring-1"></div>
                        <div class="ring ring-2"></div>
                        <div class="ring ring-3"></div>
                    </div>
                </div>
                <h1 class="brand-name-loading">SocialNet Neural</h1>
                <p class="brand-tagline">AI â€¢ Connetti â€¢ Scopri â€¢ Evolvi</p>
            </div>
            <div class="loading-progress">
                <div class="progress-bar" id="loading-progress"></div>
            </div>
            <div class="loading-text" id="loading-text">Inizializzazione AI Neural...</div>
        </div>
    </div>

    <!-- App Container -->
    <div id="root" class="app-root"></div>

    <!-- Neural Background Pattern -->
    <div class="neural-bg-pattern">
        <div class="neural-node"></div>
        <div class="neural-node"></div>
        <div class="neural-node"></div>
        <div class="neural-connection"></div>
        <div class="neural-connection"></div>
    </div>

    <!-- Service Worker Registration -->
    <script>
        // Service Worker for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('âœ… SW registered: ', registration);
                    })
                    .catch(registrationError => {
                        console.log('âŒ SW registration failed: ', registrationError);
                    });
            });
        }

        // Progress simulation
        let progress = 0;
        const progressBar = document.getElementById('loading-progress');
        const loadingText = document.getElementById('loading-text');
        
        const loadingSteps = [
            'Inizializzazione AI Neural...',
            'Caricamento modelli neurali...',
            'Connessione a Supabase...',
            'Preparazione interfaccia...',
            'Attivazione sistemi AI...',
            'Pronto per l\'evoluzione!'
        ];

        let stepIndex = 0;
        const loadingInterval = setInterval(() => {
            progress += Math.random() * 20;
            if (progress > 100) progress = 100;
            
            progressBar.style.width = progress + '%';
            
            if (progress > (stepIndex + 1) * 16.6 && stepIndex < loadingSteps.length - 1) {
                stepIndex++;
                loadingText.textContent = loadingSteps[stepIndex];
            }
            
            if (progress >= 100) {
                clearInterval(loadingInterval);
                setTimeout(() => {
                    document.getElementById('initial-loader').style.opacity = '0';
                    setTimeout(() => {
                        document.getElementById('initial-loader').style.display = 'none';
                    }, 500);
                }, 800);
            }
        }, 150);
    </script>

    <!-- Load Components and App -->
    <script src="./components.js"></script>
    <script src="./app.js"></script>

    <!-- Neural App Script -->
    <script>
        // ðŸ§  SOCIALNET NEURAL - MAIN APPLICATION
        const { useState, useEffect, useCallback, useMemo, memo } = React;

        // ðŸ”¹ Enhanced Supabase Configuration
        const SUPABASE_URL = 'https://wsmjnssfmujdfgthyizw.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndzbWpuc3NmbXVqZGZndGh5aXp3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA4ODA3NjIsImV4cCI6MjA2NjQ1Njc2Mn0.t91X-fGIolFBPnhr5_sexJMqzgdCDmXuEUXiL_pFId4';
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // ðŸ§  Neural AI System Core
        const NeuralAI = {
            // Generate AI bio based on user interests and activity
            generateBio: async (userData) => {
                const prompts = [
                    `Un appassionato di ${userData.interests?.[0] || 'eventi'} che ama scoprire nuove avventure.`,
                    `Esploratore urbano sempre alla ricerca della prossima esperienza unica.`,
                    `Creativo sociale che trasforma momenti ordinari in ricordi straordinari.`,
                    `Innovatore delle connessioni umane, specialista in networking autentico.`
                ];
                return prompts[Math.floor(Math.random() * prompts.length)];
            },

            // Generate event suggestions with AI
            generateEventSuggestion: async (preferences) => {
                const categories = ['Sport', 'Musica', 'Arte', 'Cultura', 'Tecnologia', 'Cibo', 'Cinema'];
                const times = ['mattina', 'pomeriggio', 'sera', 'weekend'];
                const locations = ['centro', 'parco', 'quartiere', 'locale'];
                
                const category = preferences.category || categories[Math.floor(Math.random() * categories.length)];
                const time = times[Math.floor(Math.random() * times.length)];
                const location = locations[Math.floor(Math.random() * locations.length)];
                
                return {
                    title: `${category} AI-Generato`,
                    description: `Un evento ${category.toLowerCase()} creato dall'AI per la ${time} in ${location}. L'intelligenza artificiale ha analizzato le tue preferenze per creare l'esperienza perfetta.`,
                    category: category,
                    ageRange: preferences.ageRange || '18-35',
                    genderPreference: preferences.genderPreference || 'entrambi'
                };
            },

            // Generate AI avatar response for chat
            generateAvatarResponse: async (userProfile, lastMessage) => {
                const responses = [
                    `${userProfile.username} ama eventi ${userProfile.interests?.[0] || 'culturali'}, tornerÃ  presto online!`,
                    `L'AI di ${userProfile.username} dice: interessato agli stessi eventi? Parliamone quando torna!`,
                    `${userProfile.username} Ã¨ probabilmente ad un evento fantastico, risponderÃ  appena possibile!`,
                    `L'avatar AI di ${userProfile.username}: sempre pronto a nuove avventure sociali!`
                ];
                return responses[Math.floor(Math.random() * responses.length)];
            },

            // Generate WhatsApp invite message
            generateWhatsAppInvite: async (eventData) => {
                return `ðŸŽ‰ *${eventData.title}*\n\n${eventData.description}\n\nðŸ“… ${new Date(eventData.event_date).toLocaleDateString('it-IT')}\nðŸ“ ${eventData.location}\n\nðŸ’« Creato con SocialNet Neural AI\n\nPartecipa su: https://socialnet-neural.vercel.app/event/${eventData.id}`;
            },

            // Generate weekly community story
            generateWeeklyStory: async (eventsData, participationData) => {
                const totalEvents = eventsData.length;
                const totalParticipants = participationData.reduce((sum, event) => sum + event.participants_count, 0);
                
                return {
                    title: "Storia Settimanale della Community",
                    content: `Questa settimana la nostra community neurale ha creato ${totalEvents} eventi incredibili, coinvolgendo ${totalParticipants} persone! L'AI ha identificato nuove tendenze sociali e ha facilitato ${Math.floor(totalParticipants * 0.3)} nuove connessioni autentiche. Il futuro del networking sociale Ã¨ qui! ðŸš€ðŸ§ `,
                    highlights: [
                        `${totalEvents} eventi AI-ottimizzati`,
                        `${totalParticipants} partecipanti attivi`,
                        `${Math.floor(totalParticipants * 0.15)} nuove amicizie`
                    ]
                };
            },

            // DALL-E prompt generator for events
            generateImagePrompt: (eventData) => {
                const basePrompts = {
                    'Sport': 'dynamic sports activity with people having fun, modern style, vibrant colors',
                    'Musica': 'music event with instruments and people enjoying, artistic lighting, energetic atmosphere',
                    'Arte': 'art exhibition or creative workshop, contemporary gallery setting, inspiring mood',
                    'Cultura': 'cultural gathering, museum or historical setting, sophisticated atmosphere',
                    'Tecnologia': 'tech meetup, modern workspace, futuristic elements, innovative vibe',
                    'Cibo': 'food and dining experience, social gathering, appetizing presentation',
                    'Cinema': 'movie screening or film discussion, cinema setting, cinematic lighting'
                };
                
                const basePrompt = basePrompts[eventData.category] || 'social gathering with happy people, modern style';
                return `${basePrompt}, photorealistic, high quality, social media ready`;
            }
        };

        // ðŸš€ Main Neural App Component
        function NeuralApp() {
            const [user, setUser] = useState(null);
            const [currentPage, setCurrentPage] = useState('feed');
            const [initializing, setInitializing] = useState(true);
            const [notifications, setNotifications] = useState(0);
            const [aiProfile, setAiProfile] = useState(null);
            const [travelMode, setTravelMode] = useState(false);
            const [currentLocation, setCurrentLocation] = useState('Milano, IT');

            // Theme state
            const [theme, setTheme] = useState(() => {
                const stored = localStorage.getItem('socialnet-theme');
                return stored || 'dark';
            });

            // Initialize app
            useEffect(() => {
                const initApp = async () => {
                    try {
                        // Get initial session
                        const { data: { session } } = await supabase.auth.getSession();
                        setUser(session?.user ?? null);

                        // Set up auth listener
                        const { data: { subscription } } = supabase.auth.onAuthStateChange(
                            async (event, session) => {
                                setUser(session?.user ?? null);
                                
                                if (session?.user) {
                                    // Generate AI profile on first login
                                    await generateAIProfile(session.user);
                                }
                            }
                        );

                        setInitializing(false);
                        
                        return () => subscription.unsubscribe();
                    } catch (error) {
                        console.error('Initialization error:', error);
                        setInitializing(false);
                    }
                };

                initApp();
            }, []);

            // Generate AI profile
            const generateAIProfile = async (userData) => {
                try {
                    const { data: profile } = await supabase
                        .from('profiles')
                        .select('*')
                        .eq('id', userData.id)
                        .single();

                    if (profile && !profile.bio) {
                        const aiBio = await NeuralAI.generateBio(profile);
                        
                        await supabase
                            .from('profiles')
                            .update({ 
                                bio: aiBio,
                                updated_at: new Date().toISOString()
                            })
                            .eq('id', userData.id);
                    }
                    
                    setAiProfile(profile);
                } catch (error) {
                    console.error('AI Profile generation error:', error);
                }
            };

            // Theme toggle
            const toggleTheme = () => {
                const newTheme = theme === 'light' ? 'dark' : 'light';
                setTheme(newTheme);
                localStorage.setItem('socialnet-theme', newTheme);
                document.body.setAttribute('data-theme', newTheme);
            };

            // Show authentication if no user
            if (initializing) {
                return null; // Loading screen already shown
            }

            if (!user) {
                return (
                    <div className="neural-app">
                        <div className="auth-container">
                            {window.SocialSpotComponents?.Auth ? (
                                <window.SocialSpotComponents.Auth 
                                    supabase={supabase} 
                                    setUser={setUser} 
                                />
                            ) : (
                                <div className="auth-fallback">
                                    <h1>SocialNet Neural</h1>
                                    <p>Caricamento componenti di autenticazione...</p>
                                </div>
                            )}
                        </div>
                    </div>
                );
            }

            // Main app interface
            return (
                <div className="neural-app" data-theme={theme}>
                    {/* Main Header */}
                    <header className="neural-header">
                        <div className="header-content">
                            <div className="logo-section">
                                <div className="neural-logo">
                                    <span className="logo-text">SN.n</span>
                                    <div className="neural-pulse"></div>
                                </div>
                                <h1 className="app-title">SocialNet Neural</h1>
                            </div>
                            
                            <div className="header-actions">
                                <button 
                                    className="neural-btn secondary"
                                    onClick={() => setTravelMode(!travelMode)}
                                    title="ModalitÃ  Viaggiatore"
                                >
                                    <i className={`fas ${travelMode ? 'fa-map-marked-alt' : 'fa-map'}`}></i>
                                </button>
                                
                                <button 
                                    className="neural-btn secondary"
                                    onClick={toggleTheme}
                                    title="Cambia Tema"
                                >
                                    <i className={`fas ${theme === 'dark' ? 'fa-sun' : 'fa-moon'}`}></i>
                                </button>

                                <div className="notification-badge" onClick={() => setCurrentPage('notifications')}>
                                    <i className="fas fa-bell"></i>
                                    {notifications > 0 && <span className="badge-count">{notifications}</span>}
                                </div>
                            </div>
                        </div>
                    </header>

                    {/* Travel Mode Banner */}
                    {travelMode && (
                        <div className="travel-banner">
                            <i className="fas fa-plane"></i>
                            <span>ModalitÃ  Viaggiatore attiva â€¢ {currentLocation}</span>
                            <button onClick={() => setTravelMode(false)}>
                                <i className="fas fa-times"></i>
                            </button>
                        </div>
                    )}

                    {/* Main Content */}
                    <main className="neural-main">
                        {currentPage === 'feed' && (
                            <div className="page-content">
                                {window.SocialSpotComponents?.EventFeed ? (
                                    <window.SocialSpotComponents.EventFeed 
                                        supabase={supabase} 
                                        user={user}
                                        aiProfile={aiProfile}
                                        travelMode={travelMode}
                                        currentLocation={currentLocation}
                                    />
                                ) : (
                                    <div className="fallback-content">
                                        <h2>Feed Eventi Neural</h2>
                                        <p>Caricamento eventi AI-powered...</p>
                                    </div>
                                )}
                            </div>
                        )}

                        {currentPage === 'search' && (
                            <div className="page-content">
                                <div className="search-container">
                                    <h2>Ricerca Neural</h2>
                                    <p>Trova utenti e eventi con l'AI</p>
                                </div>
                            </div>
                        )}

                        {currentPage === 'create' && (
                            <div className="page-content">
                                {window.SocialSpotComponents?.CreateEvent ? (
                                    <window.SocialSpotComponents.CreateEvent 
                                        supabase={supabase} 
                                        user={user}
                                        onEventCreated={() => setCurrentPage('feed')}
                                        aiHelper={NeuralAI}
                                    />
                                ) : (
                                    <div className="fallback-content">
                                        <h2>Crea Evento Neural</h2>
                                        <p>Caricamento creatore eventi AI...</p>
                                    </div>
                                )}
                            </div>
                        )}

                        {currentPage === 'notifications' && (
                            <div className="page-content">
                                <div className="notifications-container">
                                    <h2>Notifiche Neural</h2>
                                    <p>Le tue notifiche AI-powered</p>
                                </div>
                            </div>
                        )}

                        {currentPage === 'profile' && (
                            <div className="page-content">
                                {window.SocialSpotComponents?.ProfilePage ? (
                                    <window.SocialSpotComponents.ProfilePage 
                                        supabase={supabase} 
                                        user={user}
                                        aiProfile={aiProfile}
                                        onProfileUpdate={generateAIProfile}
                                    />
                                ) : (
                                    <div className="fallback-content">
                                        <h2>Profilo Neural</h2>
                                        <p>Caricamento profilo AI...</p>
                                    </div>
                                )}
                            </div>
                        )}
                    </main>

                    {/* Neural Navigation */}
                    <nav className="neural-nav">
                        <div className="nav-content">
                            <button 
                                className={`nav-item ${currentPage === 'feed' ? 'active' : ''}`}
                                onClick={() => setCurrentPage('feed')}
                            >
                                <i className="fas fa-home"></i>
                                <span>Feed</span>
                            </button>
                            <button 
                                className={`nav-item ${currentPage === 'search' ? 'active' : ''}`}
                                onClick={() => setCurrentPage('search')}
                            >
                                <i className="fas fa-search"></i>
                                <span>Cerca</span>
                            </button>
                            <button 
                                className={`nav-item ${currentPage === 'create' ? 'active' : ''}`}
                                onClick={() => setCurrentPage('create')}
                            >
                                <i className="fas fa-plus-circle neural-glow"></i>
                                <span>Crea</span>
                            </button>
                            <button 
                                className={`nav-item ${currentPage === 'notifications' ? 'active' : ''}`}
                                onClick={() => setCurrentPage('notifications')}
                            >
                                <i className="fas fa-bell"></i>
                                <span>Notifiche</span>
                                {notifications > 0 && <div className="nav-badge">{notifications}</div>}
                            </button>
                            <button 
                                className={`nav-item ${currentPage === 'profile' ? 'active' : ''}`}
                                onClick={() => setCurrentPage('profile')}
                            >
                                <i className="fas fa-user"></i>
                                <span>Profilo</span>
                            </button>
                        </div>
                    </nav>
                </div>
            );
        }

        // ðŸš€ RENDER ULTIMATE NEURAL
        ReactDOM.render(<NeuralApp />, document.getElementById('root'));
    </script>
</body>
</html>
