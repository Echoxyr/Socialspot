<!DOCTYPE html>

<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SocialSpot - Un nuovo modo di incontrarsi</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone@7/babel.min.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <meta name="description" content="SocialSpot - Un nuovo modo di incontrarsi">
    <meta name="keywords" content="social, eventi, networking, incontri, community">
    <style>
        :root {
            --primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --success: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --warning: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            --danger: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            --dark: #0a0a0a;
            --surface: rgba(26, 26, 26, 0.95);
            --surface-2: rgba(42, 42, 42, 0.95);
            --text: #ffffff;
            --text-muted: #888888;
            --border: rgba(255, 255, 255, 0.1);
            --shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            --glow: 0 0 40px rgba(102, 126, 234, 0.3);
        }

```
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        background: var(--dark);
        color: var(--text);
        overflow-x: hidden;
        line-height: 1.6;
    }

    /* ANIMATIONS */
    @keyframes ultimateGlow {
        0%, 100% { filter: brightness(1) saturate(1); }
        50% { filter: brightness(1.2) saturate(1.3); }
    }

    @keyframes ultimatePulse {
        0%, 100% { transform: scale(1) rotate(0deg); }
        50% { transform: scale(1.05) rotate(1deg); }
    }

    @keyframes ultimateSlide {
        0% { transform: translateX(-100%) rotate(-5deg); opacity: 0; }
        100% { transform: translateX(0) rotate(0deg); opacity: 1; }
    }

    @keyframes ultimateFloat {
        0%, 100% { transform: translateY(0px) rotate(0deg); }
        50% { transform: translateY(-10px) rotate(2deg); }
    }

    @keyframes ultimateMatrix {
        0% { background-position: 0% 0%; }
        100% { background-position: 100% 100%; }
    }

    @keyframes rotate {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    @keyframes modalSlideUp {
        from { transform: translateY(50px) scale(0.9); opacity: 0; }
        to { transform: translateY(0) scale(1); opacity: 1; }
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    /* BACKGROUND */
    .app {
        min-height: 100vh;
        background: 
            radial-gradient(circle at 25% 25%, rgba(102, 126, 234, 0.1) 0%, transparent 50%),
            radial-gradient(circle at 75% 75%, rgba(249, 115, 22, 0.1) 0%, transparent 50%),
            radial-gradient(circle at 50% 50%, rgba(139, 92, 246, 0.05) 0%, transparent 50%),
            linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 50%, #0a0a0a 100%);
        background-size: 400% 400%;
        animation: ultimateMatrix 20s ease infinite;
        position: relative;
    }

    .app::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: 
            url("data:image/svg+xml,%3Csvg width='40' height='40' viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23667eea' fill-opacity='0.03'%3E%3Cpath d='M20 20c0-5.5-4.5-10-10-10s-10 4.5-10 10 4.5 10 10 10 10-4.5 10-10zm10 0c0-5.5-4.5-10-10-10s-10 4.5-10 10 4.5 10 10 10 10-4.5 10-10z'/%3E%3C/g%3E%3C/svg%3E") repeat;
        pointer-events: none;
        z-index: -1;
    }

    /* TOP BAR - MODIFICATO: rimosso status indicators */
    .top-bar {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        background: rgba(10, 10, 10, 0.95);
        backdrop-filter: blur(20px) saturate(180%);
        border-bottom: 1px solid var(--border);
        padding: 15px 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 999;
        animation: ultimateSlide 0.8s ease-out;
        box-shadow: var(--shadow);
    }

    .logo-ultimate {
        display: flex;
        align-items: center;
        gap: 12px;
        animation: ultimateFloat 3s ease-in-out infinite;
    }

    /* NUOVO LOGO: lente con pin map */
    .logo-icon {
        width: 45px;
        height: 45px;
        background: var(--primary);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 900;
        font-size: 20px;
        color: white;
        box-shadow: var(--glow);
        animation: ultimateGlow 2s ease-in-out infinite;
        position: relative;
    }

    .logo-icon i.fa-search {
        position: absolute;
        font-size: 22px;
    }

    .logo-icon i.fa-map-marker-alt {
        position: absolute;
        font-size: 14px;
        margin-top: 2px;
    }

    .logo-text {
        font-size: 24px;
        font-weight: 800;
        background: var(--primary);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        animation: ultimateGlow 2s ease-in-out infinite;
    }

    /* BOTTOM NAV */
    .bottom-nav {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: rgba(10, 10, 10, 0.95);
        backdrop-filter: blur(20px) saturate(180%);
        border-top: 1px solid var(--border);
        display: flex;
        padding: 15px 0;
        z-index: 1000;
        box-shadow: var(--shadow);
    }

    .nav-item {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 12px;
        cursor: pointer;
        color: var(--text-muted);
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        border-radius: 15px;
        margin: 0 5px;
    }

    .nav-item.active {
        color: #667eea;
        background: rgba(102, 126, 234, 0.1);
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
    }

    .nav-item:hover {
        color: #667eea;
        transform: translateY(-3px);
        background: rgba(102, 126, 234, 0.05);
    }

    .nav-item i {
        font-size: 24px;
        margin-bottom: 6px;
        transition: all 0.3s ease;
    }

    .nav-item.active i {
        animation: ultimateFloat 2s ease-in-out infinite;
    }

    .nav-item span {
        font-size: 11px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .nav-badge {
        position: absolute;
        top: 8px;
        right: 15px;
        background: var(--secondary);
        color: white;
        border-radius: 15px;
        padding: 4px 8px;
        font-size: 10px;
        font-weight: 700;
        min-width: 20px;
        text-align: center;
        animation: ultimatePulse 1.5s ease-in-out infinite;
        box-shadow: 0 0 15px rgba(240, 147, 251, 0.6);
    }

    /* CONTENT */
    .content {
        padding: 80px 0 110px;
        min-height: 100vh;
    }

    /* ONBOARDING */
    .onboarding {
        min-height: 100vh;
        background: 
            radial-gradient(circle at 20% 80%, rgba(102, 126, 234, 0.15) 0%, transparent 50%),
            radial-gradient(circle at 80% 20%, rgba(240, 147, 251, 0.15) 0%, transparent 50%),
            radial-gradient(circle at 40% 40%, rgba(139, 92, 246, 0.1) 0%, transparent 50%),
            linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
        position: relative;
        overflow: hidden;
    }

    .onboarding::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: 
            conic-gradient(from 0deg at 50% 50%, 
            rgba(102, 126, 234, 0.1) 0deg, 
            transparent 60deg, 
            rgba(240, 147, 251, 0.1) 120deg, 
            transparent 180deg, 
            rgba(139, 92, 246, 0.1) 240deg, 
            transparent 300deg, 
            rgba(102, 126, 234, 0.1) 360deg);
        animation: rotate 20s linear infinite;
    }

    .onboarding-card {
        background: rgba(26, 26, 26, 0.9);
        backdrop-filter: blur(40px) saturate(180%);
        border-radius: 25px;
        padding: 50px;
        text-align: center;
        max-width: 450px;
        width: 100%;
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 
            0 25px 50px -12px rgba(0, 0, 0, 0.5),
            0 0 80px rgba(102, 126, 234, 0.15);
        position: relative;
        z-index: 1;
        animation: ultimateSlide 1s ease-out;
    }

    /* LOGO ONBOARDING - MODIFICATO: omini che si danno la mano con telefono */
    .ultimate-logo {
        width: 100px;
        height: 100px;
        background: var(--primary);
        border-radius: 25px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 25px;
        font-size: 42px;
        font-weight: 900;
        color: white;
        box-shadow: 
            0 15px 35px rgba(102, 126, 234, 0.4),
            0 0 60px rgba(102, 126, 234, 0.2);
        animation: ultimateFloat 3s ease-in-out infinite;
        position: relative;
    }

    .ultimate-logo::before {
        content: '';
        position: absolute;
        inset: -2px;
        background: var(--primary);
        border-radius: 27px;
        z-index: -1;
        opacity: 0.5;
        animation: ultimateGlow 2s ease-in-out infinite;
    }

    .onboarding h1 {
        font-size: 32px;
        font-weight: 800;
        margin-bottom: 12px;
        background: var(--primary);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .onboarding p {
        font-size: 16px;
        color: var(--text-muted);
        margin-bottom: 35px;
        line-height: 1.6;
    }

    .auth-tabs {
        display: flex;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 15px;
        padding: 6px;
        margin-bottom: 35px;
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .auth-tab {
        flex: 1;
        padding: 15px;
        background: none;
        border: none;
        color: var(--text-muted);
        border-radius: 12px;
        cursor: pointer;
        font-weight: 600;
        font-size: 15px;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .auth-tab.active {
        background: var(--primary);
        color: white;
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        transform: translateY(-2px);
    }

    .form-group {
        margin-bottom: 25px;
        position: relative;
    }

    .form-input {
        width: 100%;
        padding: 18px 20px;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 15px;
        color: var(--text);
        font-size: 16px;
        font-weight: 500;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        backdrop-filter: blur(10px);
    }

    .form-input:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 25px rgba(102, 126, 234, 0.2);
        background: rgba(255, 255, 255, 0.08);
        transform: translateY(-2px);
    }

    .form-input::placeholder {
        color: rgba(255, 255, 255, 0.4);
        font-weight: 400;
    }

    .btn-ultimate {
        width: 100%;
        padding: 20px;
        background: var(--primary);
        border: none;
        border-radius: 15px;
        color: white;
        font-size: 18px;
        font-weight: 700;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
        box-shadow: 0 15px 35px rgba(102, 126, 234, 0.3);
    }

    .btn-ultimate::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        transition: left 0.6s ease;
    }

    .btn-ultimate:hover::before {
        left: 100%;
    }

    .btn-ultimate:hover {
        transform: translateY(-3px);
        box-shadow: 0 25px 50px rgba(102, 126, 234, 0.4);
    }

    .btn-ultimate:active {
        transform: translateY(-1px);
    }

    .btn-ultimate:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
    }

    /* LOCATION AUTOCOMPLETE */
    .location-input-container {
        position: relative;
    }

    .location-suggestions {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: rgba(26, 26, 26, 0.95);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 15px;
        max-height: 250px;
        overflow-y: auto;
        z-index: 1000;
        margin-top: 8px;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
    }

    .location-suggestion {
        padding: 15px 20px;
        cursor: pointer;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .location-suggestion:hover {
        background: rgba(102, 126, 234, 0.1);
        transform: translateX(5px);
    }

    .location-suggestion:last-child {
        border-bottom: none;
    }

    .location-suggestion i {
        color: #667eea;
        font-size: 14px;
    }

    /* FEED - MODIFICATO: testi aggiornati */
    .feed {
        padding: 0;
        position: relative;
    }

    .feed-header {
        padding: 25px 20px;
        text-align: center;
        background: rgba(26, 26, 26, 0.5);
        backdrop-filter: blur(20px);
        margin: 20px;
        border-radius: 20px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        animation: ultimateSlide 0.8s ease-out;
    }

    .feed-title {
        font-size: 28px;
        font-weight: 800;
        margin-bottom: 10px;
        background: var(--primary);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .feed-subtitle {
        color: var(--text-muted);
        font-size: 16px;
    }

    .events-grid {
        display: grid;
        gap: 25px;
        padding: 0 20px;
    }

    .event-card {
        background: rgba(26, 26, 26, 0.8);
        backdrop-filter: blur(20px);
        border-radius: 20px;
        padding: 25px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
        animation: ultimateSlide 0.8s ease-out;
    }

    .event-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: var(--primary);
        transform: scaleX(0);
        transition: transform 0.3s ease;
        transform-origin: left;
    }

    .event-card:hover::before {
        transform: scaleX(1);
    }

    .event-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
        border-color: rgba(102, 126, 234, 0.3);
    }

    .event-badge {
        position: absolute;
        top: 20px;
        right: 20px;
        background: var(--success);
        color: white;
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 11px;
        font-weight: 700;
        box-shadow: 0 0 20px rgba(79, 172, 254, 0.5);
    }

    .event-badge.pending {
        background: var(--warning);
    }

    .event-badge.accepted {
        background: var(--success);
    }

    .event-badge.rejected {
        background: var(--danger);
    }

    .event-header {
        display: flex;
        align-items: center;
        margin-bottom: 20px;
        gap: 15px;
    }

    .event-avatar {
        width: 55px;
        height: 55px;
        border-radius: 50%;
        background: var(--primary);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 800;
        font-size: 20px;
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        animation: ultimateFloat 3s ease-in-out infinite;
    }

    .event-info {
        flex: 1;
    }

    .event-creator {
        font-weight: 700;
        font-size: 16px;
        margin-bottom: 4px;
    }

    .event-location {
        font-size: 14px;
        color: var(--text-muted);
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .event-category {
        background: var(--secondary);
        color: white;
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        animation: ultimateGlow 3s ease-in-out infinite;
    }

    .event-content {
        margin: 20px 0;
    }

    .event-title {
        font-size: 22px;
        font-weight: 800;
        margin-bottom: 12px;
        line-height: 1.3;
    }

    .event-description {
        color: var(--text-muted);
        line-height: 1.6;
        margin-bottom: 20px;
    }

    .event-meta {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        margin: 20px 0;
    }

    .event-meta-item {
        display: flex;
        align-items: center;
        gap: 8px;
        color: var(--text-muted);
        font-size: 14px;
        font-weight: 500;
    }

    .event-meta-item i {
        color: #667eea;
        width: 16px;
    }

    .event-preferences {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin: 15px 0;
    }

    .preference-tag {
        background: rgba(102, 126, 234, 0.1);
        border: 1px solid rgba(102, 126, 234, 0.3);
        color: #667eea;
        padding: 6px 12px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
    }

    .event-status-badge {
        display: inline-block;
        padding: 6px 14px;
        border-radius: 15px;
        font-size: 12px;
        font-weight: 700;
        margin: 10px 0;
    }

    .event-status-badge.waiting {
        background: rgba(255, 193, 7, 0.1);
        color: #ffc107;
        border: 1px solid rgba(255, 193, 7, 0.3);
    }

    .event-status-badge.in-progress {
        background: rgba(33, 150, 243, 0.1);
        color: #2196f3;
        border: 1px solid rgba(33, 150, 243, 0.3);
    }

    .event-status-badge.finished {
        background: rgba(76, 175, 80, 0.1);
        color: #4caf50;
        border: 1px solid rgba(76, 175, 80, 0.3);
    }

    .participants-count {
        display: flex;
        align-items: center;
        gap: 8px;
        color: #667eea;
        font-weight: 700;
        font-size: 16px;
    }

    .stats-update-indicator {
        background: var(--success);
        color: white;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 10px;
        font-weight: 700;
        animation: ultimatePulse 1s ease-in-out infinite;
        margin-left: 8px;
    }

    .event-actions {
        display: flex;
        gap: 12px;
        margin-top: 20px;
    }

    .action-btn {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        color: var(--text);
        padding: 12px 20px;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 14px;
        font-weight: 600;
        flex: 1;
        justify-content: center;
    }

    .action-btn:hover {
        border-color: #667eea;
        color: #667eea;
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.15);
    }

    .action-btn.liked {
        border-color: #f5576c;
        color: #f5576c;
        background: rgba(245, 87, 108, 0.1);
    }

    .action-btn.pending {
        background: rgba(255, 193, 7, 0.1);
        border-color: #ffc107;
        color: #ffc107;
    }

    .action-btn.accepted {
        background: var(--primary);
        border-color: transparent;
        color: white;
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
    }

    .action-btn.rejected {
        background: rgba(245, 87, 108, 0.1);
        border-color: #f5576c;
        color: #f5576c;
    }

    /* MODAL */
    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(10px);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        padding: 20px;
        animation: fadeIn 0.3s ease-out;
    }

    .modal-content {
        background: rgba(26, 26, 26, 0.95);
        backdrop-filter: blur(40px);
        border-radius: 25px;
        max-width: 700px;
        width: 100%;
        max-height: 90vh;
        overflow-y: auto;
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
        animation: modalSlideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .modal-header {
        padding: 30px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .modal-title {
        font-size: 26px;
        font-weight: 800;
    }

    .modal-close {
        background: rgba(255, 255, 255, 0.1);
        border: none;
        color: var(--text-muted);
        font-size: 20px;
        cursor: pointer;
        padding: 10px;
        border-radius: 50%;
        transition: all 0.3s ease;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .modal-close:hover {
        background: rgba(245, 87, 108, 0.2);
        color: #f5576c;
        transform: scale(1.1);
    }

    .modal-body {
        padding: 30px;
    }

    /* RICHIESTE PARTECIPAZIONE */
    .requests-section {
        margin-top: 30px;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        padding-top: 30px;
    }

    .request-item {
        background: rgba(102, 126, 234, 0.05);
        border: 1px solid rgba(102, 126, 234, 0.2);
        border-radius: 15px;
        padding: 15px;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 15px;
        transition: all 0.3s ease;
    }

    .request-item:hover {
        background: rgba(102, 126, 234, 0.1);
        transform: translateX(5px);
    }

    .request-avatar {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: var(--primary);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 700;
        font-size: 18px;
        flex-shrink: 0;
    }

    .request-info {
        flex: 1;
    }

    .request-name {
        font-weight: 700;
        font-size: 16px;
        margin-bottom: 4px;
    }

    .request-time {
        font-size: 12px;
        color: var(--text-muted);
    }

    .request-actions {
        display: flex;
        gap: 10px;
    }

    .request-btn {
        padding: 8px 16px;
        border: none;
        border-radius: 10px;
        font-size: 13px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .request-btn.accept {
        background: var(--success);
        color: white;
    }

    .request-btn.reject {
        background: var(--danger);
        color: white;
    }

    .request-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    }

    /* VALIDAZIONE PRESENZA */
    .presence-section {
        margin-top: 30px;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        padding-top: 30px;
    }

    .presence-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 12px;
        background: rgba(255, 255, 255, 0.03);
        border-radius: 12px;
        margin-bottom: 10px;
    }

    .presence-user {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .presence-status {
        padding: 6px 12px;
        border-radius: 10px;
        font-size: 12px;
        font-weight: 600;
    }

    .presence-status.validated {
        background: rgba(76, 175, 80, 0.1);
        color: #4caf50;
        border: 1px solid rgba(76, 175, 80, 0.3);
    }

    .presence-status.pending {
        background: rgba(255, 193, 7, 0.1);
        color: #ffc107;
        border: 1px solid rgba(255, 193, 7, 0.3);
    }

    /* RECENSIONI */
    .reviews-section {
        margin-top: 30px;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        padding-top: 30px;
    }

    .review-form {
        background: rgba(102, 126, 234, 0.05);
        border: 1px solid rgba(102, 126, 234, 0.2);
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 25px;
    }

    .stars-input {
        display: flex;
        gap: 8px;
        margin: 15px 0;
        font-size: 28px;
    }

    .star {
        cursor: pointer;
        color: rgba(255, 255, 255, 0.2);
        transition: all 0.3s ease;
    }

    .star.selected,
    .star:hover {
        color: #ffc107;
    }

    .review-item {
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 15px;
    }

    .review-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 12px;
    }

    .review-author {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .review-stars {
        color: #ffc107;
        font-size: 16px;
    }

    .review-text {
        color: var(--text);
        line-height: 1.6;
    }

    .review-time {
        font-size: 12px;
        color: var(--text-muted);
        margin-top: 8px;
    }

    /* CHAT */
    .chat-section {
        margin-top: 30px;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        padding-top: 30px;
    }

    .chat-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 20px;
    }

    .chat-title {
        font-size: 18px;
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .chat-messages {
        max-height: 400px;
        overflow-y: auto;
        margin-bottom: 20px;
        padding: 20px;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 15px;
        border: 1px solid rgba(255, 255, 255, 0.05);
    }

    .chat-message {
        display: flex;
        align-items: flex-start;
        gap: 12px;
        margin-bottom: 15px;
        padding: 15px;
        background: rgba(102, 126, 234, 0.1);
        border-radius: 15px;
        transition: all 0.3s ease;
        animation: ultimateSlide 0.5s ease-out;
    }

    .chat-message:hover {
        background: rgba(102, 126, 234, 0.15);
        transform: translateX(5px);
    }

    .chat-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: var(--primary);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 16px;
        font-weight: 700;
        flex-shrink: 0;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }

    .chat-content {
        flex: 1;
    }

    .chat-author {
        font-weight: 700;
        font-size: 14px;
        margin-bottom: 4px;
        color: #667eea;
    }

    .chat-text {
        font-size: 14px;
        color: var(--text);
        line-height: 1.5;
        margin-bottom: 4px;
    }

    .chat-time {
        font-size: 11px;
        color: var(--text-muted);
    }

    .chat-form {
        display: flex;
        gap: 12px;
    }

    .chat-input {
        flex: 1;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 15px;
        padding: 15px 20px;
        color: var(--text);
        font-size: 14px;
        transition: all 0.3s ease;
    }

    .chat-input:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 20px rgba(102, 126, 234, 0.2);
    }

    .chat-send {
        background: var(--primary);
        border: none;
        border-radius: 15px;
        padding: 15px 20px;
        color: white;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }

    .chat-send:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
    }

    /* CREATE EVENT */
    .create-page {
        padding: 20px;
        max-width: 800px;
        margin: 0 auto;
    }

    .create-header {
        text-align: center;
        margin-bottom: 40px;
        animation: ultimateSlide 0.8s ease-out;
    }

    .create-title {
        font-size: 32px;
        font-weight: 800;
        margin-bottom: 12px;
        background: var(--primary);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .create-subtitle {
        color: var(--text-muted);
        font-size: 16px;
    }

    .create-form {
        background: rgba(26, 26, 26, 0.8);
        backdrop-filter: blur(20px);
        border-radius: 25px;
        padding: 40px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
        animation: ultimateSlide 1s ease-out;
    }

    .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 25px;
        margin-bottom: 25px;
    }

    .form-group-full {
        grid-column: 1 / -1;
    }

    .form-label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: var(--text);
        font-size: 14px;
    }

    .form-textarea {
        min-height: 120px;
        resize: vertical;
        font-family: inherit;
    }

    .form-select {
        appearance: none;
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%23667eea' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
        background-position: right 15px center;
        background-repeat: no-repeat;
        background-size: 16px;
        padding-right: 45px;
    }

    /* PROFILE */
    .profile-page {
        padding: 20px;
        max-width: 800px;
        margin: 0 auto;
    }

    .profile-header {
        text-align: center;
        margin-bottom: 40px;
        background: rgba(26, 26, 26, 0.8);
        backdrop-filter: blur(20px);
        border-radius: 25px;
        padding: 40px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
        animation: ultimateSlide 0.8s ease-out;
        position: relative;
        overflow: hidden;
    }

    .profile-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: var(--primary);
    }

    .profile-avatar-large {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        background: var(--primary);
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 20px;
        font-size: 48px;
        color: white;
        font-weight: 800;
        border: 4px solid rgba(102, 126, 234, 0.3);
        box-shadow: 0 15px 35px rgba(102, 126, 234, 0.3);
        animation: ultimateFloat 3s ease-in-out infinite;
    }

    .profile-name {
        font-size: 28px;
        font-weight: 800;
        margin-bottom: 8px;
    }

    .profile-email {
        color: var(--text-muted);
        font-size: 16px;
        margin-bottom: 25px;
    }

    .profile-stats {
        display: flex;
        justify-content: center;
        gap: 40px;
        margin: 30px 0;
    }

    .stat-item {
        text-align: center;
        padding: 20px;
        background: rgba(102, 126, 234, 0.1);
        border-radius: 15px;
        min-width: 100px;
        border: 1px solid rgba(102, 126, 234, 0.2);
        transition: all 0.3s ease;
    }

    .stat-item:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(102, 126, 234, 0.2);
    }

    .stat-number {
        font-size: 28px;
        font-weight: 800;
        color: #667eea;
        margin-bottom: 8px;
        animation: ultimateGlow 3s ease-in-out infinite;
    }

    .stat-label {
        font-size: 12px;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-weight: 600;
    }

    .profile-actions {
        display: flex;
        gap: 15px;
        margin: 30px 0;
    }

    .profile-btn {
        flex: 1;
        padding: 18px;
        background: var(--primary);
        border: none;
        border-radius: 15px;
        color: white;
        font-weight: 700;
        font-size: 16px;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
    }

    .profile-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 15px 35px rgba(102, 126, 234, 0.4);
    }

    .profile-btn.secondary {
        background: rgba(255, 255, 255, 0.1);
        box-shadow: none;
    }

    .profile-btn.secondary:hover {
        background: rgba(255, 255, 255, 0.15);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
    }

    /* EDIT PROFILE MODAL */
    .edit-profile-form .form-row {
        margin-bottom: 20px;
    }

    /* SEARCH */
    .search-page {
        padding: 20px;
    }

    .search-bar {
        background: rgba(26, 26, 26, 0.8);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 20px;
        padding: 18px 25px;
        color: var(--text);
        width: 100%;
        margin-bottom: 30px;
        font-size: 16px;
        font-weight: 500;
        transition: all 0.3s ease;
    }

    .search-bar:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 30px rgba(102, 126, 234, 0.2);
        background: rgba(26, 26, 26, 0.9);
    }

    .search-bar::placeholder {
        color: rgba(255, 255, 255, 0.4);
    }

    .section-title {
        font-size: 20px;
        font-weight: 700;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .section-title i {
        color: #667eea;
    }

    .people-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 25px;
    }

    .person-card {
        background: rgba(26, 26, 26, 0.8);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 20px;
        padding: 25px;
        text-align: center;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
        animation: ultimateSlide 0.8s ease-out;
    }

    .person-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: var(--primary);
        transform: scaleX(0);
        transition: transform 0.3s ease;
    }

    .person-card:hover::before {
        transform: scaleX(1);
    }

    .person-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
        border-color: rgba(102, 126, 234, 0.3);
    }

    .person-avatar {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        background: var(--primary);
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 20px;
        color: white;
        font-weight: 800;
        font-size: 28px;
        border: 3px solid rgba(102, 126, 234, 0.3);
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        animation: ultimateFloat 3s ease-in-out infinite;
    }

    .person-name {
        font-weight: 700;
        font-size: 18px;
        margin-bottom: 8px;
    }

    .person-bio {
        font-size: 14px;
        color: var(--text-muted);
        margin-bottom: 15px;
        line-height: 1.5;
    }

    .person-location {
        font-size: 12px;
        color: #667eea;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
    }

    .connect-btn {
        background: var(--primary);
        border: none;
        border-radius: 12px;
        padding: 12px 24px;
        color: white;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 14px;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }

    .connect-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
    }

    .connect-btn.following {
        background: rgba(255, 255, 255, 0.1);
        box-shadow: none;
    }

    /* NOTIFICATIONS */
    .notifications-page {
        padding: 20px;
        max-width: 800px;
        margin: 0 auto;
    }

    .notification-item {
        display: flex;
        align-items: center;
        padding: 20px;
        background: rgba(26, 26, 26, 0.8);
        backdrop-filter: blur(20px);
        border-radius: 15px;
        margin-bottom: 15px;
        gap: 15px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        transition: all 0.3s ease;
        position: relative;
        animation: ultimateSlide 0.5s ease-out;
        cursor: pointer;
    }

    .notification-item:hover {
        border-color: #667eea;
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.15);
    }

    .notification-item.unread {
        border-left: 4px solid #667eea;
        background: rgba(102, 126, 234, 0.05);
    }

    .notification-avatar {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: var(--primary);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 700;
        font-size: 18px;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }

    .notification-content {
        flex: 1;
    }

    .notification-text {
        font-size: 15px;
        margin-bottom: 6px;
        line-height: 1.4;
    }

    .notification-time {
        font-size: 12px;
        color: var(--text-muted);
    }

    .notification-action {
        background: var(--primary);
        border: none;
        border-radius: 10px;
        padding: 10px 20px;
        color: white;
        font-size: 12px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }

    .notification-action:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
    }

    /* UTILITIES */
    .loading {
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 200px;
        flex-direction: column;
        gap: 20px;
    }

    .spinner {
        width: 50px;
        height: 50px;
        border: 3px solid rgba(102, 126, 234, 0.1);
        border-top: 3px solid #667eea;
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    .loading-text {
        color: var(--text-muted);
        font-weight: 600;
    }

    .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: var(--text-muted);
    }

    .empty-state i {
        font-size: 64px;
        margin-bottom: 20px;
        color: rgba(102, 126, 234, 0.3);
    }

    .empty-state h3 {
        font-size: 24px;
        margin-bottom: 12px;
        color: var(--text);
        font-weight: 700;
    }

    .empty-state p {
        font-size: 16px;
        line-height: 1.5;
    }

    .error-message {
        background: rgba(245, 87, 108, 0.1);
        color: #f5576c;
        padding: 18px 25px;
        border-radius: 15px;
        margin-bottom: 25px;
        font-size: 14px;
        border: 1px solid rgba(245, 87, 108, 0.2);
        font-weight: 500;
    }

    .success-message {
        background: rgba(79, 172, 254, 0.1);
        color: #4facfe;
        padding: 18px 25px;
        border-radius: 15px;
        margin-bottom: 25px;
        font-size: 14px;
        border: 1px solid rgba(79, 172, 254, 0.2);
        font-weight: 500;
    }

    /* RESPONSIVE DESIGN */
    @media (max-width: 768px) {
        .top-bar {
            padding: 12px 15px;
        }

        .logo-text {
            font-size: 20px;
        }

        .onboarding-card {
            padding: 30px 25px;
            margin: 10px;
        }

        .ultimate-logo {
            width: 80px;
            height: 80px;
            font-size: 32px;
        }

        .onboarding h1 {
            font-size: 26px;
        }

        .form-row {
            grid-template-columns: 1fr;
            gap: 20px;
        }

        .profile-stats {
            gap: 20px;
            flex-wrap: wrap;
        }

        .stat-item {
            min-width: 80px;
            padding: 15px;
        }

        .event-actions {
            flex-direction: column;
        }

        .people-grid {
            grid-template-columns: 1fr;
        }

        .profile-actions {
            flex-direction: column;
        }

        .modal-content {
            margin: 10px;
            max-height: 95vh;
        }

        .modal-header, .modal-body {
            padding: 20px;
        }

        .events-grid {
            padding: 0 15px;
        }

        .event-card {
            padding: 20px;
        }
    }

    @media (max-width: 480px) {
        .nav-item {
            padding: 8px 4px;
        }

        .nav-item i {
            font-size: 20px;
        }

        .nav-item span {
            font-size: 9px;
        }

        .event-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 10px;
        }

        .event-meta {
            flex-direction: column;
            gap: 10px;
        }

        .form-input, .btn-ultimate {
            padding: 15px;
        }

        .chat-messages {
            padding: 15px;
        }

        .search-bar {
            padding: 15px 20px;
        }
    }

    /* ADVANCED EFFECTS */
    .ultimate-glow {
        animation: ultimateGlow 3s ease-in-out infinite;
    }

    .ultimate-pulse {
        animation: ultimatePulse 2s ease-in-out infinite;
    }

    .ultimate-float {
        animation: ultimateFloat 3s ease-in-out infinite;
    }

    /* Scrollbar personalizzata */
    ::-webkit-scrollbar {
        width: 8px;
    }

    ::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb {
        background: rgba(102, 126, 234, 0.5);
        border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
        background: rgba(102, 126, 234, 0.7);
    }
</style>
```

</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        // CONFIGURAZIONE SUPABASE
        const SUPABASE_URL = 'https://wsmjnssfmujdfgthyizw.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndzbWpuc3NmbXVqZGZndGh5aXp3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA4ODA3NjIsImV4cCI6MjA2NjQ1Njc2Mn0.t91X-fGIolFBPnhr5_sexJMqzgdCDmXuEUXiL_pFId4';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

```
    const { useState, useEffect, useCallback, useRef } = React;

    // DATI
    const CATEGORIES = [
        'Sport', 'Musica', 'Arte', 'Cultura', 'Tecnologia', 
        'Cibo', 'Viaggi', 'Cinema', 'All\'aperto', 'Business'
    ];

    // LISTA COMPLETA CITTÀ ITALIANE (espansa)
    const ITALIAN_CITIES = [
        'Roma, Lazio', 'Milano, Lombardia', 'Napoli, Campania', 'Torino, Piemonte',
        'Palermo, Sicilia', 'Genova, Liguria', 'Bologna, Emilia-Romagna', 'Firenze, Toscana',
        'Bari, Puglia', 'Catania, Sicilia', 'Venezia, Veneto', 'Verona, Veneto',
        'Messina, Sicilia', 'Padova, Veneto', 'Trieste, Friuli-Venezia Giulia', 'Taranto, Puglia',
        'Brescia, Lombardia', 'Prato, Toscana', 'Parma, Emilia-Romagna', 'Modena, Emilia-Romagna',
        'Reggio Calabria, Calabria', 'Reggio Emilia, Emilia-Romagna', 'Perugia, Umbria', 'Livorno, Toscana',
        'Ravenna, Emilia-Romagna', 'Cagliari, Sardegna', 'Foggia, Puglia', 'Rimini, Emilia-Romagna',
        'Salerno, Campania', 'Ferrara, Emilia-Romagna', 'Sassari, Sardegna', 'Latina, Lazio',
        'Pescara, Abruzzo', 'Monza, Lombardia', 'Bergamo, Lombardia', 'Trento, Trentino-Alto Adige',
        'Forlì, Emilia-Romagna', 'Vicenza, Veneto', 'Terni, Umbria', 'Bolzano, Trentino-Alto Adige',
        'Novara, Piemonte', 'Piacenza, Emilia-Romagna', 'Ancona, Marche', 'Andria, Puglia',
        'Arezzo, Toscana', 'Udine, Friuli-Venezia Giulia', 'Cesena, Emilia-Romagna', 'Lecce, Puglia',
        'Pesaro, Marche', 'Barletta, Puglia', 'Alessandria, Piemonte', 'La Spezia, Liguria',
        'Pistoia, Toscana', 'Pisa, Toscana', 'Guidonia Montecelio, Lazio', 'Lucca, Toscana',
        'Brindisi, Puglia', 'Como, Lombardia', 'Treviso, Veneto', 'Busto Arsizio, Lombardia',
        'Marsala, Sicilia', 'Grosseto, Toscana', 'Varese, Lombardia', 'Caserta, Campania',
        'Asti, Piemonte', 'Ragusa, Sicilia', 'Pavia, Lombardia', 'Cremona, Lombardia',
        'Trapani, Sicilia', 'Lodi, Lombardia', 'Mantova, Lombardia', 'Siracusa, Sicilia'
    ];

    // FASCE ETÀ
    const AGE_RANGES = ['18-25', '26-35', '36-50', '50+', 'Tutte le età'];

    // SESSO PREFERITO
    const GENDER_PREFERENCES = ['Uomo', 'Donna', 'Tutti'];

    // STATI EVENTO
    const EVENT_STATES = {
        WAITING: 'waiting',
        IN_PROGRESS: 'in-progress',
        FINISHED: 'finished'
    };

    // COMPONENT: LOCATION INPUT CON AUTOCOMPLETE
    function LocationInput({ value, onChange, placeholder }) {
        const [suggestions, setSuggestions] = useState([]);
        const [showSuggestions, setShowSuggestions] = useState(false);

        const handleInputChange = (e) => {
            const inputValue = e.target.value;
            onChange(inputValue);
            
            if (inputValue.length > 1) {
                const filtered = ITALIAN_CITIES.filter(city =>
                    city.toLowerCase().includes(inputValue.toLowerCase())
                ).slice(0, 10);
                setSuggestions(filtered);
                setShowSuggestions(true);
            } else {
                setShowSuggestions(false);
            }
        };

        const selectSuggestion = (city) => {
            onChange(city);
            setShowSuggestions(false);
        };

        return (
            <div className="location-input-container">
                <input
                    type="text"
                    className="form-input"
                    placeholder={placeholder}
                    value={value}
                    onChange={handleInputChange}
                    onBlur={() => setTimeout(() => setShowSuggestions(false), 200)}
                />
                {showSuggestions && suggestions.length > 0 && (
                    <div className="location-suggestions">
                        {suggestions.map((city, index) => (
                            <div
                                key={index}
                                className="location-suggestion"
                                onClick={() => selectSuggestion(city)}
                            >
                                <i className="fas fa-map-marker-alt"></i>
                                {city}
                            </div>
                        ))}
                    </div>
                )}
            </div>
        );
    }

    // HOOK: STATISTICHE REAL-TIME
    function useRealTimeStats(userId) {
        const [stats, setStats] = useState({ events: 0, followers: 0, following: 0 });
        const [loading, setLoading] = useState(true);

        const calculateStats = useCallback(async () => {
            if (!userId) return;
            
            try {
                // Eventi creati
                const { data: myEvents } = await supabase
                    .from('events')
                    .select('id')
                    .eq('creator_id', userId);
                
                const eventsCount = myEvents?.length || 0;
                
                // Followers reali
                const { data: followers } = await supabase
                    .from('user_follows')
                    .select('follower_id')
                    .eq('followed_id', userId);
                
                const followersCount = followers?.length || 0;
                
                // Following reali
                const { data: following } = await supabase
                    .from('user_follows')
                    .select('followed_id')
                    .eq('follower_id', userId);
                
                const followingCount = following?.length || 0;
                
                setStats({
                    events: eventsCount,
                    followers: followersCount,
                    following: followingCount
                });
            } catch (err) {
                console.error('❌ Errore calcolo statistiche:', err);
            } finally {
                setLoading(false);
            }
        }, [userId]);

        useEffect(() => {
            calculateStats();
            
            const eventsChannel = supabase.channel('events_stats')
                .on('postgres_changes', {
                    event: '*',
                    schema: 'public',
                    table: 'events',
                    filter: `creator_id=eq.${userId}`
                }, calculateStats)
                .subscribe();

            const followsChannel = supabase.channel('follows_stats')
                .on('postgres_changes', {
                    event: '*',
                    schema: 'public',
                    table: 'user_follows'
                }, calculateStats)
                .subscribe();

            return () => {
                supabase.removeChannel(eventsChannel);
                supabase.removeChannel(followsChannel);
            };
        }, [calculateStats]);

        return { stats, loading, refresh: calculateStats };
    }

    // HOOK: NOTIFICHE REALI
    function useRealTimeNotifications(userId) {
        const [notifications, setNotifications] = useState([]);
        const [unreadCount, setUnreadCount] = useState(0);
        const [loading, setLoading] = useState(true);

        const loadNotifications = useCallback(async () => {
            if (!userId) return;
            
            try {
                const { data, error } = await supabase
                    .from('notifications')
                    .select(`
                        *,
                        sender:profiles!notifications_sender_id_fkey(username)
                    `)
                    .eq('user_id', userId)
                    .order('created_at', { ascending: false })
                    .limit(50);
                
                if (!error && data) {
                    setNotifications(data);
                    setUnreadCount(data.filter(n => !n.read).length);
                }
            } catch (err) {
                console.error('❌ Errore caricamento notifiche:', err);
            } finally {
                setLoading(false);
            }
        }, [userId]);

        useEffect(() => {
            loadNotifications();
            
            const channel = supabase.channel('notifications_realtime')
                .on('postgres_changes', {
                    event: '*',
                    schema: 'public',
                    table: 'notifications',
                    filter: `user_id=eq.${userId}`
                }, loadNotifications)
                .subscribe();

            return () => supabase.removeChannel(channel);
        }, [loadNotifications]);

        const markAsRead = async (notificationId) => {
            try {
                await supabase
                    .from('notifications')
                    .update({ read: true })
                    .eq('id', notificationId);
                
                loadNotifications();
            } catch (err) {
                console.error('❌ Errore segna come letto:', err);
            }
        };

        return { notifications, unreadCount, loading, markAsRead, refresh: loadNotifications };
    }

    // COMPONENT: ONBOARDING
    function Onboarding({ onComplete }) {
        const [isSignIn, setIsSignIn] = useState(true);
        const [email, setEmail] = useState('');
        const [password, setPassword] = useState('');
        const [username, setUsername] = useState('');
        const [loading, setLoading] = useState(false);
        const [error, setError] = useState('');

        const handleAuth = async (e) => {
            e.preventDefault();
            setLoading(true);
            setError('');
            
            try {
                let result;
                if (isSignIn) {
                    result = await supabase.auth.signInWithPassword({ email, password });
                } else {
                    result = await supabase.auth.signUp({ 
                        email, 
                        password,
                        options: {
                            data: { username: username || email.split('@')[0] }
                        }
                    });
                }
                
                if (result.error) {
                    setError(result.error.message);
                } else if (result.data.user) {
                    await supabase.from('profiles').upsert({
                        id: result.data.user.id,
                        username: username || result.data.user.email.split('@')[0],
                        location: '',
                        age: null,
                        city: '',
                        region: '',
                        bio: ''
                    }, { onConflict: 'id' });
                    
                    onComplete(result.data.user);
                }
            } catch (err) {
                setError(err.message);
            } finally {
                setLoading(false);
            }
        };

        return (
            <div className="onboarding">
                <div className="onboarding-card">
                    <div className="ultimate-logo">
                        <i className="fas fa-users"></i>
                    </div>
                    <h1>SocialSpot</h1>
                    <p>Un nuovo modo di incontrarsi</p>
                    
                    <div className="auth-tabs">
                        <button 
                            className={`auth-tab ${isSignIn ? 'active' : ''}`} 
                            onClick={() => setIsSignIn(true)}
                        >
                            Accedi
                        </button>
                        <button 
                            className={`auth-tab ${!isSignIn ? 'active' : ''}`} 
                            onClick={() => setIsSignIn(false)}
                        >
                            Registrati
                        </button>
                    </div>
                    
                    <form onSubmit={handleAuth}>
                        {!isSignIn && (
                            <div className="form-group">
                                <input 
                                    type="text" 
                                    className="form-input" 
                                    placeholder="👤 Username" 
                                    value={username} 
                                    onChange={(e) => setUsername(e.target.value)} 
                                />
                            </div>
                        )}
                        <div className="form-group">
                            <input 
                                type="email" 
                                className="form-input" 
                                placeholder="📧 Email" 
                                value={email} 
                                onChange={(e) => setEmail(e.target.value)} 
                                required 
                            />
                        </div>
                        <div className="form-group">
                            <input 
                                type="password" 
                                className="form-input" 
                                placeholder="🔒 Password" 
                                value={password} 
                                onChange={(e) => setPassword(e.target.value)} 
                                required 
                            />
                        </div>
                        
                        {error && <div className="error-message">{error}</div>}
                        
                        <button type="submit" className="btn-ultimate" disabled={loading}>
                            {loading ? (
                                <>
                                    <i className="fas fa-spinner fa-spin"></i>
                                    Caricamento...
                                </>
                            ) : (
                                <>
                                    <i className={isSignIn ? 'fas fa-sign-in-alt' : 'fas fa-user-plus'}></i>
                                    {isSignIn ? 'Accedi' : 'Registrati'}
                                </>
                            )}
                        </button>
                    </form>
                </div>
            </div>
        );
    }
```

Il file è troppo lungo. Continuo con la seconda parte nel prossimo messaggio. Ma prima ti mostro un sommario delle modifiche già presenti nella prima parte:

## ✅ MODIFICHE GIÀ IMPLEMENTATE (Parte 1)

1. **Title e Meta** - Cambiato in “Un nuovo modo di incontrarsi”
1. **Logo Top Bar** - Rimosso “SS”, rimossi badge “LIVE” e “AI POWERED”
1. **Nuovo Logo** - Icona lente con pin map (implementata con Font Awesome)
1. **Logo Onboarding** - Cambiato da “SS” a icona “users” (due omini)
1. **Testi Feed** - “Un nuovo modo di incontrarsi” invece di “Eventi Ultimate”
1. **CSS Completo** - Tutti gli stili per: richieste, stati evento, recensioni, validazioni
1. **Liste Complete** - Città italiane espanse, fasce età, generi
1. **Hook Real-Time** - Statistiche e notifiche basate su DB reale
1. **Stati Evento** - Costanti per waiting, in-progress, finished

Ora continuo con i **COMPONENTI React** completi…// PARTE 2 - COMPONENTI REACT COMPLETI
// Questo va inserito dopo la parte 1 (CSS e setup)
// e prima della chiusura del tag </body>

```
    // COMPONENT: CHAT EVENTO (SOLO PARTECIPANTI ACCETTATI)
    function EventChat({ eventId, user, participationStatus, event }) {
        const [messages, setMessages] = useState([]);
        const [newMessage, setNewMessage] = useState('');
        const [loading, setLoading] = useState(true);
        const messagesEndRef = useRef(null);

        const isCreator = event.creator_id === user.id;
        const canAccessChat = isCreator || participationStatus === 'accepted';

        const scrollToBottom = () => {
            messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
        };

        useEffect(() => {
            if (canAccessChat) {
                loadMessages();
                
                const channel = supabase.channel(`event_chat_${eventId}`)
                    .on('postgres_changes', {
                        event: 'INSERT',
                        schema: 'public',
                        table: 'event_chats',
                        filter: `event_id=eq.${eventId}`
                    }, loadMessages)
                    .subscribe();

                return () => supabase.removeChannel(channel);
            }
        }, [eventId, canAccessChat]);

        useEffect(scrollToBottom, [messages]);

        const loadMessages = async () => {
            try {
                const { data, error } = await supabase
                    .from('event_chats')
                    .select(`
                        id,
                        content,
                        created_at,
                        profiles!event_chats_user_id_fkey(username)
                    `)
                    .eq('event_id', eventId)
                    .order('created_at', { ascending: true });

                if (!error) {
                    setMessages(data || []);
                }
            } catch (err) {
                console.error('❌ Errore caricamento chat:', err);
            } finally {
                setLoading(false);
            }
        };

        const sendMessage = async (e) => {
            e.preventDefault();
            if (!newMessage.trim() || !canAccessChat) return;

            try {
                await supabase
                    .from('event_chats')
                    .insert({
                        event_id: eventId,
                        user_id: user.id,
                        content: newMessage.trim()
                    });
                
                setNewMessage('');
            } catch (err) {
                console.error('❌ Errore invio messaggio:', err);
            }
        };

        if (!canAccessChat) {
            return (
                <div className="chat-section">
                    <div className="chat-header">
                        <div className="chat-title">
                            <i className="fas fa-lock"></i>
                            Chat Evento
                        </div>
                    </div>
                    <div className="empty-state">
                        <i className="fas fa-lock"></i>
                        <h3>Chat Privata</h3>
                        <p>Solo i partecipanti accettati possono accedere alla chat</p>
                    </div>
                </div>
            );
        }

        return (
            <div className="chat-section">
                <div className="chat-header">
                    <div className="chat-title">
                        <i className="fas fa-comments"></i>
                        Chat Evento
                    </div>
                </div>
                
                {loading ? (
                    <div className="loading">
                        <div className="spinner"></div>
                        <div className="loading-text">Caricamento chat...</div>
                    </div>
                ) : (
                    <>
                        <div className="chat-messages">
                            {messages.length === 0 ? (
                                <div className="empty-state">
                                    <i className="fas fa-comment-slash"></i>
                                    <h3>Nessun messaggio</h3>
                                    <p>Sii il primo a scrivere!</p>
                                </div>
                            ) : (
                                messages.map(msg => (
                                    <div key={msg.id} className="chat-message">
                                        <div className="chat-avatar">
                                            {msg.profiles?.username?.[0]?.toUpperCase() || 'U'}
                                        </div>
                                        <div className="chat-content">
                                            <div className="chat-author">{msg.profiles?.username || 'Utente'}</div>
                                            <div className="chat-text">{msg.content}</div>
                                            <div className="chat-time">
                                                {new Date(msg.created_at).toLocaleTimeString('it-IT', {
                                                    hour: '2-digit',
                                                    minute: '2-digit'
                                                })}
                                            </div>
                                        </div>
                                    </div>
                                ))
                            )}
                            <div ref={messagesEndRef} />
                        </div>
                        
                        <form onSubmit={sendMessage} className="chat-form">
                            <input
                                type="text"
                                className="chat-input"
                                placeholder="💬 Scrivi un messaggio..."
                                value={newMessage}
                                onChange={(e) => setNewMessage(e.target.value)}
                                required
                            />
                            <button type="submit" className="chat-send">
                                <i className="fas fa-paper-plane"></i>
                            </button>
                        </form>
                    </>
                )}
            </div>
        );
    }

    // COMPONENT: RICHIESTE PARTECIPAZIONE (PER CREATORE)
    function ParticipationRequests({ eventId, user, event }) {
        const [requests, setRequests] = useState([]);
        const [loading, setLoading] = useState(true);

        const isCreator = event.creator_id === user.id;

        useEffect(() => {
            if (isCreator) {
                loadRequests();
                
                const channel = supabase.channel(`requests_${eventId}`)
                    .on('postgres_changes', {
                        event: '*',
                        schema: 'public',
                        table: 'event_requests',
                        filter: `event_id=eq.${eventId}`
                    }, loadRequests)
                    .subscribe();

                return () => supabase.removeChannel(channel);
            }
        }, [eventId, isCreator]);

        const loadRequests = async () => {
            try {
                const { data, error } = await supabase
                    .from('event_requests')
                    .select(`
                        *,
                        requester:profiles!event_requests_requester_id_fkey(username)
                    `)
                    .eq('event_id', eventId)
                    .eq('status', 'pending')
                    .order('created_at', { ascending: false });
                
                if (!error) {
                    setRequests(data || []);
                }
            } catch (err) {
                console.error('❌ Errore caricamento richieste:', err);
            } finally {
                setLoading(false);
            }
        };

        const handleRequest = async (requestId, requesterId, status) => {
            try {
                // Aggiorna stato richiesta
                await supabase
                    .from('event_requests')
                    .update({ status })
                    .eq('id', requestId);
                
                // Se accettato, aggiungi a partecipanti
                if (status === 'accepted') {
                    await supabase
                        .from('event_participants')
                        .insert({
                            event_id: eventId,
                            user_id: requesterId,
                            status: 'accepted'
                        });
                }
                
                // Crea notifica
                await supabase
                    .from('notifications')
                    .insert({
                        user_id: requesterId,
                        sender_id: user.id,
                        type: status === 'accepted' ? 'request_accepted' : 'request_rejected',
                        event_id: eventId,
                        read: false
                    });
                
                loadRequests();
            } catch (err) {
                console.error('❌ Errore gestione richiesta:', err);
            }
        };

        if (!isCreator || loading) {
            return null;
        }

        if (requests.length === 0) {
            return null;
        }

        return (
            <div className="requests-section">
                <div className="section-title">
                    <i className="fas fa-user-clock"></i>
                    Richieste di Partecipazione ({requests.length})
                </div>
                {requests.map(request => (
                    <div key={request.id} className="request-item">
                        <div className="request-avatar">
                            {request.requester?.username?.[0]?.toUpperCase() || 'U'}
                        </div>
                        <div className="request-info">
                            <div className="request-name">{request.requester?.username || 'Utente'}</div>
                            <div className="request-time">
                                {new Date(request.created_at).toLocaleDateString('it-IT')}
                            </div>
                        </div>
                        <div className="request-actions">
                            <button 
                                className="request-btn accept"
                                onClick={() => handleRequest(request.id, request.requester_id, 'accepted')}
                            >
                                <i className="fas fa-check"></i> Accetta
                            </button>
                            <button 
                                className="request-btn reject"
                                onClick={() => handleRequest(request.id, request.requester_id, 'rejected')}
                            >
                                <i className="fas fa-times"></i> Rifiuta
                            </button>
                        </div>
                    </div>
                ))}
            </div>
        );
    }

    // COMPONENT: VALIDAZIONE PRESENZA
    function PresenceValidation({ eventId, user, event }) {
        const [participants, setParticipants] = useState([]);
        const [myPresence, setMyPresence] = useState(null);
        const [loading, setLoading] = useState(true);

        const isCreator = event.creator_id === user.id;
        const canValidate = event.status === EVENT_STATES.WAITING;

        useEffect(() => {
            loadParticipants();
            
            const channel = supabase.channel(`presence_${eventId}`)
                .on('postgres_changes', {
                    event: '*',
                    schema: 'public',
                    table: 'event_participants'
                }, loadParticipants)
                .subscribe();

            return () => supabase.removeChannel(channel);
        }, [eventId]);

        const loadParticipants = async () => {
            try {
                const { data, error } = await supabase
                    .from('event_participants')
                    .select(`
                        *,
                        profile:profiles!event_participants_user_id_fkey(username)
                    `)
                    .eq('event_id', eventId)
                    .eq('status', 'accepted');
                
                if (!error) {
                    setParticipants(data || []);
                    const mine = data?.find(p => p.user_id === user.id);
                    setMyPresence(mine);
                }
            } catch (err) {
                console.error('❌ Errore caricamento partecipanti:', err);
            } finally {
                setLoading(false);
            }
        };

        const markPresent = async () => {
            try {
                await supabase
                    .from('event_participants')
                    .update({ present: true })
                    .eq('event_id', eventId)
                    .eq('user_id', user.id);
                
                loadParticipants();
            } catch (err) {
                console.error('❌ Errore conferma presenza:', err);
            }
        };

        const validatePresence = async (participantId) => {
            try {
                await supabase
                    .from('event_participants')
                    .update({ validated: true })
                    .eq('id', participantId);
                
                loadParticipants();
            } catch (err) {
                console.error('❌ Errore validazione presenza:', err);
            }
        };

        const startEvent = async () => {
            try {
                await supabase
                    .from('events')
                    .update({ status: EVENT_STATES.IN_PROGRESS })
                    .eq('id', eventId);
                
                window.location.reload();
            } catch (err) {
                console.error('❌ Errore avvio evento:', err);
            }
        };

        if (event.status === EVENT_STATES.FINISHED) {
            return null;
        }

        return (
            <div className="presence-section">
                <div className="section-title">
                    <i className="fas fa-check-circle"></i>
                    Validazione Presenza
                </div>
                
                {!isCreator && canValidate && myPresence && !myPresence.present && (
                    <button 
                        className="btn-ultimate" 
                        onClick={markPresent}
                        style={{marginBottom: '20px'}}
                    >
                        <i className="fas fa-check"></i>
                        Conferma la tua presenza
                    </button>
                )}

                {participants.map(participant => (
                    <div key={participant.id} className="presence-item">
                        <div className="presence-user">
                            <div className="chat-avatar" style={{width: '35px', height: '35px', fontSize: '14px'}}>
                                {participant.profile?.username?.[0]?.toUpperCase() || 'U'}
                            </div>
                            <span>{participant.profile?.username || 'Utente'}</span>
                        </div>
                        <div style={{display: 'flex', gap: '10px', alignItems: 'center'}}>
                            {participant.present && (
                                <span className="presence-status pending">
                                    <i className="fas fa-clock"></i> Presente
                                </span>
                            )}
                            {participant.validated && (
                                <span className="presence-status validated">
                                    <i className="fas fa-check-circle"></i> Validato
                                </span>
                            )}
                            {isCreator && participant.present && !participant.validated && (
                                <button 
                                    className="request-btn accept"
                                    onClick={() => validatePresence(participant.id)}
                                >
                                    Valida
                                </button>
                            )}
                        </div>
                    </div>
                ))}

                {isCreator && canValidate && participants.some(p => p.validated) && (
                    <button 
                        className="btn-ultimate" 
                        onClick={startEvent}
                        style={{marginTop: '20px'}}
                    >
                        <i className="fas fa-play"></i>
                        Avvia Evento
                    </button>
                )}
            </div>
        );
    }

    // COMPONENT: RECENSIONI
    function EventReviews({ eventId, user, event }) {
        const [reviews, setReviews] = useState([]);
        const [myReview, setMyReview] = useState(null);
        const [rating, setRating] = useState(0);
        const [comment, setComment] = useState('');
        const [loading, setLoading] = useState(true);

        const canReview = event.status === EVENT_STATES.FINISHED;

        useEffect(() => {
            loadReviews();
        }, [eventId]);

        const loadReviews = async () => {
            try {
                const { data, error } = await supabase
                    .from('event_reviews')
                    .select(`
                        *,
                        reviewer:profiles!event_reviews_user_id_fkey(username)
                    `)
                    .eq('event_id', eventId)
                    .order('created_at', { ascending: false });
                
                if (!error) {
                    setReviews(data || []);
                    const mine = data?.find(r => r.user_id === user.id);
                    setMyReview(mine);
                }
            } catch (err) {
                console.error('❌ Errore caricamento recensioni:', err);
            } finally {
                setLoading(false);
            }
        };

        const submitReview = async (e) => {
            e.preventDefault();
            if (rating === 0) return;

            try {
                await supabase
                    .from('event_reviews')
                    .insert({
                        event_id: eventId,
                        user_id: user.id,
                        rating,
                        comment
                    });
                
                setRating(0);
                setComment('');
                loadReviews();
            } catch (err) {
                console.error('❌ Errore invio recensione:', err);
            }
        };

        if (!canReview) {
            return null;
        }

        return (
            <div className="reviews-section">
                <div className="section-title">
                    <i className="fas fa-star"></i>
                    Recensioni ({reviews.length})
                </div>
                
                {!myReview && (
                    <form onSubmit={submitReview} className="review-form">
                        <h4 style={{marginBottom: '15px'}}>Lascia una recensione</h4>
                        <div className="stars-input">
                            {[1, 2, 3, 4, 5].map(star => (
                                <i 
                                    key={star}
                                    className={`fas fa-star star ${star <= rating ? 'selected' : ''}`}
                                    onClick={() => setRating(star)}
                                />
                            ))}
                        </div>
                        <textarea
                            className="form-input form-textarea"
                            placeholder="Scrivi la tua recensione..."
                            value={comment}
                            onChange={(e) => setComment(e.target.value)}
                            required
                        />
                        <button type="submit" className="btn-ultimate">
                            <i className="fas fa-paper-plane"></i>
                            Invia Recensione
                        </button>
                    </form>
                )}

                {reviews.map(review => (
                    <div key={review.id} className="review-item">
                        <div className="review-header">
                            <div className="review-author">
                                <div className="chat-avatar" style={{width: '35px', height: '35px', fontSize: '14px'}}>
                                    {review.reviewer?.username?.[0]?.toUpperCase() || 'U'}
                                </div>
                                <span style={{fontWeight: 700}}>{review.reviewer?.username || 'Utente'}</span>
                            </div>
                            <div className="review-stars">
                                {Array.from({length: review.rating}, (_, i) => (
                                    <i key={i} className="fas fa-star"></i>
                                ))}
                            </div>
                        </div>
                        <div className="review-text">{review.comment}</div>
                        <div className="review-time">
                            {new Date(review.created_at).toLocaleDateString('it-IT')}
                        </div>
                    </div>
                ))}
            </div>
        );
    }

    // COMPONENT: MODAL EVENTO (COMPLETO CON TUTTE LE FUNZIONALITÀ)
    function EventModal({ event, onClose, user, onUpdate }) {
        const [participationStatus, setParticipationStatus] = useState(null);
        const [loading, setLoading] = useState(true);

        const isCreator = event.creator_id === user.id;

        useEffect(() => {
            checkParticipation();
        }, []);

        const checkParticipation = async () => {
            try {
                // Controlla se c'è una richiesta pending
                const { data: request } = await supabase
                    .from('event_requests')
                    .select('status')
                    .eq('event_id', event.id)
                    .eq('requester_id', user.id)
                    .single();
                
                if (request) {
                    setParticipationStatus(request.status);
                }
            } catch (err) {
                console.error('❌ Errore controllo partecipazione:', err);
            } finally {
                setLoading(false);
            }
        };

        const sendRequest = async () => {
            try {
                await supabase
                    .from('event_requests')
                    .insert({
                        event_id: event.id,
                        requester_id: user.id,
                        status: 'pending'
                    });
                
                // Notifica al creatore
                await supabase
                    .from('notifications')
                    .insert({
                        user_id: event.creator_id,
                        sender_id: user.id,
                        type: 'participation_request',
                        event_id: event.id,
                        read: false
                    });
                
                setParticipationStatus('pending');
                if (onUpdate) onUpdate();
            } catch (err) {
                console.error('❌ Errore invio richiesta:', err);
            }
        };

        const finishEvent = async () => {
            try {
                await supabase
                    .from('events')
                    .update({ status: EVENT_STATES.FINISHED })
                    .eq('id', event.id);
                
                window.location.reload();
            } catch (err) {
                console.error('❌ Errore chiusura evento:', err);
            }
        };

        const getStatusBadge = () => {
            switch(event.status) {
                case EVENT_STATES.WAITING:
                    return <span className="event-status-badge waiting">Da iniziare</span>;
                case EVENT_STATES.IN_PROGRESS:
                    return <span className="event-status-badge in-progress">In corso</span>;
                case EVENT_STATES.FINISHED:
                    return <span className="event-status-badge finished">Concluso</span>;
                default:
                    return null;
            }
        };

        const getRequestButton = () => {
            if (isCreator) return null;
            
            switch(participationStatus) {
                case 'pending':
                    return (
                        <button className="btn-ultimate" disabled style={{background: 'rgba(255, 193, 7, 0.3)'}}>
                            <i className="fas fa-clock"></i>
                            Richiesta in attesa
                        </button>
                    );
                case 'accepted':
                    return (
                        <button className="btn-ultimate" disabled style={{background: 'var(--success)'}}>
                            <i className="fas fa-check"></i>
                            Partecipazione accettata
                        </button>
                    );
                case 'rejected':
                    return (
                        <button className="btn-ultimate" disabled style={{background: 'rgba(245, 87, 108, 0.3)'}}>
                            <i className="fas fa-times"></i>
                            Richiesta rifiutata
                        </button>
                    );
                default:
                    return (
                        <button className="btn-ultimate" onClick={sendRequest}>
                            <i className="fas fa-paper-plane"></i>
                            Richiedi Partecipazione
                        </button>
                    );
            }
        };

        return (
            <div className="modal-overlay" onClick={onClose}>
                <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                    <div className="modal-header">
                        <h2 className="modal-title">{event.title}</h2>
                        <button className="modal-close" onClick={onClose}>
                            <i className="fas fa-times"></i>
                        </button>
                    </div>
                    <div className="modal-body">
                        {getStatusBadge()}
                        
                        <div className="event-category ultimate-glow" style={{marginBottom: '20px', display: 'inline-block'}}>
                            {event.category}
                        </div>
                        
                        <p style={{marginBottom: '20px', lineHeight: '1.6', fontSize: '16px'}}>
                            {event.description}
                        </p>
                        
                        <div className="event-meta">
                            <div className="event-meta-item">
                                <i className="fas fa-calendar"></i>
                                <span>{new Date(event.event_date).toLocaleString('it-IT')}</span>
                            </div>
                            <div className="event-meta-item">
                                <i className="fas fa-map-marker-alt"></i>
                                <span>{event.location}</span>
                            </div>
                            {event.profiles && (
                                <div className="event-meta-item">
                                    <i className="fas fa-user"></i>
                                    <span>Organizzato da {event.profiles.username}</span>
                                </div>
                            )}
                        </div>

                        {(event.preferred_age || event.preferred_gender) && (
                            <div className="event-preferences">
                                {event.preferred_age && (
                                    <div className="preference-tag">
                                        <i className="fas fa-users"></i> Età: {event.preferred_age}
                                    </div>
                                )}
                                {event.preferred_gender && (
                                    <div className="preference-tag">
                                        <i className="fas fa-venus-mars"></i> {event.preferred_gender}
                                    </div>
                                )}
                            </div>
                        )}
                        
                        {!loading && getRequestButton()}

                        {isCreator && event.status === EVENT_STATES.IN_PROGRESS && (
                            <button 
                                className="btn-ultimate" 
                                onClick={finishEvent}
                                style={{marginTop: '15px', background: 'var(--danger)'}}
                            >
                                <i className="fas fa-flag-checkered"></i>
                                Concludi Evento
                            </button>
                        )}

                        <ParticipationRequests eventId={event.id} user={user} event={event} />
                        <PresenceValidation eventId={event.id} user={user} event={event} />
                        <EventChat eventId={event.id} user={user} participationStatus={participationStatus} event={event} />
                        <EventReviews eventId={event.id} user={user} event={event} />
                    </div>
                </div>
            </div>
        );
    }
```

Continua nel prossimo file…// PARTE 3 - FEED, CREATE EVENT, PROFILE, SEARCH, NOTIFICATIONS

```
    // COMPONENT: FEED (AGGIORNATO CON RICHIESTE)
    function Feed({ user }) {
        const [events, setEvents] = useState([]);
        const [loading, setLoading] = useState(true);
        const [selectedEvent, setSelectedEvent] = useState(null);
        const [myRequests, setMyRequests] = useState({});

        useEffect(() => {
            loadEvents();
            loadMyRequests();
            
            const eventsChannel = supabase.channel('events_feed')
                .on('postgres_changes', {
                    event: '*',
                    schema: 'public',
                    table: 'events'
                }, loadEvents)
                .subscribe();

            const requestsChannel = supabase.channel('requests_feed')
                .on('postgres_changes', {
                    event: '*',
                    schema: 'public',
                    table: 'event_requests'
                }, loadMyRequests)
                .subscribe();

            return () => {
                supabase.removeChannel(eventsChannel);
                supabase.removeChannel(requestsChannel);
            };
        }, []);

        const loadEvents = async () => {
            try {
                const { data, error } = await supabase
                    .from('events')
                    .select(`
                        *,
                        profiles!events_creator_id_fkey(username, location)
                    `)
                    .order('created_at', { ascending: false });
                
                if (!error) {
                    setEvents(data || []);
                }
            } catch (err) {
                console.error('❌ Errore caricamento eventi:', err);
            } finally {
                setLoading(false);
            }
        };

        const loadMyRequests = async () => {
            try {
                const { data } = await supabase
                    .from('event_requests')
                    .select('event_id, status')
                    .eq('requester_id', user.id);
                
                const requestsMap = {};
                (data || []).forEach(req => {
                    requestsMap[req.event_id] = req.status;
                });
                setMyRequests(requestsMap);
            } catch (err) {
                console.error('❌ Errore caricamento richieste:', err);
            }
        };

        const formatDate = (dateString) => {
            const date = new Date(dateString);
            return date.toLocaleDateString('it-IT', {
                day: 'numeric',
                month: 'short',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        };

        const getRequestStatusBadge = (eventId) => {
            const status = myRequests[eventId];
            if (!status) return null;
            
            switch(status) {
                case 'pending':
                    return <div className="event-badge pending">In attesa</div>;
                case 'accepted':
                    return <div className="event-badge accepted">Accettato</div>;
                case 'rejected':
                    return <div className="event-badge rejected">Rifiutato</div>;
                default:
                    return null;
            }
        };

        if (loading) {
            return (
                <div className="loading">
                    <div className="spinner"></div>
                    <div className="loading-text">Caricamento eventi...</div>
                </div>
            );
        }

        return (
            <div className="feed">
                <div className="feed-header">
                    <h1 className="feed-title">Un nuovo modo di incontrarsi</h1>
                    <p className="feed-subtitle">Scopri eventi nella tua zona</p>
                </div>
                
                <div className="events-grid">
                    {events.length === 0 ? (
                        <div className="empty-state">
                            <i className="fas fa-users"></i>
                            <h3>Cerca, trova, partecipa</h3>
                            <p>Sii il primo a creare un evento nella tua zona!</p>
                        </div>
                    ) : (
                        events.map(event => (
                            <div key={event.id} className="event-card">
                                {getRequestStatusBadge(event.id)}
                                
                                <div className="event-header">
                                    <div className="event-avatar ultimate-float">
                                        {event.profiles?.username?.[0]?.toUpperCase() || 'U'}
                                    </div>
                                    <div className="event-info">
                                        <div className="event-creator">{event.profiles?.username || 'Utente'}</div>
                                        <div className="event-location">
                                            <i className="fas fa-map-marker-alt"></i>
                                            {event.location}
                                        </div>
                                    </div>
                                    <div className="event-category ultimate-pulse">{event.category}</div>
                                </div>
                                
                                <div className="event-content">
                                    <h3 className="event-title">{event.title}</h3>
                                    <p className="event-description">{event.description}</p>
                                    
                                    <div className="event-meta">
                                        <div className="event-meta-item">
                                            <i className="fas fa-calendar"></i>
                                            <span>{formatDate(event.event_date)}</span>
                                        </div>
                                    </div>

                                    {(event.preferred_age || event.preferred_gender) && (
                                        <div className="event-preferences">
                                            {event.preferred_age && (
                                                <div className="preference-tag">
                                                    Età: {event.preferred_age}
                                                </div>
                                            )}
                                            {event.preferred_gender && (
                                                <div className="preference-tag">
                                                    {event.preferred_gender}
                                                </div>
                                            )}
                                        </div>
                                    )}
                                </div>
                                
                                <div className="event-actions">
                                    <button 
                                        className="action-btn"
                                        onClick={() => setSelectedEvent(event)}
                                    >
                                        <i className="fas fa-info-circle"></i>
                                        Dettagli
                                    </button>
                                </div>
                            </div>
                        ))
                    )}
                </div>

                {selectedEvent && (
                    <EventModal 
                        event={selectedEvent} 
                        onClose={() => setSelectedEvent(null)} 
                        user={user}
                        onUpdate={() => {
                            loadMyRequests();
                            setSelectedEvent(null);
                        }}
                    />
                )}
            </div>
        );
    }

    // COMPONENT: CREATE EVENT (CON FASCE ETÀ E SESSO)
    function CreateEvent({ user, onEventCreated }) {
        const [title, setTitle] = useState('');
        const [description, setDescription] = useState('');
        const [location, setLocation] = useState('');
        const [date, setDate] = useState('');
        const [category, setCategory] = useState('');
        const [preferredAge, setPreferredAge] = useState('');
        const [preferredGender, setPreferredGender] = useState('');
        const [loading, setLoading] = useState(false);
        const [error, setError] = useState('');
        const [success, setSuccess] = useState(false);

        const handleCreate = async (e) => {
            e.preventDefault();
            setLoading(true);
            setError('');
            setSuccess(false);
            
            try {
                const { error } = await supabase.from('events').insert({
                    title,
                    description,
                    location,
                    event_date: date,
                    category,
                    preferred_age: preferredAge,
                    preferred_gender: preferredGender,
                    creator_id: user.id,
                    status: EVENT_STATES.WAITING
                });
                
                if (error) {
                    setError(error.message);
                } else {
                    setTitle('');
                    setDescription('');
                    setLocation('');
                    setDate('');
                    setCategory('');
                    setPreferredAge('');
                    setPreferredGender('');
                    setSuccess(true);
                    
                    setTimeout(() => {
                        setSuccess(false);
                        if (onEventCreated) onEventCreated();
                    }, 2000);
                }
            } catch (err) {
                setError(err.message);
            } finally {
                setLoading(false);
            }
        };

        return (
            <div className="create-page">
                <div className="create-header">
                    <h1 className="create-title">Crea Evento</h1>
                    <p className="create-subtitle">Condividi un'esperienza con la community</p>
                </div>
                
                <form onSubmit={handleCreate} className="create-form">
                    <div className="form-row">
                        <div className="form-group">
                            <label className="form-label">
                                <i className="fas fa-heading"></i>
                                Titolo evento *
                            </label>
                            <input 
                                type="text" 
                                className="form-input"
                                value={title} 
                                onChange={(e) => setTitle(e.target.value)} 
                                required 
                                placeholder="Inserisci un titolo accattivante" 
                            />
                        </div>
                        
                        <div className="form-group">
                            <label className="form-label">
                                <i className="fas fa-tag"></i>
                                Categoria *
                            </label>
                            <select 
                                className="form-input form-select"
                                value={category} 
                                onChange={(e) => setCategory(e.target.value)} 
                                required
                            >
                                <option value="" disabled>Seleziona categoria</option>
                                {CATEGORIES.map((cat) => (
                                    <option key={cat} value={cat}>{cat}</option>
                                ))}
                            </select>
                        </div>
                    </div>
                    
                    <div className="form-group form-group-full">
                        <label className="form-label">
                            <i className="fas fa-align-left"></i>
                            Descrizione *
                        </label>
                        <textarea 
                            className="form-input form-textarea"
                            value={description} 
                            onChange={(e) => setDescription(e.target.value)} 
                            required 
                            placeholder="Descrivi il tuo evento in dettaglio..."
                        />
                    </div>
                    
                    <div className="form-row">
                        <div className="form-group">
                            <label className="form-label">
                                <i className="fas fa-map-marker-alt"></i>
                                Luogo *
                            </label>
                            <LocationInput
                                value={location}
                                onChange={setLocation}
                                placeholder="Seleziona una location"
                            />
                        </div>
                        
                        <div className="form-group">
                            <label className="form-label">
                                <i className="fas fa-clock"></i>
                                Data e ora *
                            </label>
                            <input 
                                type="datetime-local" 
                                className="form-input"
                                value={date} 
                                onChange={(e) => setDate(e.target.value)} 
                                required 
                            />
                        </div>
                    </div>

                    <div className="form-row">
                        <div className="form-group">
                            <label className="form-label">
                                <i className="fas fa-users"></i>
                                Fascia d'età preferita *
                            </label>
                            <select 
                                className="form-input form-select"
                                value={preferredAge} 
                                onChange={(e) => setPreferredAge(e.target.value)} 
                                required
                            >
                                <option value="" disabled>Seleziona fascia d'età</option>
                                {AGE_RANGES.map((age) => (
                                    <option key={age} value={age}>{age}</option>
                                ))}
                            </select>
                        </div>

                        <div className="form-group">
                            <label className="form-label">
                                <i className="fas fa-venus-mars"></i>
                                Sesso preferito *
                            </label>
                            <select 
                                className="form-input form-select"
                                value={preferredGender} 
                                onChange={(e) => setPreferredGender(e.target.value)} 
                                required
                            >
                                <option value="" disabled>Seleziona preferenza</option>
                                {GENDER_PREFERENCES.map((gender) => (
                                    <option key={gender} value={gender}>{gender}</option>
                                ))}
                            </select>
                        </div>
                    </div>
                    
                    {error && <div className="error-message">❌ {error}</div>}
                    {success && <div className="success-message">✅ Evento creato con successo! 🎉</div>}
                    
                    <button type="submit" className="btn-ultimate" disabled={loading}>
                        {loading ? (
                            <>
                                <i className="fas fa-spinner fa-spin"></i>
                                Creazione in corso...
                            </>
                        ) : (
                            <>
                                <i className="fas fa-plus-circle"></i>
                                Crea evento
                            </>
                        )}
                    </button>
                </form>
            </div>
        );
    }

    // COMPONENT: EDIT PROFILE MODAL
    function EditProfileModal({ user, profile, onClose, onUpdate }) {
        const [username, setUsername] = useState(profile.username || '');
        const [age, setAge] = useState(profile.age || '');
        const [city, setCity] = useState(profile.city || '');
        const [bio, setBio] = useState(profile.bio || '');
        const [loading, setLoading] = useState(false);
        const [error, setError] = useState('');

        const handleSubmit = async (e) => {
            e.preventDefault();
            setLoading(true);
            setError('');
            
            try {
                // Estrai regione dalla città
                const region = city.includes(',') ? city.split(',')[1].trim() : '';
                
                const { error } = await supabase
                    .from('profiles')
                    .update({
                        username,
                        age: age ? parseInt(age) : null,
                        city,
                        region,
                        bio
                    })
                    .eq('id', user.id);
                
                if (error) {
                    setError(error.message);
                } else {
                    onUpdate();
                    onClose();
                }
            } catch (err) {
                setError(err.message);
            } finally {
                setLoading(false);
            }
        };

        return (
            <div className="modal-overlay" onClick={onClose}>
                <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                    <div className="modal-header">
                        <h2 className="modal-title">Modifica Profilo</h2>
                        <button className="modal-close" onClick={onClose}>
                            <i className="fas fa-times"></i>
                        </button>
                    </div>
                    <div className="modal-body">
                        <form onSubmit={handleSubmit} className="edit-profile-form">
                            <div className="form-group">
                                <label className="form-label">Username</label>
                                <input
                                    type="text"
                                    className="form-input"
                                    value={username}
                                    onChange={(e) => setUsername(e.target.value)}
                                    required
                                />
                            </div>

                            <div className="form-row">
                                <div className="form-group">
                                    <label className="form-label">Età</label>
                                    <input
                                        type="number"
                                        className="form-input"
                                        value={age}
                                        onChange={(e) => setAge(e.target.value)}
                                        min="18"
                                        max="120"
                                    />
                                </div>

                                <div className="form-group">
                                    <label className="form-label">Città e Regione</label>
                                    <LocationInput
                                        value={city}
                                        onChange={setCity}
                                        placeholder="Seleziona città e regione"
                                    />
                                </div>
                            </div>

                            <div className="form-group">
                                <label className="form-label">Bio</label>
                                <textarea
                                    className="form-input form-textarea"
                                    value={bio}
                                    onChange={(e) => setBio(e.target.value)}
                                    placeholder="Raccontaci qualcosa di te..."
                                />
                            </div>

                            {error && <div className="error-message">{error}</div>}

                            <button type="submit" className="btn-ultimate" disabled={loading}>
                                {loading ? (
                                    <>
                                        <i className="fas fa-spinner fa-spin"></i>
                                        Salvataggio...
                                    </>
                                ) : (
                                    <>
                                        <i className="fas fa-save"></i>
                                        Salva Modifiche
                                    </>
                                )}
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        );
    }

    // COMPONENT: PROFILE (CON EDIT)
    function Profile({ user, onSignOut }) {
        const { stats, loading: statsLoading } = useRealTimeStats(user.id);
        const [profile, setProfile] = useState({});
        const [myEvents, setMyEvents] = useState([]);
        const [loading, setLoading] = useState(true);
        const [showEditModal, setShowEditModal] = useState(false);

        useEffect(() => {
            loadProfile();
            loadMyEvents();
        }, []);

        const loadProfile = async () => {
            try {
                const { data, error } = await supabase
                    .from('profiles')
                    .select('*')
                    .eq('id', user.id)
                    .single();
                
                if (data) {
                    setProfile(data);
                }
            } catch (err) {
                console.error('❌ Errore caricamento profilo:', err);
            } finally {
                setLoading(false);
            }
        };

        const loadMyEvents = async () => {
            try {
                const { data, error } = await supabase
                    .from('events')
                    .select('*')
                    .eq('creator_id', user.id)
                    .order('event_date', { ascending: false });
                
                if (!error) {
                    setMyEvents(data || []);
                }
            } catch (err) {
                console.error('❌ Errore caricamento eventi:', err);
            }
        };

        if (loading) {
            return (
                <div className="loading">
                    <div className="spinner"></div>
                    <div className="loading-text">Caricamento profilo...</div>
                </div>
            );
        }

        return (
            <div className="profile-page">
                <div className="profile-header">
                    <div className="profile-avatar-large">
                        {profile.username?.[0]?.toUpperCase() || user.email[0].toUpperCase()}
                    </div>
                    <div className="profile-name">{profile.username || 'Utente'}</div>
                    {profile.age && <div className="profile-email">{profile.age} anni</div>}
                    {profile.city && <div className="profile-email">📍 {profile.city}</div>}
                    <div className="profile-email">{user.email}</div>
                    {profile.bio && (
                        <p style={{color: 'var(--text-muted)', marginTop: '15px', maxWidth: '500px', margin: '15px auto 0'}}>
                            {profile.bio}
                        </p>
                    )}
                    
                    <div className="profile-stats">
                        <div className="stat-item">
                            <div className="stat-number ultimate-glow">
                                {statsLoading ? '...' : stats.events}
                            </div>
                            <div className="stat-label">Eventi Creati</div>
                        </div>
                        <div className="stat-item">
                            <div className="stat-number ultimate-glow">
                                {statsLoading ? '...' : stats.followers}
                            </div>
                            <div className="stat-label">Followers</div>
                        </div>
                        <div className="stat-item">
                            <div className="stat-number ultimate-glow">
                                {statsLoading ? '...' : stats.following}
                            </div>
                            <div className="stat-label">Following</div>
                        </div>
                    </div>
                    
                    <div className="profile-actions">
                        <button className="profile-btn" onClick={() => setShowEditModal(true)}>
                            <i className="fas fa-edit"></i>
                            Modifica Profilo
                        </button>
                        <button className="profile-btn secondary" onClick={onSignOut}>
                            <i className="fas fa-sign-out-alt"></i>
                            Logout
                        </button>
                    </div>
                </div>

                {myEvents.length > 0 && (
                    <div style={{
                        background: 'rgba(26, 26, 26, 0.8)',
                        backdropFilter: 'blur(20px)',
                        borderRadius: '25px',
                        padding: '30px',
                        border: '1px solid rgba(255, 255, 255, 0.1)',
                        marginBottom: '25px'
                    }}>
                        <div className="section-title">
                            <i className="fas fa-calendar-check"></i>
                            I miei eventi ({myEvents.length})
                        </div>
                        <div className="events-grid">
                            {myEvents.slice(0, 3).map(event => (
                                <div key={event.id} className="event-card">
                                    <div className="event-content">
                                        <h3 className="event-title">{event.title}</h3>
                                        <p className="event-description">{event.description}</p>
                                        <div className="event-meta">
                                            <div className="event-meta-item">
                                                <i className="fas fa-calendar"></i>
                                                <span>{new Date(event.event_date).toLocaleDateString('it-IT')}</span>
                                            </div>
                                            <div className="event-meta-item">
                                                <i className="fas fa-map-marker-alt"></i>
                                                <span>{event.location}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                )}

                {showEditModal && (
                    <EditProfileModal
                        user={user}
                        profile={profile}
                        onClose={() => setShowEditModal(false)}
                        onUpdate={loadProfile}
                    />
                )}
            </div>
        );
    }
```

Continua nel prossimo file…// PARTE 4 FINALE - SEARCH, NOTIFICATIONS, APP PRINCIPALE

```
    // COMPONENT: SEARCH (CON FOLLOW SYSTEM)
    function Search({ user }) {
        const [searchTerm, setSearchTerm] = useState('');
        const [events, setEvents] = useState([]);
        const [people, setPeople] = useState([]);
        const [filteredEvents, setFilteredEvents] = useState([]);
        const [filteredPeople, setFilteredPeople] = useState([]);
        const [following, setFollowing] = useState([]);
        const [loading, setLoading] = useState(false);
        const [selectedCategory, setSelectedCategory] = useState('');

        useEffect(() => {
            loadData();
            loadFollowing();
        }, []);

        useEffect(() => {
            filterResults();
        }, [searchTerm, selectedCategory, events, people]);

        const loadData = async () => {
            setLoading(true);
            try {
                // Carica eventi
                const { data: eventsData } = await supabase
                    .from('events')
                    .select(`
                        *,
                        profiles!events_creator_id_fkey(username)
                    `)
                    .order('event_date', { ascending: true });
                
                setEvents(eventsData || []);
                setFilteredEvents(eventsData || []);

                // Carica utenti
                const { data: usersData } = await supabase
                    .from('profiles')
                    .select('*')
                    .neq('id', user.id)
                    .limit(50);
                
                setPeople(usersData || []);
                setFilteredPeople(usersData || []);
            } catch (err) {
                console.error('❌ Errore caricamento dati:', err);
            } finally {
                setLoading(false);
            }
        };

        const loadFollowing = async () => {
            try {
                const { data } = await supabase
                    .from('user_follows')
                    .select('followed_id')
                    .eq('follower_id', user.id);
                
                setFollowing((data || []).map(f => f.followed_id));
            } catch (err) {
                console.error('❌ Errore caricamento following:', err);
            }
        };

        const filterResults = () => {
            let filteredEvts = events;
            let filteredPpl = people;
            
            if (searchTerm) {
                const term = searchTerm.toLowerCase();
                filteredEvts = filteredEvts.filter(event => 
                    event.title.toLowerCase().includes(term) ||
                    event.description.toLowerCase().includes(term) ||
                    event.location.toLowerCase().includes(term) ||
                    event.profiles?.username.toLowerCase().includes(term)
                );
                
                filteredPpl = filteredPpl.filter(person =>
                    person.username?.toLowerCase().includes(term) ||
                    person.bio?.toLowerCase().includes(term) ||
                    person.city?.toLowerCase().includes(term)
                );
            }
            
            if (selectedCategory) {
                filteredEvts = filteredEvts.filter(event => event.category === selectedCategory);
            }
            
            setFilteredEvents(filteredEvts);
            setFilteredPeople(filteredPpl);
        };

        const toggleFollow = async (userId) => {
            try {
                const isFollowing = following.includes(userId);
                
                if (isFollowing) {
                    await supabase
                        .from('user_follows')
                        .delete()
                        .eq('follower_id', user.id)
                        .eq('followed_id', userId);
                    
                    setFollowing(following.filter(id => id !== userId));
                } else {
                    await supabase
                        .from('user_follows')
                        .insert({
                            follower_id: user.id,
                            followed_id: userId
                        });
                    
                    // Notifica al seguito
                    await supabase
                        .from('notifications')
                        .insert({
                            user_id: userId,
                            sender_id: user.id,
                            type: 'new_follower',
                            read: false
                        });
                    
                    setFollowing([...following, userId]);
                }
            } catch (err) {
                console.error('❌ Errore toggle follow:', err);
            }
        };

        return (
            <div className="search-page">
                <input
                    type="text"
                    className="search-bar"
                    placeholder="🔍 Cerca eventi, luoghi, persone..."
                    value={searchTerm}
                    onChange={(e) => setSearchTerm(e.target.value)}
                />
                
                <div style={{marginBottom: '30px'}}>
                    <div className="section-title">
                        <i className="fas fa-filter"></i>
                        Filtra per categoria
                    </div>
                    <div style={{display: 'flex', flexWrap: 'wrap', gap: '10px', marginTop: '15px'}}>
                        <button 
                            className={`action-btn ${!selectedCategory ? 'accepted' : ''}`}
                            onClick={() => setSelectedCategory('')}
                            style={{fontSize: '14px', padding: '10px 15px'}}
                        >
                            Tutte
                        </button>
                        {CATEGORIES.map(cat => (
                            <button 
                                key={cat}
                                className={`action-btn ${selectedCategory === cat ? 'accepted' : ''}`}
                                onClick={() => setSelectedCategory(cat)}
                                style={{fontSize: '14px', padding: '10px 15px'}}
                            >
                                {cat}
                            </button>
                        ))}
                    </div>
                </div>

                {filteredPeople.length > 0 && (
                    <div className="people-section">
                        <div className="section-title">
                            <i className="fas fa-users"></i>
                            Persone ({filteredPeople.length})
                        </div>
                        <div className="people-grid">
                            {filteredPeople.slice(0, 12).map(person => (
                                <div key={person.id} className="person-card">
                                    <div className="person-avatar ultimate-float">
                                        {person.username?.[0]?.toUpperCase() || 'U'}
                                    </div>
                                    <div className="person-name">{person.username || 'Utente'}</div>
                                    {person.bio && (
                                        <div className="person-bio">{person.bio}</div>
                                    )}
                                    {person.city && (
                                        <div className="person-location">
                                            <i className="fas fa-map-marker-alt"></i>
                                            {person.city}
                                        </div>
                                    )}
                                    <button 
                                        className={`connect-btn ${following.includes(person.id) ? 'following' : ''}`}
                                        onClick={() => toggleFollow(person.id)}
                                    >
                                        <i className={following.includes(person.id) ? 'fas fa-user-check' : 'fas fa-user-plus'}></i>
                                        {following.includes(person.id) ? 'Seguito' : 'Segui'}
                                    </button>
                                </div>
                            ))}
                        </div>
                    </div>
                )}

                {filteredEvents.length > 0 && (
                    <div style={{marginTop: '40px'}}>
                        <div className="section-title">
                            <i className="fas fa-calendar-alt"></i>
                            Eventi ({filteredEvents.length})
                        </div>
                        <div className="events-grid">
                            {filteredEvents.slice(0, 6).map(event => (
                                <div key={event.id} className="event-card">
                                    <div className="event-header">
                                        <div className="event-avatar">
                                            {event.profiles?.username?.[0]?.toUpperCase() || 'U'}
                                        </div>
                                        <div className="event-info">
                                            <div className="event-creator">{event.profiles?.username || 'Utente'}</div>
                                            <div className="event-location">
                                                <i className="fas fa-map-marker-alt"></i>
                                                {event.location}
                                            </div>
                                        </div>
                                        <div className="event-category">{event.category}</div>
                                    </div>
                                    <div className="event-content">
                                        <h3 className="event-title">{event.title}</h3>
                                        <p className="event-description">{event.description}</p>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                )}

                {loading && (
                    <div className="loading">
                        <div className="spinner"></div>
                        <div className="loading-text">Ricerca in corso...</div>
                    </div>
                )}
            </div>
        );
    }

    // COMPONENT: NOTIFICATIONS (REALI DAL DB)
    function Notifications({ user }) {
        const { notifications, unreadCount, loading, markAsRead } = useRealTimeNotifications(user.id);

        const getNotificationText = (notif) => {
            const senderName = notif.sender?.username || 'Utente';
            
            switch(notif.type) {
                case 'participation_request':
                    return `${senderName} ha richiesto di partecipare al tuo evento`;
                case 'request_accepted':
                    return `${senderName} ha accettato la tua richiesta di partecipazione`;
                case 'request_rejected':
                    return `${senderName} ha rifiutato la tua richiesta di partecipazione`;
                case 'new_follower':
                    return `${senderName} ha iniziato a seguirti`;
                case 'new_message':
                    return `Nuovo messaggio nella chat dell'evento`;
                default:
                    return 'Nuova notifica';
            }
        };

        const getNotificationIcon = (type) => {
            switch(type) {
                case 'participation_request':
                    return 'fa-user-clock';
                case 'request_accepted':
                    return 'fa-check-circle';
                case 'request_rejected':
                    return 'fa-times-circle';
                case 'new_follower':
                    return 'fa-user-plus';
                case 'new_message':
                    return 'fa-comment';
                default:
                    return 'fa-bell';
            }
        };

        const formatTime = (dateString) => {
            const date = new Date(dateString);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);
            
            if (diffMins < 1) return 'Ora';
            if (diffMins < 60) return `${diffMins} min fa`;
            if (diffHours < 24) return `${diffHours} ore fa`;
            if (diffDays === 1) return 'Ieri';
            return date.toLocaleDateString('it-IT');
        };

        if (loading) {
            return (
                <div className="loading">
                    <div className="spinner"></div>
                    <div className="loading-text">Caricamento notifiche...</div>
                </div>
            );
        }

        return (
            <div className="notifications-page">
                <div className="section-title">
                    <i className="fas fa-bell"></i>
                    Notifiche {unreadCount > 0 && `(${unreadCount} non lette)`}
                </div>
                
                {notifications.length === 0 ? (
                    <div className="empty-state">
                        <i className="fas fa-bell-slash"></i>
                        <h3>Nessuna notifica</h3>
                        <p>Le tue notifiche appariranno qui</p>
                    </div>
                ) : (
                    notifications.map(notif => (
                        <div 
                            key={notif.id} 
                            className={`notification-item ${!notif.read ? 'unread' : ''}`}
                            onClick={() => !notif.read && markAsRead(notif.id)}
                        >
                            <div className="notification-avatar">
                                <i className={`fas ${getNotificationIcon(notif.type)}`}></i>
                            </div>
                            <div className="notification-content">
                                <div className="notification-text">
                                    {getNotificationText(notif)}
                                </div>
                                <div className="notification-time">{formatTime(notif.created_at)}</div>
                            </div>
                        </div>
                    ))
                )}
            </div>
        );
    }

    // COMPONENT: APP PRINCIPALE
    function App() {
        const [user, setUser] = useState(null);
        const [currentPage, setCurrentPage] = useState('feed');
        const [loading, setLoading] = useState(true);
        const { unreadCount } = useRealTimeNotifications(user?.id);

        useEffect(() => {
            // Controlla sessione esistente
            supabase.auth.getSession().then(({ data: { session } }) => {
                setUser(session?.user ?? null);
                setLoading(false);
            });

            // Ascolta cambiamenti auth
            const { data: { subscription } } = supabase.auth.onAuthStateChange((_event, session) => {
                setUser(session?.user ?? null);
            });

            return () => subscription.unsubscribe();
        }, []);

        const handleSignOut = async () => {
            await supabase.auth.signOut();
            setUser(null);
            setCurrentPage('feed');
        };

        if (loading) {
            return (
                <div className="loading" style={{minHeight: '100vh'}}>
                    <div className="spinner"></div>
                    <div className="loading-text">Caricamento...</div>
                </div>
            );
        }

        if (!user) {
            return <Onboarding onComplete={setUser} />;
        }

        return (
            <div className="app">
                {/* Top Bar */}
                <div className="top-bar">
                    <div className="logo-ultimate">
                        <div className="logo-icon">
                            <i className="fas fa-search"></i>
                            <i className="fas fa-map-marker-alt"></i>
                        </div>
                        <div className="logo-text">SocialSpot</div>
                    </div>
                </div>

                {/* Content */}
                <div className="content">
                    {currentPage === 'feed' && <Feed user={user} />}
                    {currentPage === 'search' && <Search user={user} />}
                    {currentPage === 'create' && <CreateEvent user={user} onEventCreated={() => setCurrentPage('feed')} />}
                    {currentPage === 'notifications' && <Notifications user={user} />}
                    {currentPage === 'profile' && <Profile user={user} onSignOut={handleSignOut} />}
                </div>

                {/* Bottom Navigation */}
                <div className="bottom-nav">
                    <div 
                        className={`nav-item ${currentPage === 'feed' ? 'active' : ''}`}
                        onClick={() => setCurrentPage('feed')}
                    >
                        <i className="fas fa-home"></i>
                        <span>Feed</span>
                    </div>
                    <div 
                        className={`nav-item ${currentPage === 'search' ? 'active' : ''}`}
                        onClick={() => setCurrentPage('search')}
                    >
                        <i className="fas fa-search"></i>
                        <span>Cerca</span>
                    </div>
                    <div 
                        className={`nav-item ${currentPage === 'create' ? 'active' : ''}`}
                        onClick={() => setCurrentPage('create')}
                    >
                        <i className="fas fa-plus-circle"></i>
                        <span>Crea</span>
                    </div>
                    <div 
                        className={`nav-item ${currentPage === 'notifications' ? 'active' : ''}`}
                        onClick={() => setCurrentPage('notifications')}
                    >
                        <i className="fas fa-bell"></i>
                        <span>Notifiche</span>
                        {unreadCount > 0 && <div className="nav-badge">{unreadCount}</div>}
                    </div>
                    <div 
                        className={`nav-item ${currentPage === 'profile' ? 'active' : ''}`}
                        onClick={() => setCurrentPage('profile')}
                    >
                        <i className="fas fa-user"></i>
                        <span>Profilo</span>
                    </div>
                </div>
            </div>
        );
    }

    // RENDER
    ReactDOM.render(<App />, document.getElementById('root'));
</script>
```

</body>
</html>
